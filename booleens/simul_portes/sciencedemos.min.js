function n(t,i){var s=this;this.M=t,this._=i,this.$=8,this.P=.25*$(i).width(),this.N=!1,this.I=!1,this.B=0,this.S=0,this.C=null,this.A=null,this.F=[],this.L=[],this.O=[],this.D(),this.T(),$(".btn-reset",this._).click(function(){s.D()}),$(".btn-pause",this._).click(function(){s.N=!s.N,$(".btn-pause",s._).prop("value",s.N?"Resume":"Pause")}),$(".car_holder",this._).on({mousedown:function(t){s.R(t)}}),$(".car_track",this._).on({mouseup:function(t){s.J(t)},mousemove:function(t){s.U(t)},mouseleave:function(){s.J(0)}}),$(window).resize(function(){s.W()}),this.W(),setInterval(function(){s.N||(s.S+=.2,s.H(),s.W())},200)}function e(t,i){var s,n=this;for(this.M=t,this._=i,this.V=!1,n.G=.75,n.X=.1,n.K=.025,n.Z=50,n.Y=20,n.tt=50,n.it=[],s=0;s<n.Z;s++)n.it.push([s,0]);for(n.st=[],s=0;s<n.Y;s++)n.st.push([s,0]);for(n.nt=[],s=0;s<n.Y;s++)n.nt.push([s,1e-6]);for(n.et=[],s=0;s<n.tt;s++)n.et.push([s,0]);n.ot=100,n.ht=3,n.at=0,$(".Tslider").slider({min:0,max:300,value:n.ot,orientation:"vertical",change:function(){n.ot=$(".Tslider").slider("value")},slide:function(){n.ot=$(".Tslider").slider("value")}});i=$(".Bbuff",this._);this.rt=null,this.lt=new P(i,!1,function(t,i,s){n.ut(t,i,s)},function(t,i,s){n.ct(t,i,s)}),n.dt(),n.ft(),$(".init-balls").click(function(){n.ft()}),$(window).resize(function(){n.dt()}),setInterval(function(){n.yt()},1e3*n.X),setInterval(function(){n.gt()},250),setInterval(function(){n.Mt()},200),i.on({mouseup:function(){n.xt()},mouseout:function(){n.xt()},touchend:function(t){t.preventDefault(),n.xt()},touchcancel:function(t){t.preventDefault(),n.xt()}}),$(".btn-export",this._).click(function(){var t=new ut(1,1);n.vt(t),ot("bouncing_balls.svg",t._t())})}function o(t,i){this.M=t,this._=i,this.bt=750,this.wt=20,this.$t=this.Pt(),this.kt=new s(i,this,this.bt,this.wt)}function h(t,i){this.M=t,this._=i,this.bt=750,this.wt=20,this.zt=0,this.Nt=0,this.It=0,this.$t=this.Pt(),this.kt=new s(i,this,this.bt,this.wt)}function s(t,i,s,n){var e=this;this._=t,this.Bt=i,this.bt=s,this.wt=n,this.St=0,this.Et=4,this.Ct=null,this.At=.75,this.Ft=s+5,this.Lt=at(this.Ft/2),this.Ot=new Uint8Array(this.Ft*this.Ft),this.Dt=new Uint8Array(this.Ft*this.Ft),this.Tt=this.Ot,this.I=!1,this.jt="stopped",this.dt(),$(window).resize(function(){e.dt()}),$(".toolbar_button_play",this._).click(function(){var t,i=e.Ft*e.Ft;if("stopped"===e.jt){for(e.Tt=e.Dt,t=0;t<i;t++)e.Tt[t]=e.Ot[t];e.St=0,e.Bt.Rt()}e.jt="playing",$(".toolbar_button_play",e._).addClass("active"),$(".toolbar_button_pause",e._).removeClass("disabled").removeClass("active"),$(".toolbar_button_stop",e._).removeClass("active")}),$(".toolbar_button_stop",this._).click(function(){e.Jt()}),$(".toolbar_button_pause",this._).click(function(){"playing"===e.jt?(e.jt="paused",$(".play_status",e._).text(e.Ut),$(".toolbar_button_play",e._).removeClass("active"),$(".toolbar_button_pause",e._).addClass("active")):"paused"===e.jt&&(e.jt="playing",$(".play_status",e._).text(e.Wt),$(".toolbar_button_play",e._).addClass("active"),$(".toolbar_button_pause",e._).removeClass("active"))});var o=$(".presets_menu",this._);$.each(this.Bt.$t,function(t,i){var s=$("<li>"),n=$("<a class='menu_item'>");n.text(i.name),n.addClass("load_preset"),n.data("preset",t),s.append(n),o.append(s)}),$(".load_preset",this.Bt._).click(function(){e.Ht(e.Bt.$t[at($(this).data("preset"))].coordinate_list)}),$(".export_svg",this._).click(function(){var t=new ut(1,1);e.Vt(t),ot("simulation.svg",t._t())}),$(".zoom_in",this._).click(function(){e.At=Math.min(1,e.At+.1),e.Vt()}),$(".zoom_out",this._).click(function(){e.At=Math.max(0,e.At-.1),e.Vt()});n=$(".simFore",e._),s="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";n.bind(s,function(t){e.Gt(t.originalEvent)}),n.mousedown(function(t){e.R(t)}),n.mouseup(function(t){e.J(t)}),n.mousemove(function(t){e.U(t)}),n.mouseleave(function(){e.J(0)}),e.Qt=!1,e.Xt=0,n.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(e.Qt=!1,e.R(t.touches[0])):2===t.touches.length&&(e.Qt=!0,e.Xt=e.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),e.Qt||e.J(0),e.Qt=!1,e.I=0},touchmove:function(t){t.preventDefault();var i=t.originalEvent;e.Qt?(t=e.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY),80<Math.abs(t-e.Xt)&&(e.Gt(i.touches[0],e.Xt-t),e.Xt=t)):e.U(i.touches[0])},touchcancel:function(t){t.preventDefault(),e.Qt||e.J(0),e.Qt=!1,e.I=0}}),setInterval(function(){e.yt()},100)}function a(t,i){var s=this;this.M=t,this._=i,this.Ct=null,this.Kt=new r,this.W(),$(".temperature",this._).change(function(){var t=parseInt($(".temperature",s._).val());t<s.M.t_min&&(t=s.M.t_min),t>s.M.t_max&&(t=s.M.t_max),$(".temperature",s._).val(t),null!==s.Ct&&s.Ct.Zt((t-s.M.t_min)/(s.M.t_max-s.M.t_min)),s.W()}),setInterval(function(){s.yt()},250)}function r(){this.qt=.45,this.Yt=[.3101,.3162],this.ti=[.3127,.3291],this.ii=[.33333333,.33333333],this.si=0,this.ni={name:"NTSC",x_red:.67,y_red:.33,x_green:.21,y_green:.71,x_blue:.14,y_blue:.08,white_point:this.Yt,gamma:this.si},this.ei={name:"EBU (PAL/SECAM)",x_red:.64,y_red:.33,x_green:.29,y_green:.6,x_blue:.15,y_blue:.06,white_point:this.ti,gamma:this.si},this.oi={name:"SMPTE",x_red:.63,y_red:.34,x_green:.31,y_green:.595,x_blue:.155,y_blue:.07,white_point:this.ti,gamma:this.si},this.hi={name:"HDTV",x_red:.67,y_red:.33,x_green:.21,y_green:.71,x_blue:.15,y_blue:.06,white_point:this.ti,gamma:this.si},this.ai={name:"CIE",x_red:.7355,y_red:.2645,x_green:.2658,y_green:.7243,x_blue:.1669,y_blue:.0085,white_point:this.ii,gamma:this.si},this.ri={name:"CIE REC 709",x_red:.64,y_red:.33,x_green:.3,y_green:.6,x_blue:.15,y_blue:.06,white_point:this.ti,gamma:this.si},this.li=3800,this.pi=50,this.ui=81,this.ci=[[.0014,0,.0065],[.0022,1e-4,.0105],[.0042,1e-4,.0201],[.0076,2e-4,.0362],[.0143,4e-4,.0679],[.0232,6e-4,.1102],[.0435,.0012,.2074],[.0776,.0022,.3713],[.1344,.004,.6456],[.2148,.0073,1.0391],[.2839,.0116,1.3856],[.3285,.0168,1.623],[.3483,.023,1.7471],[.3481,.0298,1.7826],[.3362,.038,1.7721],[.3187,.048,1.7441],[.2908,.06,1.6692],[.2511,.0739,1.5281],[.1954,.091,1.2876],[.1421,.1126,1.0419],[.0956,.139,.813],[.058,.1693,.6162],[.032,.208,.4652],[.0147,.2586,.3533],[.0049,.323,.272],[.0024,.4073,.2123],[.0093,.503,.1582],[.0291,.6082,.1117],[.0633,.71,.0782],[.1096,.7932,.0573],[.1655,.862,.0422],[.2257,.9149,.0298],[.2904,.954,.0203],[.3597,.9803,.0134],[.4334,.995,.0087],[.5121,1,.0057],[.5945,.995,.0039],[.6784,.9786,.0027],[.7621,.952,.0021],[.8425,.9154,.0018],[.9163,.87,.0017],[.9786,.8163,.0014],[1.0263,.757,.0011],[1.0567,.6949,.001],[1.0622,.631,8e-4],[1.0456,.5668,6e-4],[1.0026,.503,3e-4],[.9384,.4412,2e-4],[.8544,.381,2e-4],[.7514,.321,1e-4],[.6424,.265,0],[.5419,.217,0],[.4479,.175,0],[.3608,.1382,0],[.2835,.107,0],[.2187,.0816,0],[.1649,.061,0],[.1212,.0446,0],[.0874,.032,0],[.0636,.0232,0],[.0468,.017,0],[.0329,.0119,0],[.0227,.0082,0],[.0158,.0057,0],[.0114,.0041,0],[.0081,.0029,0],[.0058,.0021,0],[.0041,.0015,0],[.0029,.001,0],[.002,7e-4,0],[.0014,5e-4,0],[.001,4e-4,0],[7e-4,2e-4,0],[5e-4,2e-4,0],[3e-4,1e-4,0],[2e-4,1e-4,0],[2e-4,1e-4,0],[1e-4,0,0],[1e-4,0,0],[1e-4,0,0],[0,0,0]]}function l(t,i){var s=this;this.M=t,this._=i,this.Ct=null,this.Kt=new r,this.W(),$(".wavelength",this._).change(function(){var t=parseInt($(".wavelength",s._).val());t<s.M.w_min&&(t=s.M.w_min),t>s.M.w_max&&(t=s.M.w_max),$(".wavelength",s._).val(t),null!==s.Ct&&s.Ct.Zt((t-s.M.w_min)/(s.M.w_max-s.M.w_min)),s.W()}),setInterval(function(){s.yt()},250)}function p(t,i,s){return s=s||"0",(t+="").length>=i?t:new Array(i-t.length+1).join(s)+t}function y(t,i){return Math.sqrt(t*t+i*i)}function u(t,i){i=i.offset();return[t.pageX-i.left,t.pageY-i.top]}function c(t){return t.charAt(0).toUpperCase()+t.slice(1)}function g(t){return t.reduce(function(t,i){return t<i?t:i})}function M(t){return t.reduce(function(t,i){return i<t?t:i})}function d(t){t=t.toString(16);return 1==t.length?"0"+t:t}function f(t,i,s){return"#"+d(t)+d(i)+d(s)}function t(t){t=(t-dcftime.di())/86400;return 2<=t?Math.floor(t)+"&nbsp;days&nbsp;away":t<-1?Math.floor(-t)+"&nbsp;days&nbsp;ago":1<t?"1 day away":t<-1?"1 day ago":2/24<t?Math.floor(24*t)+"&nbsp;hours&nbsp;away":1/24<t?"1&nbsp;hour&nbsp;away":t<-2/24?Math.floor(24*-t)+"&nbsp;hours&nbsp;ago":t<-1/24?"1&nbsp;hour&nbsp;ago":0<t?Math.floor(24*t*60)+"&nbsp;minutes&nbsp;away":Math.floor(24*-t*60)+"&nbsp;minutes&nbsp;ago"}function i(t){for(var i=[],s=[],n=(this.data=t).tzOffset,e=0;e<n.length;e++)for(var o=n[e],h=0;h<o[0];h++)i.push(o[1]),s.push(o[2]);this.fi=i,this.yi=s,this.Rt=t.start,this.gi=i.length}function x(t,i){var s=this;this.M=t,this._=i,this.W(),$(".seed",this._).change(function(){s.W()})}function v(t,i){var s=this;this.M=t,this._=i,this.Mi=!1,this.xi=$(".holder",this._).width(),this.vi=.75,$("#my_camera").width(this.xi).height(this.xi*this.vi),Webcam.attach("#my_camera"),Webcam.on("live",function(){s.Mi=!0}),window.setInterval(function(){s._i(!1)},200),$("#snapshot_button").click(function(){s._i(!0)})}function _(t,i){var s=this;this.M=t,this._=i,$(".x0").val(t.x0),$(".y0").val(t.y0),this.mi=0,this.bi=0,this.wi=.02,this.$i(),this.Pi=new b(this,1),$(".its-img-up").click(function(){$(".y0").val(s.bi-s.wi),s.Pi.Vt(!0)}),$(".its-img-down").click(function(){$(".y0").val(s.bi+s.wi),s.Pi.Vt(!0)}),$(".its-img-left").click(function(){$(".x0").val(s.mi-s.wi),s.Pi.Vt(!0)}),$(".its-img-right").click(function(){$(".x0").val(s.mi+s.wi),s.Pi.Vt(!0)}),$(".x0, .y0").change(function(){s.Pi.Vt(!0)})}function m(t,i){var s=this;this.M=t,this._=i,this.Pi=new b(this,1),$(".simFore",this._).dblclick(function(t){s.ki(t)})}function b(t){var s=this;this.Bt=t,this.mi=this.Bt.mi,this.bi=this.Bt.bi,this.zi=4,this.Ni=25,this.Ii=!0,this.Bi=!1,this.Si=[0,0,0,255],this.I=!1,s.D(),s.dt(),$(window).resize(function(){s.dt()}),$("input, select",this.Bt._).change(function(){$(this).hasClass("maxIterations")&&$(".autoIterations").prop("checked",!1),s.Vt()}),$(".reset",this.Bt._).click(function(){s.D(),s.dt()}),$(".export_png",this.Bt._).click(function(){var t=$(".simBuf",s.Bt._)[0].toDataURL("image/png");window.open(t,"_blank")}),$(".zoom_in",this.Bt._).click(function(){s.Ei*=.66,s.Ci*=.66,s.Vt()}),$(".zoom_out",this.Bt._).click(function(){s.Ei/=.66,s.Ci/=.66,s.Vt()});var i=$(".simFore",s.Bt._),t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";i.bind(t,function(t){s.Gt(t.originalEvent)}),i.mousedown(function(t){s.R(t)}),i.mouseup(function(t){s.J(t)}),i.mousemove(function(t){s.U(t)}),i.mouseleave(function(){s.J(0)}),s.Qt=!1,s.Xt=0,i.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(s.Qt=!1,s.R(t.touches[0])):2===t.touches.length&&(s.Qt=!0,s.Xt=s.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),s.Qt||s.J(0),s.Qt=!1,s.I=0},touchmove:function(t){t.preventDefault();var i=t.originalEvent;s.Qt?(t=s.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY),80<Math.abs(t-s.Xt)&&(s.Gt(i.touches[0],s.Xt-t),s.Xt=t)):s.U(i.touches[0])},touchcancel:function(t){t.preventDefault(),s.Qt||s.J(0),s.Qt=!1,s.I=0}}),setInterval(function(){s.yt()},100)}function w(t,i,s,n,e){var o=i.width(),h=i.height();void 0===n&&(n=0),void 0===e&&(e=0);var a,r,n=n%(10*s),e=e%(10*s),l=t;for((l=l||new lt(i[0],1,1)).dt(o,h),l.Ai("#aff",1),l.Fi(),a=n-10*s;a<=o;a+=s)l.Li(a,0),l.Oi(a,h);for(r=e-10*s;r<=h;r+=s)l.Li(0,r),l.Oi(o,r);for(l.Di(),l.Ai("#6ff",1),l.Fi(),a=n-10*s;a<=o;a+=10*s)l.Li(a,0),l.Oi(a,h);for(r=e-10*s;r<=h;r+=10*s)l.Li(0,r),l.Oi(o,r);l.Di()}function P(t,i,s,n,e){var o=this;this.element=t,this.canvas=document.createElement("canvas"),this.reset(this.element.width(),this.element.height()),this.Ti=0,this.ji=0,this.Ri=s,this.Ji=n,this.Ui=e,this.Wi=i,e&&t.on({dblclick:function(t){o.dblClickHandle(t)}}),n&&t.on({mousedown:function(t){o.clickHandle(t)},touchstart:function(t){t.preventDefault();t=t.originalEvent;o.clickHandle(t.touches[0])}}),s&&t.on({mousemove:function(t){o.hoverHandle(t)},touchmove:function(t){t.preventDefault();t=t.originalEvent;o.hoverHandle(t.touches[0])},mouseout:function(){o.hoverHandle(null)},touchend:function(t){t.preventDefault(),o.hoverHandle(null)},touchcancel:function(t){t.preventDefault(),o.hoverHandle(null)}})}function k(t,i){var n=this;this.M=t,this._=i,this.Hi=10,this.X=.1,this.K=.025;i=$(".simFore",this._);this.Vi=null,this.lt=new P(i,!1,function(t,i,s){n.ut(t,i,s)},function(t,i,s){n.ct(t,i,s)}),n.dt(),n.Gi(),$(window).resize(function(){n.dt()}),$("input",this._).change(function(){n.Qi()}),i.on({mouseup:function(){n.xt()},mouseout:function(){n.xt()},touchend:function(t){t.preventDefault(),n.xt()},touchcancel:function(t){t.preventDefault(),n.xt()}}),setInterval(function(){n.yt()},1e3*n.X),$(".btn-randomize",this._).click(function(){n.Gi()}),$(".btn-nacl",this._).click(function(){$(".charge_a",n._).val(1),$(".charge_b",n._).val(-1),$(".radius_a",n._).val(1),$(".radius_b",n._).val(1),n.Gi()}),$(".btn-cscl",this._).click(function(){$(".charge_a",n._).val(1),$(".charge_b",n._).val(-1),$(".radius_a",n._).val(2),$(".radius_b",n._).val(1),n.Gi()}),$(".btn-ch4",this._).click(function(){$(".charge_a",n._).val(4),$(".charge_b",n._).val(-1),$(".radius_a",n._).val(1),$(".radius_b",n._).val(1),n.Gi()}),$(".btn-export",this._).click(function(){var t=new ut(1,1);w(t,$(".simBack",n._),n.Hi);var i=new ut(1,1);n.vt(i),t.Xi(i),ot("simulation.svg",t._t())})}function z(t,i){var s,n=this;for(this.M=t,this._=i,this.Hi=10,this.Ki=null,this.Zi=at(this.M.number_lenses),this.qi=!0,this.Yi=!0,this.ts=parseFloat(t.f_min),this.ss=parseFloat(t.f_max),this.ns=1.9,this.es=100,this.os=8,this.hs=.33*$(".simulation_canvas",this._).width(),this.rs=this.es/2,this.ls=this.hs/2,this.ps=[];this.ps.length<this.Zi;)this.ps.push({position:this.hs,enabled:0===this.ps.length,focal_length:this.M.focal_length_a,concave:!1,slider:null});t=$(".simFore",this._);for(this.lt=new P(t,!1,function(t,i,s){n.ut(t,i,s)},function(t,i,s){n.ct(t,i,s)}),n.dt(),$(window).resize(function(){n.dt()}),$(".btn-add-lens",this._).click(function(){n.us()}),s=0;s<this.Zi;s++)!function(t){$(".btn-remove-lens-"+t,n._).click(function(){n.Yi&&(n.ps[t].enabled=!1,n.xt())}),$(".type_"+t,n._).change(function(){n.ps[t].concave="Concave"===$(this).val(),n.xt()}),$(".focal_length_"+t,n._).change(function(){n.ps[t].focal_length=Math.min(Math.max($(this).val(),n.ts),n.ss),n.xt()})}(s);$(".show_virtual, .source",this._).change(function(){n.W()}),t.on({mouseup:function(){n.xt()},mouseout:function(){n.xt()},touchend:function(t){t.preventDefault(),n.xt()},touchcancel:function(t){t.preventDefault(),n.xt()}}),setInterval(function(){n.yt()},100),$(".btn-export",this._).click(function(){var t=new ut(1,1);w(t,$(".simBack",n._),n.Hi,n.cs/2,n.ds/2);var i=new ut(1,1);n.W(i),t.Xi(i),ot("simulation.svg",t._t())})}function N(t,i){var n=this;this.M=t,this._=i,this.Hi=10,this.fs=!1,this.ys=null,this.gs=null,this.Ms=1,this.xs=1,this.vs=0,this._s=[],this.bs=[0,0,0],this.ws=[0,0];var s=$(".simFore",this._);this.lt=new P(s,!1,function(t,i,s){n.ut(t,i,s)},function(t,i,s){n.ct(t,i,s)}),n.dt();t=n.cs/8,i=n.cs/8;n.$s=Math.pow(1.2*new R(300,-300,0).Ps(),2)*new R(t,i,0).Ps(),n.ks(t+n.cs/2,i+n.ds/2,300,-300,!1),$(window).resize(function(){n.dt()}),$(".btn-reduce-v",this._).click(function(){var t=n.vs,i=n.zs(n.ys,t),t=n.zs(n.ys,t+1e-4);n.ks(i.x+n.cs/2,i.y+n.ds/2,(t.x-i.x)/1e-4*n.Ms*.95,(t.y-i.y)/1e-4*n.Ms*.95,!1)}),$(".btn-increase-v",this._).click(function(){var t=n.vs,i=n.zs(n.ys,t),t=n.zs(n.ys,t+1e-4);n.ks(i.x+n.cs/2,i.y+n.ds/2,(t.x-i.x)/1e-4*n.Ms*1.05,(t.y-i.y)/1e-4*n.Ms*1.05,!1)}),s.on({mouseup:function(){n.xt()},mouseout:function(){n.xt()},touchend:function(t){t.preventDefault(),n.xt()},touchcancel:function(t){t.preventDefault(),n.xt()}}),setInterval(function(){n.yt()},50),$(".btn-export",this._).click(function(){var t=new ut(1,1);w(t,$(".simBack",n._),n.Hi,n.cs/2,n.ds/2);var i=new ut(1,1);n.W(i),t.Xi(i),ot("simulation.svg",t._t())})}function I(t,i){var s=this;this.M=t,this._=i,this.W(),$(".seed",this._).change(function(){s.W()})}function B(t,i){var g=this;this.M=t,this.$t=S,this._=i,this.Ns=[255,0,0],this.Is=[0,0,255],this.Bs=200,this.Ss={resistance_internal:1,resistance_internal_high:100},this.Es=null,this.Cs=null,this.As=null,this.Fs="electronics",this.Ls={0:{id:0,stringLike:!0,name:"wire",shortName:["","Wire"],size:[8,0],nodePositions:[[0,0],[8,0]],drawInstructions:[["line_colored",[0,0],[8,0],[1,0],[0,1]]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=n/g.Ss.resistance_internal;t.voltage=n,t.current=e,i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e},hook_updateState:null},10:{id:10,stringLike:!1,name:"button",shortName:["","Button"],size:[8,3],nodePositions:[[0,3],[8,3]],drawInstructions:[["line_colored",[0,3],[2.5,3],[1,0],[1,0]],["line_colored",[5.5,3],[8,3],[0,1],[0,1]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,3],.4],["line_open",[[2.5,1.5],[5.5,1.5]]],["line_open",[[4,1.5],[4,0]]]],drawInstructions_variants:[[["line_colored",[0,3],[2.5,3],[1,0],[1,0]],["line_colored",[5.5,3],[8,3],[0,1],[0,1]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,3],.4],["line_open",[[2.5,3],[5.5,3]]],["line_open",[[4,3],[4,1.5]]]]],htmlBelow:'<input class="btn btn-success clickable" type="button" value="Appuyer" />',hook_initialise:function(t,i){t.pushTimer=0,t.variantState=null},hook_setCurrent:function(t,i){var s,n=g.Os(t,i),e=0;0<t.pushTimer&&(s=t.id,e=n/g.Ss.resistance_internal,i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e),t.voltage=n,t.current=e},hook_updateState:function(t,i){0<t.pushTimer?--t.pushTimer:t.variantState=null},hook_buttonClick:function(t,i){t.pushTimer=6,t.variantState=0}},11:{id:11,stringLike:!1,name:"switch",shortName:["","Switch"],size:[8,3],nodePositions:[[0,3],[8,3]],drawInstructions:[["line_colored",[0,3],[2.5,3],[1,0],[1,0]],["line_colored",[5.5,3],[8,3],[0,1],[0,1]],["line_colored",[2.5,3],[5,1],[1,0],[1,0]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,3],.4]],drawInstructions_variants:[[["line_colored",[0,3],[8,3],[1,0],[0,1]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,3],.4]]],htmlBelow:'<input class="btn btn-success clickable" type="button" value="Appuyer" />',hook_initialise:function(t,i){t.switchState=!1,t.variantState=null},hook_setCurrent:function(t,i){var s,n=g.Os(t,i),e=0;t.switchState&&(s=t.id,e=n/g.Ss.resistance_internal,i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e),t.voltage=n,t.current=e},hook_updateState:null,hook_buttonClick:function(t,i){t.switchState=!t.switchState,t.variantState=t.switchState?0:null}},12:{id:12,stringLike:!1,name:"two-pole switch",shortName:["Two-pole","Switch"],size:[8,5],nodePositions:[[0,3],[8,2],[8,4]],drawInstructions:[["line_colored",[0,3],[2.5,3],[1,0,0],[1,0,0]],["line_colored",[5.5,2],[8,2],[0,1,0],[0,1,0]],["line_colored",[5.5,4],[8,4],[0,0,1],[0,0,1]],["line_colored",[2.5,3],[5.5,2],[1,0,0],[1,0,0]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,2],.4],["circle_filled",[5.5,4],.4]],drawInstructions_variants:[[["line_colored",[0,3],[2.5,3],[1,0,0],[1,0,0]],["line_colored",[5.5,2],[8,2],[0,1,0],[0,1,0]],["line_colored",[5.5,4],[8,4],[0,0,1],[0,0,1]],["line_colored",[2.5,3],[5.5,4],[1,0,0],[1,0,0]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,2],.4],["circle_filled",[5.5,4],.4]]],htmlBelow:'<input class="btn btn-success clickable" type="button" value="Appuyer" />',hook_initialise:function(t,i){t.switchState=!1,t.variantState=null},hook_setCurrent:function(t,i){var s,n=t.id,e=0,o=0;t.switchState?(s=i[t.nodeNames[0]][0],o=(e=i[t.nodeNames[2]][0]-s)/g.Ss.resistance_internal,i[t.nodeNames[0]][1][n]=o,i[t.nodeNames[2]][1][n]=-o):(o=(e=g.Os(t,i))/g.Ss.resistance_internal,i[t.nodeNames[0]][1][n]=o,i[t.nodeNames[1]][1][n]=-o),t.voltage=e,t.current=o},hook_updateState:null,hook_buttonClick:function(t,i){t.switchState=!t.switchState,t.variantState=t.switchState?0:null}},20:{id:20,stringLike:!1,name:"battery",shortName:["","Battery"],size:[5,4],nodePositions:[[0,2],[5,2]],drawInstructions:[["line_colored",[0,2],[2.2,2],[1,0],[1,0]],["line_colored",[3,2],[5,2],[0,1],[0,1]],["line_open",[[3,0],[3,4]]],["line_open",[[2.2,1],[2.2,3]]],["line_open",[[2.3,1],[2.3,3]]]],settings:[{name:"voltage",description:"Battery voltage",heading:"Battery voltage",render_value:function(t){return t.toFixed(1)+" V"},min:1.5,max:20,scale:"linear",default:12}],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=(n-t.settings.voltage)/g.Ss.resistance_internal;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:null},21:{id:21,stringLike:!1,name:"alternating input",shortName:["Alternat.","Input"],size:[7,4],nodePositions:[[0,2],[7,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[5,2],[7,2],[0,1],[0,1]],["circle",[3.5,2],1.5],["bezier",[2.4,2],[3.5,2],[2.5,1.6],[3.4,1.6]],["bezier",[3.5,2],[4.6,2],[3.6,2.4],[4.5,2.4]]],settings:[{name:"voltage",description:"Amplitude / V",heading:"Amplitude",render_value:function(t){return t.toFixed(1)+" V"},min:1.5,max:20,scale:"linear",default:12},{name:"period",description:"Period / sec",heading:"Period",render_value:function(t){return t.toFixed(1)+" s"},min:.25,max:5,scale:"linear",default:2}],htmlBelow:null,hook_initialise:function(t,i){t.timecount=0,t.output_voltage=0},hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=(n-t.output_voltage)/g.Ss.resistance_internal;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:function(t,i){var s=(new Date).getTime();t.hasOwnProperty("timePrevious")||(t.timePrevious=s),t.timecount+=(s-t.timePrevious)/1e3*2*Math.PI/t.settings.period,t.timePrevious=s,t.output_voltage=t.settings.voltage*Math.sin(t.timecount)}},30:{id:30,stringLike:!1,name:"Resistor",shortName:["","Resistor"],size:[8,4],nodePositions:[[0,2],[8,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[6,2],[8,2],[0,1],[0,1]],["line_open",[[2,1],[2,3],[6,3],[6,1],[2,1]]]],hook_customDraw:function(t,i,s,n,e,o,h){h=1e3*h.settings.resistance,n+=4*o,e+=4.5*o;t.Ds("#000000");o="-",o=h<1e3?h.toFixed(0)+" Ω":h<1e6?(h/1e3).toFixed(1)+" kΩ":(h/1e6).toFixed(1)+" MΩ";t.Ts(n,e,0,0,1,o,0,0)},settings:[{name:"resistance",description:"Resistance / kΩ",heading:"Resistance",render_value:function(t){return t.toFixed(1)+" kΩ"},min:.5,max:5,scale:"linear",default:1.5}],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=n/(1e3*t.settings.resistance);i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:null},31:{id:31,stringLike:!1,name:"Capacitor",shortName:["","Capacitor"],size:[8,4],nodePositions:[[0,2],[8,2]],drawInstructions:[["line_colored",[0,2],[3.5,2],[1,0],[1,0]],["line_colored",[4.5,2],[8,2],[0,1],[0,1]],["line_open",[[3.5,0],[3.5,4]]],["line_open",[[4.5,0],[4.5,4]]]],hook_customDraw:function(t,i,s,n,e,o,h){h=h.settings.capacitance,n+=4*o,o=e+5*o;t.Ds("#000000");h=h.toFixed(1)+" mF";t.Ts(n,o,0,0,1,h,0,0)},settings:[{name:"capacitance",description:"Capacitance / mF",heading:"Capacitance",render_value:function(t){return t.toFixed(1)+" mF"},min:.5,max:10,scale:"linear",default:2}],hook_initialise:function(t,i){t.storedCharge=0},hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=(n-t.storedCharge/(.001*t.settings.capacitance))/g.Ss.resistance_internal_high;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:function(t,i){var s=(new Date).getTime();t.hasOwnProperty("timePrevious")||(t.timePrevious=s);var n=(s-t.timePrevious)/1e3;t.timePrevious=s;var e=t.current,o=t.storedCharge,s=o+e*n,e=Math.abs(s/(.001*t.settings.capacitance)),n=1.2*(g.js+.001);n<e&&(s*=n/e),(0<s&&o<0||s<0&&0<o)&&(s=0),t.storedCharge=s}},35:{id:35,stringLike:!1,name:"OpAmp",shortName:["","OpAmp"],size:[6,6],nodePositions:[[0,2],[0,4],[3,0],[3,6],[6,3]],drawInstructions:[["line_colored",[0,2],[1,2],[1,0,0,0,0],[1,0,0,0,0]],["line_colored",[0,4],[1,4],[0,1,0,0,0],[0,1,0,0,0]],["line_colored",[3,0],[3,1.5],[0,0,1,0,0],[0,0,1,0,0]],["line_colored",[3,6],[3,4.5],[0,0,0,1,0],[0,0,0,1,0]],["line_colored",[5,3],[6,3],[0,0,0,0,1],[0,0,0,0,1]],["line_closed",[[1,0],[1,6],[5,3]]],["text",[2,2],"+"],["text",[2,4],"–"]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=i[t.nodeNames[0]][0],e=i[t.nodeNames[1]][0],o=i[t.nodeNames[2]][0],h=i[t.nodeNames[3]][0],a=i[t.nodeNames[4]][0],e=25*(n-e)+(h+o)/2;o<e&&(e=o),e<h&&(e=h);e=(e-a)/(.5*g.Ss.resistance_internal);i[t.nodeNames[0]][1][s]=0,i[t.nodeNames[1]][1][s]=0,i[t.nodeNames[2]][1][s]=-e/2,i[t.nodeNames[3]][1][s]=-e/2,i[t.nodeNames[4]][1][s]=e,t.voltage=a,t.current=e},hook_updateState:null},40:{id:40,stringLike:!1,name:"NPN Transistor",shortName:["Transistor","NPN"],size:[8,8],nodePositions:[[0,4],[5,0],[5,8]],drawInstructions:[["line_colored",[0,4],[3.5,4],[1,0,0],[1,0,0]],["line_colored",[5,0],[5,1.71],[0,1,0],[0,1,0]],["line_colored",[5,8],[5,6.29],[0,0,1],[0,0,1]],["circle",[4,4],2.5],["line_open",[[3.5,2.8],[3.5,5.2]]],["line_open",[[3.4,2.8],[3.4,5.2]]],["line_open",[[3.5,3.6],[5,1.71]]],["line_open",[[3.5,4.4],[5,6.29]]],["arrow",[3.5,4.4],[4.5,5.66]]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=i[t.nodeNames[0]][0],e=i[t.nodeNames[1]][0],o=n-i[t.nodeNames[2]][0],h=n-e,a=.026;a+=.5;n=1e-8*(Math.exp(o/a)-Math.exp(h/a)-(Math.exp(h/a)-1)/10),e=1e-8*((Math.exp(o/a)-1)/50+(Math.exp(h/a)-1)/10),a=1e-8*(Math.exp(o/a)-Math.exp(h/a)+(Math.exp(o/a)-1)/50);i[t.nodeNames[0]][1][s]=-e,i[t.nodeNames[1]][1][s]=-n,i[t.nodeNames[2]][1][s]=a,t.voltage=o-h,t.current=n},hook_updateState:null},49:{id:49,stringLike:!1,name:"Diode",shortName:["","Diode"],size:[8,4],nodePositions:[[0,2],[8,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[5.5,2],[8,2],[0,1],[0,1]],["line_closed",[[2,0],[2,4],[5.5,2]]],["line_open",[[5.5,0],[5.5,4]]]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=-.65<n?(n- -.65)/1e5:n- -.65;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:null},80:{id:80,stringLike:!1,name:"Lamp",shortName:["","Lamp"],size:[8,4],nodePositions:[[0,2],[7,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[5,2],[7,2],[0,1],[0,1]],["circle",[3.5,2],1.5],["line_open",[[3.5-1.5*Math.sin(Math.PI/4),2-1.5*Math.cos(Math.PI/4)],[3.5+1.5*Math.sin(Math.PI/4),2+1.5*Math.cos(Math.PI/4)]]],["line_open",[[3.5-1.5*Math.sin(Math.PI/4),2+1.5*Math.cos(Math.PI/4)],[3.5+1.5*Math.sin(Math.PI/4),2-1.5*Math.cos(Math.PI/4)]]]],hook_customDraw:function(t,i,s,n,e,o,h){h.hasOwnProperty("current")&&(n=n+3.5*o,e=e+2*o,o=1.5*o,(h=Math.abs(h.current/.05))<0&&(h=0),1<h&&(h=1),t.Ds(g.Pi.Rs([1-h,h],[[0,0,0],[255,255,0]],1)),t.Fi(),t.Js(n,e,o,0,2*Math.PI,!1),t.Us())},hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=n/100;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:null},81:{id:81,stringLike:!1,name:"LED",shortName:["","LED"],size:[8,4],nodePositions:[[0,2],[8,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[5.5,2],[8,2],[0,1],[0,1]],["line_closed",[[2,0],[2,4],[5.5,2]]],["line_open",[[5.5,0],[5.5,4]]],["arrow",[3,.25],[4,-.75]],["arrow",[4,.5],[5,-.5]]],drawInstructions_variants:[[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[5.5,2],[8,2],[0,1],[0,1]],["line_closed",[[2,0],[2,4],[5.5,2]]],["line_open",[[5.5,0],[5.5,4]]],["arrow",[3,.25],[4,-.75]],["arrow",[4,.5],[5,-.5]],["circle_filled",[3.3,2],.75,"red"]]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=-.65<n?(n- -.65)/1e5:n- -.65;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:function(t,i){t.variantState=null,t.hasOwnProperty("current")&&t.current<-.001&&(t.variantState=0)}},97:{id:97,stringLike:!1,name:"ammeter",shortName:["","Ammeter"],size:[10,6],nodePositions:[[3,0],[7,0]],drawInstructions:[["line_colored",[3,0],[3,2],[1,0],[1,0]],["line_colored",[7,0],[7,2],[0,1],[0,1]],["line_filled",[[0,2],[0,6],[10,6],[10,2]]],["text",[8,4],"A","#00FF00"]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=n/g.Ss.resistance_internal;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:null,hook_customDraw:function(t,i,s,n,e,o,h){h.hasOwnProperty("current")&&(h=h.current,n=n+4.5*o,o=e+4*o,t.Ds("#00FF00"),t.Ts(n,o,0,0,1,g.Ws(h),0,0))}},98:{id:98,stringLike:!1,name:"voltmeter",shortName:["","Voltmeter"],size:[10,6],nodePositions:[[3,0],[7,0]],drawInstructions:[["line_colored",[3,0],[3,2],[1,0],[1,0]],["line_colored",[7,0],[7,2],[0,1],[0,1]],["line_filled",[[0,2],[0,6],[10,6],[10,2]]],["text",[8,4],"V","#00FF00"]],hook_initialise:null,hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=n/1e5;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:null,hook_customDraw:function(t,i,s,n,e,o,h){h.hasOwnProperty("voltage")&&(h=h.voltage,n=n+4.5*o,o=e+4*o,t.Ds("#00FF00"),t.Ts(n,o,0,0,1,g.Ws(h),0,0))}},99:{id:99,stringLike:!1,name:"oscilloscope",shortName:["","Oscillosc."],size:[15,12],nodePositions:[[3,0],[7,0]],drawInstructions:[["line_colored",[3,0],[3,2],[1,0],[1,0]],["line_colored",[7,0],[7,2],[0,1],[0,1]],["line_filled",[[0,2],[0,12],[15,12],[15,2]]]],hook_initialise:function(t,i){for(var s=[],n=0;n<100;n++)s.push(0);t.historyLen=100,t.data=s},hook_setCurrent:function(t,i){var s=t.id,n=g.Os(t,i),e=n/1e5;i[t.nodeNames[0]][1][s]=e,i[t.nodeNames[1]][1][s]=-e,t.voltage=n,t.current=e},hook_updateState:function(t,i){var s=t.data;s.push(t.voltage),s.shift()},hook_customDraw:function(t,i,s,n,e,o,h){var a;if(h.hasOwnProperty("data")){var r=h.data,l=r.length,p=n+.5*o,u=14*o/l,c=e+11*o,d=e+3*o-c,f=2*g.js+.001;for(t.Ai("#00FF00",1.5),t.Fi(),t.Li(p,c+(r[0]/f+.5)*d),a=1;a<l;a++)t.Oi(p+a*u,c+(r[a]/f+.5)*d);t.Di()}}},991:{id:991,stringLike:!1,name:"dual_oscilloscope",shortName:["Two-input","Oscillosc."],size:[15,12],nodePositions:[[3,0],[7,0],[11,0]],drawInstructions:[["line_colored",[3,0],[3,2],[1,0,0],[1,0,0]],["line_colored",[7,0],[7,2],[0,1,0],[0,1,0]],["line_colored",[11,0],[11,2],[0,0,1],[0,0,1]],["line_filled",[[0,2],[0,12],[15,12],[15,2]]],["text",[3,2.7],"-","#00FF00"],["text",[7,2.7],"A","#00FF00"],["text",[11,2.7],"B","#0080FF"]],hook_initialise:function(t,i){for(var s=[],n=[],e=0;e<100;e++)s.push(0);for(e=0;e<100;e++)n.push(0);t.historyLen=100,t.data_grn=s,t.data_blu=n},hook_setCurrent:function(t,i){var s=t.id,n=i[t.nodeNames[0]][0],e=(i[t.nodeNames[1]][0]-n)/1e5,n=(i[t.nodeNames[2]][0]-n)/1e5;i[t.nodeNames[0]][1][s]=e+n,i[t.nodeNames[1]][1][s]=-e,i[t.nodeNames[2]][1][s]=-n},hook_updateState:function(t,i){var s=i[t.nodeNames[0]][0],n=i[t.nodeNames[1]][0],e=i[t.nodeNames[2]][0],i=t.data_grn,t=t.data_blu;i.push(n-s),t.push(e-s),i.shift(),t.shift()},hook_customDraw:function(t,i,s,n,e,o,h){var a;if(h.hasOwnProperty("data_grn")){var r=h.data_grn,l=h.data_blu,p=r.length,u=n+.5*o,c=14*o/p,d=e+11*o,f=e+3*o-d,y=2*g.js+.001;for(t.Ai("#00FF00",1.5),t.Fi(),t.Li(u,d+(r[0]/y+.5)*f),a=1;a<p;a++)t.Oi(u+a*c,d+(r[a]/y+.5)*f);for(t.Di(),t.Ai("#0080FF",1.5),t.Fi(),t.Li(u,d+(l[0]/y+.5)*f),a=1;a<p;a++)t.Oi(u+a*c,d+(l[a]/y+.5)*f);t.Di()}}}},this.Pi=new A(this,1)}n.prototype.D=function(){this.S=0,this.C=null,this.A=null,this.F=[],this.L=[],this.O=[],this.H(),this.W()},n.prototype.H=function(){var t=this.P,i=0,s=0;null!==this.C&&(s=(i=t-this.C)-this.A),this.F.push([this.S,t]),this.L.push([this.S,i]),this.O.push([this.S,s]),this.C=t,this.A=i},n.prototype.R=function(t){t=u(t,$(".car_track",this._));this.B=t[0],this.I=!0},n.prototype.U=function(t){var i;this.I&&(t=(i=u(t,$(".car_track",this._)))[0]-this.B,isFinite(t)&&(this.B=i[0],this.P+=t,this.cs=$(".car_track",this._).width(),this.P<this.$&&(this.P=this.$),this.P>this.cs-this.$&&(this.P=this.cs-this.$),this.T()))},n.prototype.J=function(t){this.U(t),this.I=!1},n.prototype.T=function(){$(".car_holder",this._).css("left",this.P+"px")},n.prototype.W=function(){for(var t=$(this._).width(),i=t-150,s=Math.min(.25*i,160),n=s/i,e=s+60,s=10*Math.ceil((this.S+.01)/10),o=[],h=0;h<this.O.length-3;h++){for(var a=0,r=0;r<3;r++)a+=this.O[h+r][1];o.push([this.O[h][0],a/3])}this.Hs=new yt({plot_p:new bt([new xt("plot",{plotStyle:"lines"},this.F,null)],{width:i,aspect:n,origin:[0,0*e],x1_axis:{label:"Time (seconds)",min:0,max:s},y1_axis:{min:0,max:t,label:"Displacement (pixels)"}}),plot_v:new bt([new xt("plot",{plotStyle:"lines"},this.L,null)],{width:i,aspect:n,origin:[0,+e],x1_axis:{label:"Time (seconds)",min:0,max:s},y1_axis:{min:-t/3,max:t/3,label:"Velocity (pixels/sec)"}}),plot_a:new bt([new xt("plot",{plotStyle:"lines"},o,null)],{width:i,aspect:n,origin:[0,2*e],x1_axis:{label:"Time (seconds)",min:0,max:s},y1_axis:{min:-t/6,max:t/6,label:"Acceleration(pixel/sec²)"}})},{}),this.Hs.renderToCanvas($(".graphs",this._)[0])},$(function(){$(".acceleration_demo").each(function(t,i){var s=$(i),i=new n(s.data("meta"),s);s.data("handler",i)})}),e.prototype.dt=function(){var t=$(".Bbuff",this._);this.cs=t.parent().width(),this.ds=this.cs*this.G,this.Vs()},e.prototype.vt=function(t){var i=this,s=i.n_balls,n=$(".Bbuff",this._),e=t;(e=e||new lt(n[0],1,1)).dt(i.cs,i.ds),this.lt.reset();for(var o=0;o<s;o++){var h=i.balls[o],a=h.x*i.cs,r=i.ds-h.y*i.cs;e.Ds(h.col),e.Fi(),e.Js(a,r,h.r*i.cs,0,2*Math.PI,!1),e.Us(),i.lt.hoverCircle(o+1e3,a,r,h.r*i.cs+6)}},e.prototype.Gs=function(){for(var t,i,s,n=this,e=n.n_balls,o=n.gravity,h=n.K,a=.5*o*Math.pow(h,2),r=[],l=0;l<16;l++){for(var p=[],u=0;u<16;u++)p.push([]);r.push(p)}for(l=0;l<e;l++)l!==this.rt&&((t=n.balls[l]).x+=t.vx*h,t.y+=t.vy*h+a,t.vy-=o*h,t.x<t.r&&t.vx<0&&(t.vx*=-1),t.x>t.rr&&0<t.vx&&(t.vx*=-1),t.y<t.r&&t.vy<0&&(t.vy*=-1),t.y>t.rrr&&0<t.vy&&(t.vy*=-1),16<=(S=Math.floor(16*t.x))&&(S=15),S<0&&(S=0),16<=(s=Math.floor(16*t.y))&&(s=15),s<0&&(s=0),r[s][S].push(l));if(n.collisions)for(l=0;l<e;l++){t=n.balls[l],13<(S=Math.floor(16*t.x)-1)&&(S=13),S<0&&(S=0),13<(s=Math.floor(16*t.y)-1)&&(s=13),s<0&&(s=0);for(var c=S;c<=S+2;c++)for(var d=s;d<=s+2;d++)for(var f=0;f<r[d][c].length;f++){var y,g,M,x,v,_,m,b=r[d][c][f];b!==l&&(v=(m=(y=n.balls[b]).x-t.x)*m+(x=y.y-t.y)*x,(M=t.r+y.r)*M<v||(g=x/(_=Math.sqrt(v)),(M=(b=m/_)*t.vx+g*t.vy)-(x=b*y.vx+g*y.vy)<0||(v=t.m,_=(2*(m=y.m)*x-m*M+v*M)/(v+m),m=(2*v*M-v*x+m*x)/(v+m),t.vx+=(_-M)*b,t.vy+=(_-M)*g,y.vx+=(m-x)*b,y.vy+=(m-x)*g)))}}var w=.995,$=n.Z,P=[];for(l=0;l<$;l++)P.push(0);for(l=0;l<e;l++)t=n.balls[l],(S=Math.floor(t.y/n.G*$))<0&&(S=0),$<=S&&(S=$-1),P[S]+=t.m;for(l=0;l<$;l++)n.it[l][1]=w*n.it[l][1]+(1-w)*P[l];var k=n.tt,z=[];for(l=0;l<k;l++)z.push(0);for(l=0;l<e;l++)t=n.balls[l],i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),(S=Math.floor(i/.2*k))<0&&(S=0),k<=S||(z[S]+=1);for(l=0;l<k;l++)n.et[l][1]=w*n.et[l][1]+(1-w)*z[l];var N=n.Y,I=[];for(l=0;l<N;l++)I.push(0);var B=[];for(l=0;l<N;l++)B.push(.001);for(l=0;l<e;l++){var S,E=.5*(t=n.balls[l]).m*(t.vx*t.vx+t.vy*t.vy);(S=Math.floor((t.m-1)/4*N))<0&&(S=0),N<=S&&(S=N-1),I[S]+=E,B[S]+=1}for(l=0;l<N;l++)n.st[l][1]=w*n.st[l][1]+(1-w)*I[l],n.nt[l][1]=w*n.nt[l][1]+(1-w)*B[l]},e.prototype.yt=function(){for(var t=0;t<4;t++)this.Gs();this.vt()},e.prototype.gt=function(){var t=this.graphs_initialised;t?(this.Qs.itemList.plot.dataSets[0].data=this.it,this.Qs.needs_refresh=!0):(this.Qs=new yt({plot:new bt([new xt("plot",{plotStyle:"linespoints"},this.it,null)],{interactiveMode:"pan",aspect:.5,x1_axis:{label:"Height",scrollMin:0,scrollMax:this.Z,scrollEnabled:!0,zoomEnabled:!0,min:0,max:this.Z},y1_axis:{label:"Mass distribution",min:0}})},{}),this.Qs.renderToCanvas($(".Hgraphbuff",this._)[0])),t?(this.Xs.itemList.plot.dataSets[0].data=this.et,this.Xs.needs_refresh=!0):(this.Xs=new yt({plot:new bt([new xt("plot",{plotStyle:"linespoints"},this.et,null)],{interactiveMode:"pan",aspect:.5,x1_axis:{label:"Velocity",scrollMin:0,scrollMax:this.tt,scrollEnabled:!0,zoomEnabled:!0,min:0,max:this.tt},y1_axis:{label:"Number of balls",min:0}})},{}),this.Xs.renderToCanvas($(".Vgraphbuff",this._)[0]));for(var i=[],s=0;s<this.Y;s++)i.push([s,this.st[s][1]/this.nt[s][1]]);t?(this.Ks.itemList.plot.dataSets[0].data=i,this.Ks.needs_refresh=!0):(this.Ks=new yt({plot:new bt([new xt("plot",{plotStyle:"linespoints"},i,null)],{interactiveMode:"pan",aspect:.5,x1_axis:{label:"Mass of ball",scrollMin:0,scrollMax:this.Y,scrollEnabled:!0,zoomEnabled:!0,min:0,max:this.Y},y1_axis:{label:"Average kinetic energy",min:0}})},{}),this.Ks.renderToCanvas($(".KEgraphbuff",this._)[0])),this.graphs_initialised=!0},e.prototype.Zs=function(){for(var t=this.n_balls,i=this.gravity,s=0,n=0,e=0;e<t;e++){var o=this.balls[e];s+=o.m*i*o.y,n+=.5*o.m*(o.vx*o.vx+o.vy*o.vy)}return[s,n]},e.prototype.Mt=function(){var t=this,i=t.n_balls,s=t.Zs();t.ot<2&&(t.ot=2);var n=t.targetEnergy*(t.at+t.ot*(t.ht-t.at)/300),e=2*s[1]-n,n=(s[1]-e)/s[1];n<.9&&(n=.9),1.1<n&&(n=1.1),n=Math.pow(n,.3);for(var o=Math.sqrt(n),h=0;h<i;h++){var a=t.balls[h];a.vx*=o,a.vy*=o}e=2*s[1]*n/t.targetEnergy,s=$(".Tindicator")[0],n=t.ds-20;s.height=t.ds;s=s.getContext("2d");s.beginPath();e=13+n/(t.at-t.ht)*(e-t.ht);s.fillStyle="#ff2020",s.fillRect(21,e,5,13+n-e)},e.prototype.ft=function(){var t=this,i=parseInt($(".nballs").val()),s=parseInt($(".massdist").val()),n=parseInt($(".sizedist").val()),e=parseInt($(".collisions").val()),o=parseInt($(".gravity").val());t.n_balls=i,t.collisions=e,t.gravity=.02*o;for(var h=[],a=0;a<i;a++){var r={x:Math.random(),y:.01+Math.random()*t.G*.7,vx:.1*(.5-Math.random()),vy:.1*(.5-Math.random()),m:1,r:.01,col:"#ff00ff"},l=0;0===s?l=r.m=1:1===s?(r.m=Math.floor(2*Math.random()+1),l=2):2===s?(r.m=Math.floor(3*Math.random()+1),l=3):3===s&&(r.m=4*Math.random()+1,l=4),r.r=0===n?.01:.01*Math.sqrt(r.m),r.rr=1-r.r,r.rrr=t.G-r.r,r.y/=r.m;var p=Math.floor(196*Math.random());0<s&&(p=Math.floor(196*(r.m-1)/(l-1))),r.col="rgb("+(32+p)+",0,"+(224-p)+")",h.push(r)}t.balls=h;o=t.Zs();for(t.targetEnergy=o[0]+o[1],a=0;a<20;a++)t.Gs()},e.prototype.Vs=function(){var t,i,s=this,n=[0,.5,1,1.5,2,2.5,3],e=s.ds-20;$(".Tslider").height(e);var o=$(".Tslidescale");o.height(s.ds);o=o[0];o.height=s.ds;var h=o.getContext("2d");for(h.beginPath(),t=0;t<n.length;t++)i=13+e/(s.at-s.ht)*(n[t]-s.ht),h.moveTo(19,i),h.lineTo(28,i);for(h.strokeStyle="#888",h.lineWidth=1.9,h.stroke(),h.fillStyle="#888",h.font="bold 11px Arial,Helvetica,sans-serif",h.textBaseline="middle",h.textAlign="left",t=0;t<n.length;t++)i=13+e/(s.at-s.ht)*(n[t]-s.ht),h.fillText(n[t]+"",32,i)},e.prototype.ct=function(t,i,s){0<t&&(this.rt=t-1e3,this.qs=[[i,s,new Date/1e3]],this.ut(t,i,s))},e.prototype.ut=function(t,i,s){var n;0===i&&0===s||null!==this.rt&&(n=new Date/1e3,this.balls[this.rt].x=i/this.cs,this.balls[this.rt].y=this.G-s/this.cs,this.qs.push([i,s,n]))},e.prototype.xt=function(){if(null!==this.rt){var t=this.qs.length-1,i=this.qs[t][0],s=this.qs[t][1];this.balls[this.rt].x=i/this.cs,this.balls[this.rt].y=this.G-s/this.cs;for(var n=new Date/1e3,e=this.qs.length-1;0<e&&!(this.qs[e][2]<n-.25);e--);t=this.X/this.cs/(n-this.qs[e][2])*1.2;this.balls[this.rt].vx=(i-this.qs[e][0])*t,this.balls[this.rt].vy=-(s-this.qs[e][1])*t,this.rt=null}},$(function(){$(".bouncing_balls").each(function(t,i){var s=$(i),i=new e(s.data("meta"),s);s.data("handler",i)})}),o.prototype.Rt=function(){},o.prototype.Jt=function(){},o.prototype.Ys=function(t){for(var i,s,n=new Uint8Array(this.kt.Ft*this.kt.Ft),e=1;e<this.kt.Ft-1;e++)for(i=1;i<this.kt.Ft-1;i++)t[s=e+this.kt.Ft*i]&&(n[s-this.kt.Ft-1]++,n[s-this.kt.Ft]++,n[s-this.kt.Ft+1]++,n[s-1]++,n[s+1]++,n[s+this.kt.Ft-1]++,n[s+this.kt.Ft]++,n[s+this.kt.Ft+1]++);for(e=1;e<this.kt.Ft-1;e++)for(i=1;i<this.kt.Ft-1;i++){var o=n[s=e+this.kt.Ft*i],h=t[s],h=h||3!==o?h&&3<o?0:h&&o<2?0:h:1;t[s]=h}},o.prototype.Pt=function(){return[{name:"Blank board",coordinate_list:[]},{name:"R-pentomino",coordinate_list:[[0,0],[-1,0],[0,-1],[0,1],[1,-1]]},{name:"Die hard",coordinate_list:[[-3,-1],[-2,-1],[-2,0],[2,0],[3,0],[4,0],[3,-2]]},{name:"Acorn",coordinate_list:[[-2,0],[-1,0],[-1,-2],[1,-1],[2,0],[3,0],[4,0]]},{name:"Gospel glider gun",coordinate_list:[[-1,-6],[-2,-6],[-1,-7],[-2,-7],[-12,-3],[-12,-4],[-14,-4],[-15,-5],[-16,-5],[-15,-6],[-16,-6],[-15,-7],[-16,-7],[-14,-8],[-12,-8],[-12,-9],[-19,-4],[-20,-3],[-20,-4],[-20,-5],[-21,-2],[-21,-6],[-22,-4],[-23,-1],[-23,-7],[-24,-1],[-24,-7],[-25,-2],[-25,-6],[-26,-3],[-26,-4],[-26,-5],[-35,-4],[-35,-5],[-36,-4],[-36,-5]]}]},$(function(){$(".conway_game_of_life").each(function(t,i){var s=$(i),i=new o(s.data("meta"),s);s.data("handler",i)})}),h.prototype.Rt=function(){this.zt=0,this.Nt=0,this.It=0},h.prototype.Jt=function(){this.zt=0,this.Nt=0,this.It=0},h.prototype.Ys=function(t){var i=this.zt+this.kt.Lt,s=this.Nt+this.kt.Lt;if(i<=1||i>=this.Ft-1||s<=1||s>=this.Ft-1)this.kt.Jt();else{switch(this.It){case 0:--this.Nt;break;case 1:this.zt+=1;break;case 2:this.Nt+=1;break;case 3:--this.zt}i=this.zt+this.kt.Lt,s=this.Nt+this.kt.Lt;s=i+this.kt.Ft*s;t[s]=1-t[s],t[s]?this.It=(this.It+1)%4:this.It=(this.It+3)%4}},h.prototype.Pt=function(){return[{name:"Blank board",coordinate_list:[]}]},$(function(){$(".langton_ant").each(function(t,i){var s=$(i),i=new h(s.data("meta"),s);s.data("handler",i)})}),s.prototype.Jt=function(){var t=this;"stopped"!==t.jt&&(t.Tt=t.Ot,t.Bt.Jt(),t.Vt()),t.jt="stopped",$(".toolbar_button_play",t._).removeClass("active"),$(".toolbar_button_pause",t._).addClass("disabled").removeClass("active"),$(".toolbar_button_stop",t._).addClass("active"),$(".step_count").text(0)},s.prototype.Ht=function(t){var i,s=this,n=s.Ft*s.Ft;for(s.Jt(),i=0;i<n;i++)s.Ot[i]=0;for(i=0;i<t.length;i++){var e=t[i][0]+s.Lt+(t[i][1]+s.Lt)*s.Ft;s.Ot[e]=1}s.Vt()},s.prototype.yt=function(){var i=this;if(null===this.Ct){var t=$("#simulation_speed").data("handler");if(!t)return;this.Ct=t,this.Ct.tn("change",function(t){i.Et=2*Math.exp(Math.log(400)*t)})}if("playing"===i.jt){for(var t=at(i.St),s=at(i.St+.1*i.Et),n=t;n<s;n++)i.Bt.Ys(this.Tt);i.Vt(),"playing"===i.jt&&(i.St+=.1*i.Et,$(".step_count").text(at(i.St)))}},s.prototype.Gt=function(t,i){t.preventDefault&&t.preventDefault(),t.returnValue=!1;var s=Date.now();void 0!==this.sn&&s<this.sn+100||(this.sn=s,t=void 0!==i?i:t.deltaY||t.wheelDelta,this.At=t<0?Math.min(1,this.At+.05):Math.max(0,this.At-.05),this.Vt())},s.prototype.R=function(t){var i=u(t,$(".simFore",this._));this.nn=i,this.I=!0;var s=this.bt*Math.exp(Math.log(this.wt/this.bt)*this.At),n=this.cs/s,t=this.cs/2-n*this.Ft/2,s=this.ds/2-n*this.Ft/2,t=at((i[0]-t)/n),s=at((i[1]-s)/n),n=this.Tt[t+s*this.Ft];this.Tt[t+s*this.Ft]=1-n,this.Vt()},s.prototype.U=function(t){},s.prototype.J=function(t){this.I=!1},s.prototype.en=function(t){this.I=!1},s.prototype.Vt=function(t){var i,s,n=this.bt*Math.exp(Math.log(this.wt/this.bt)*this.At),e=this.cs/n,o=at(this.cs/e/2+1),h=at(this.ds/e/2+1),a=this.cs/2-e*this.Ft/2,r=this.ds/2-e*this.Ft/2,n=this.Lt-o,l=this.Lt+o,p=this.Lt-h,u=this.Lt+h,h=$(".simBuf",this._),c=t;for((c=c||new lt(h[0],1,1)).dt(h.width(),h.height()),c.Ds("#222"),i=n;i<=l;i++)for(s=p;s<=u;s++){this.Tt[i+s*this.Ft]&&(c.Fi(),c.hn(a+i*e,r+s*e,e,e),c.Us())}if(4<e){for(c.Fi(),i=n;i<=l;i++)c.Li(a+i*e,0),c.Oi(a+i*e,this.ds);for(s=p;s<=u;s++)c.Li(0,r+s*e),c.Oi(this.cs,r+s*e);c.Ai("#ccc",1),c.Di()}void 0!==this.Bt.It&&(c.Fi(),c.an(a+(this.Bt.zt+this.Lt+.5)*e,r+(this.Bt.Nt+this.Lt+.5)*e,this.Bt.It*(Math.PI/2)),c.Li(.4*-e,.1*-e),c.Oi(0,.4*-e),c.Oi(.4*e,.1*-e),c.Ds("#f00"),c.Us(),c.rn())},s.prototype.dt=function(){var t=$(".cellular_automata_canvas",this._);this.cs=t.width(),this.ds=Math.min(.7*$(window).height(),$(window).height()-240),this.ds=Math.max(this.ds,200),$(".cellular_automata_holder, .sim",this._).width(this.cs).height(this.ds),$(".cellular_automata_canvas, .info_pane",this._).css("height",at(this.ds)+"px"),this.Vt()},a.prototype.yt=function(){var t,i=this;null!==this.Ct||(t=$("#temperature_slide").data("handler"))&&(this.Ct=t,this.Ct.tn("change",function(t){$(".temperature",i._).val(i.M.t_min+t*(i.M.t_max-i.M.t_min)),i.W()}))},a.prototype.ln=function(t){return Math.exp(t)-1},a.prototype.pn=function(t,i){var s=299792458,n=662606896e-42,i=s/(1e-10*i);return 2*n/Math.pow(s,2)*Math.pow(i,3)/this.ln(n*i/13806504e-30/t)*i*i/s},a.prototype.W=function(){for(var t=parseInt($(".temperature",this._).val()),i=[0,0,0],s=[],n=10;n<this.Kt.ui;n++){var e=this.Kt.li+n*this.Kt.pi,o=this.pn(t,e);s.push(o);e=this.Kt.un(e);i[0]+=e[0]*o,i[1]+=e[1]*o,i[2]+=e[2]*o}var h=28e-8/Math.pow(t/6e3,4)*(1e-10*this.Kt.pi),h=this.Kt.cn(i,h,!0);1<h[0]&&(h[0]=1),1<h[1]&&(h[1]=1),1<h[2]&&(h[2]=1);h="#"+p(Math.floor(255*h[0]).toString(16),2)+p(Math.floor(255*h[1]).toString(16),2)+p(Math.floor(255*h[2]).toString(16),2);$(".color_string",this._).text(h),$(".color_sample",this._).css("background-color",h)},$(function(){$(".color_blackbody").each(function(t,i){var s=$(i),i=new a(s.data("meta"),s);s.data("handler",i)})}),r.prototype.dn=function(t,i,s,n){var e=t.x_red,o=t.y_red,h=1-(e+o),a=t.x_green,r=t.y_green,l=1-(a+r),p=t.x_blue,u=t.y_blue,c=1-(p+u),d=t.white_point[0],f=t.white_point[1],y=1-(d+f),g=r*c-u*l,M=p*l-a*c,x=a*u-p*r,t=u*h-o*c,c=e*c-p*h,p=p*o-e*u,u=o*l-r*h,l=a*h-e*l,r=e*r-a*o,a=(g*d+M*f+x*y)/f,o=(t*d+c*f+p*y)/f,f=(u*d+l*f+r*y)/f;return[(g/=a)*i+(M/=a)*s+(x/=a)*n,(t/=o)*i+(c/=o)*s+(p/=o)*n,(u/=f)*i+(l/=f)*s+(r/=f)*n]},r.prototype.fn=function(t,i,s){return 0<=t&&0<=i&&0<=s},r.prototype.yn=function(t,i,s){var n=0<t?0:t;if(0<(n=-(n=(n=n<i?n:i)<s?n:s))){var e=(t+i+s)/(t+i+s+n);return isFinite(e)||(e=1),[t=(t+n)*e,i=(i+n)*e,s=(s+n)*e,1]}return[t,i,s,0]},r.prototype.cn=function(t,i,s){var n=t[0],e=t[1],t=t[2];s&&(1<(s=Math.sqrt(n*n+e*e+t*t))&&(s=1),s<0&&(s=0),n*=s=Math.pow(s,this.qt)/s,e*=s,t*=s);t=this.dn(this.oi,n,e,t);return this.fn(t[0],t[1],t[2])||(t=this.yn(t[0],t[1],t[2])),t[0]*=Math.abs(i),t[0]<0&&(t[0]=0),1<t[0]&&(t[0]=1),t[1]*=Math.abs(i),t[1]<0&&(t[1]=0),1<t[1]&&(t[1]=1),t[2]*=Math.abs(i),t[2]<0&&(t[2]=0),1<t[2]&&(t[2]=1),t},r.prototype.un=function(t){var i,s,n=(t-this.li)/this.pi;return!isFinite(n)||n<0||n>=this.ui-1?[0,0,0]:((i=Math.floor(n))<0&&(i=0),i>this.ui-2&&(i=this.ui-2),(t=(s=i+1)-n)<0&&(t=0),1<t&&(t=1),n=1-t,[this.ci[i][0]*t+this.ci[s][0]*n,this.ci[i][1]*t+this.ci[s][1]*n,this.ci[i][2]*t+this.ci[s][2]*n])},l.prototype.yt=function(){var t,i=this;null!==this.Ct||(t=$("#wavelength_slide").data("handler"))&&(this.Ct=t,this.Ct.tn("change",function(t){$(".wavelength",i._).val(i.M.w_min+t*(i.M.w_max-i.M.w_min)),i.W()}))},l.prototype.W=function(){var t=parseInt($(".wavelength",this._).val()),t=this.Kt.un(t),t=this.Kt.cn(t,1,!0),t="#"+p(Math.floor(255*t[0]).toString(16),2)+p(Math.floor(255*t[1]).toString(16),2)+p(Math.floor(255*t[2]).toString(16),2);$(".color_string",this._).text(t),$(".color_sample",this._).css("background-color",t)},$(function(){$(".color_spectrum").each(function(t,i){var s=$(i),i=new l(s.data("meta"),s);s.data("handler",i)})}),i.prototype.offset=function(t){if(t<this.Rt)return this.fi[0];t=Math.floor((t-this.Rt)/86400);return t>this.gi?this.fi[this.gi-1]:this.fi[t]},i.prototype.gn=function(t){if(t<this.Rt)return this.yi[0];t=Math.floor((t-this.Rt)/86400);return t>this.gi?this.yi[this.gi-1]:this.yi[t]},x.prototype.W=function(){var s,t=parseInt($(".seed",this._).val()),i=this.Mn(t);0<i.length?(s="<h3>The factors of "+t+"</h3><div class='lightgreybox'>",$.each(i,function(t,i){s+="<span class='item'>"+i+"</span>"}),s+="</div>"):s="<div class='lightgreybox'>The number "+t+" is a prime number. It has no factors.</div> ",$(".result",this._).html(s)},x.prototype.Mn=function(t){for(var i=[],s=2;s<t;s++)t%s==0&&i.push(s);return i},$(function(){$(".list_factors").each(function(t,i){var s=$(i),i=new x(s.data("meta"),s);s.data("handler",i)})}),v.prototype._i=function(E){var C=this;this.Mi&&Webcam.snap(function(t,i,s){var n=Math.floor(i.width),e=Math.floor(i.height),o=s.getImageData(0,0,n,e),h=o.data;$(".resize",C._).width(n).height(e);i=$(".normal")[0];i.width=n,i.height=e;s=i.getContext("2d");s.putImageData(o,0,0);for(var a,r,l=128,p=[],u=[],c=0;c<l;c++){for(var d=[[],[],[]],f=[[],[],[]],y=0;y<l;y++){for(var g=at(Math.floor(n*y/l)),M=at(Math.floor(n*(y+1)/l)),x=at(Math.floor(e*c/l)),v=at(Math.floor(e*(c+1)/l)),_=1e-6,m=[0,0,0],b=x;b<v;b++)for(S=4*(b*n+g),a=g;a<M;a++)m[0]+=h[S],m[1]+=h[S+1],m[2]+=h[S+2],_++,S+=4;for(k=0;k<3;k++)d[k].push(m[k]/_),f[k].push(0)}p.push(d),u.push(f)}var w=new FFTNayuki(l);for(c=0;c<l;c++)for(k=0;k<3;k++)w.forward(p[c][k],u[c][k]);for(var P=[.1,.1,.1],k=0;k<3;k++)for(c=0;c<l;c++){var z=[],N=[];for(y=0;y<l;y++)z.push(p[y][k][c]),N.push(u[y][k][c]);for(w.forward(z,N),y=0;y<l;y++){var I=Math.sqrt(z[y]*z[y]+N[y]*N[y]);p[y][k][c]=I,y&&c&&(P[k]=Math.max(P[k],.2*I))}}o=$(".fft_output");(i=o[0]).width=l,i.height=l;var i=(s=i.getContext("2d")).createImageData(l,l),B=i.data,S=32768;for(c=0;c<l;c++)for(64===c&&(S=0),r=64,y=0;y<l;y++)B[S]=255*p[c][0][r]/P[0],B[S+1]=255*p[c][1][r]/P[1],B[S+2]=255*p[c][2][r]/P[2],B[S+3]=255,S+=4,r=(r+1)%l;s.putImageData(i,0,0),E&&window.open(o[0].toDataURL("image/png"))})},$(function(){$(".fft_webcam").each(function(t,i){var s=$(i),i=new v(s.data("meta"),s);s.data("handler",i)})}),_.prototype.$i=function(){var t=$(".x0"),i=$(".y0");this.mi=parseFloat(t.val()),this.bi=parseFloat(i.val()),(!isFinite(this.mi)||100<Math.abs(this.mi))&&(this.mi=0),(!isFinite(this.bi)||100<Math.abs(this.bi))&&(this.bi=0),t.val(this.mi),i.val(this.bi)},_.prototype.xn=function(t,i,s,n){for(var e=t,o=i,h=e*e,a=o*o,r=0;r<n&&h+a<=s;r++)o=2*e*o+this.bi,h=(e=h-a+this.mi)*e,a=o*o;for(var l=0;l<4;l++)o=2*e*o+this.bi,h=(e=h-a+this.mi)*e,a=o*o;return[r,h,a]},$(function(){$(".fractal_julia .fractal").each(function(t,i){var s=$(i),i=new _(s.data("meta"),s);s.data("handler",i)})}),m.prototype.$i=function(){},m.prototype.ki=function(t){t=t.originalEvent,t=u(t,$(".simFore",this._));t[0]=parseInt(t[0])-this.Pi.cs/2,t[1]=parseInt(t[1])-this.Pi.ds/2;t="/julia.php?x="+(this.Pi.vn+t[0]/this.Pi.cs*this.Pi.Ei)+"&y="+(this.Pi._n+t[1]/this.Pi.ds*this.Pi.Ci);window.open(t,"_blank")},m.prototype.xn=function(t,i,s,n){for(var e=0,o=0,h=0,a=0,r=0;r<n&&h+a<=s;r++)o=2*e*o+i,h=(e=h-a+t)*e,a=o*o;for(var l=0;l<4;l++)o=2*e*o+i,h=(e=h-a+t)*e,a=o*o;return[r,h,a]},$(function(){$(".fractal_mandelbrot .fractal").each(function(t,i){var s=$(i),i=new m(s.data("meta"),s);s.data("handler",i)})}),b.prototype.D=function(){this.vn=0,this._n=0,this.Ei=4,this.Ci=4,$(".autoIterations",this.Bt._).prop("checked",!0),$(".smoothing",this.Bt._).prop("checked",!0),$(".colour_map",this.Bt._).val(1)},b.prototype.Gt=function(t,i){t.preventDefault&&t.preventDefault(),t.returnValue=!1;var s=Date.now();void 0!==this.sn&&s<this.sn+100||(this.sn=s,i=(void 0!==i?i:t.deltaY||t.wheelDelta)<0?.66:1/.66,(t=u(t,$(".simFore",this.Bt._)))[0]=parseInt(t[0])-this.cs/2,t[1]=parseInt(t[1])-this.ds/2,this.vn+=t[0]/this.cs*this.Ei*(1-i),this._n+=t[1]/this.ds*this.Ci*(1-i),this.Ei*=i,this.Ci*=i,this.Vt())},b.prototype.R=function(t){this.nn=u(t,$(".simFore",this.Bt._)),this.I=!0},b.prototype.U=function(t){var i,s,n,e,o,h,a,r=u(t,$(".simFore",this.Bt._));this.I&&(i=r[0]-this.nn[0],t=r[1]-this.nn[1],this.nn=r,this.vn-=this.Ei/this.cs*i,this._n-=this.Ci/this.ds*t,r=this.mn,s=r,n=this.cs,e=this.ds,o=i,h=t,a=function(t,i){return Math.max(0,Math.min(t,i))},a=s.getImageData(a(n,-o),a(e,-h),a(n,n-o),a(e,e-h)),s.clearRect(0,0,n,e),s.putImageData(a,Math.max(0,o),Math.max(0,h)),this.Vt(!0))},b.prototype.J=function(t){t&&this.U(t),this.I=!1},b.prototype.dt=function(){var t=$(".fractal_canvas",this.Bt._);this.cs=t.width(),this.ds=Math.min(.7*t.width(),$(window).height()-240),this.ds=Math.max(this.ds,200),$("canvas",this.Bt._).width(this.cs).height(this.ds),$(".fractal_canvas",this.Bt._).height(this.ds),this.bn=this.ds/this.cs,this.Ei=Math.max(this.Ei,this.Ci/this.bn),this.Ci=Math.max(this.Ci,this.Ei*this.bn),this.Vt()},b.prototype.Vt=function(t){this.wn=0,this.$n=0,this.Rt=(new Date).getTime(),this.Bt.$i(),this.Ii=$(".autoIterations",this.Bt._).prop("checked"),this.Ii?(s=Math.sqrt(.001+2*Math.min(Math.abs(this.Ei),Math.abs(this.Ci))),this.Ni=Math.floor(223/s)):this.Ni=Math.max(1,at($(".maxIterations",this.Bt._).val())),$(".maxIterations",this.Bt._).val(this.Ni),this.Bi=$(".smoothing",this.Bt._).prop("checked"),$(".xmin",this.Bt._).text((this.vn-this.Ei/2).toFixed(12)),$(".xmax",this.Bt._).text((this.vn+this.Ei/2).toFixed(12)),$(".ymin",this.Bt._).text((this._n-this.Ci/2).toFixed(12)),$(".ymax",this.Bt._).text((this._n+this.Ci/2).toFixed(12));var i=$(".simBuf",this.Bt._),s=i[0];t||(s.width=i.width(),s.height=i.height()),this.mn=s.getContext("2d"),this.Pn=this.mn.createImageData(s.width,1)},b.prototype.yt=function(){for(var t,i,s,n=(new Date).getTime(),e=0,o=this.kn(),h=this.Ei/this.cs,a=this.Ci/this.ds,r=this._n+a*this.$n-this.Ci/2;this.$n<this.ds;this.$n++,r+=a){var l=0;for(this.wn=0,t=this.vn-this.Ei/2;this.wn<this.cs;this.wn++,t+=h){var p=this.Bt.xn(t,r,this.zi,this.Ni),p=o(this.Ni,p[0],p[1],p[2]);this.Pn.data[l++]=p[0],this.Pn.data[l++]=p[1],this.Pn.data[l++]=p[2],this.Pn.data[l++]=p[3]}this.mn.putImageData(this.Pn,0,this.$n),e+=this.cs;var u=(new Date).getTime();if(100<=u-n)break}this.$n<this.ds-1&&(this.zn([0,255,0,255]),this.mn.putImageData(this.Pn,0,this.$n+1)),e&&(i=u-n,s=u-this.Rt,$(".renderTime").text((s/1e3).toFixed(1)),s=Math.floor(e/i),"NaN"===this.Nn(s).substr(0,3)?(s=Math.floor(60*e/i),$(".renderSpeedUnit").text("pixel/min")):$(".renderSpeedUnit").text("pixel/sec"),$(".renderSpeed").text(this.Nn(s)))},b.prototype.zn=function(t){for(var i=0,s=0;s<this.cs;s++)this.Pn.data[i++]=t[0],this.Pn.data[i++]=t[1],this.Pn.data[i++]=t[2],this.Pn.data[i++]=t[3]},b.prototype.Nn=function(t){var i=Math.ceil((1+Math.log(t)/Math.log(10))/3);return(t/Math.pow(10,3*(i-1))).toFixed(2)+" "+["","k","M","G","T","P","E"][i]},b.prototype.In=function(t,i,s,n){var e=1/Math.log(2);return 5+i-Math.log(.5)*e-Math.log(Math.log(s+n))*e},b.prototype.Bn=function(t,i,s){1<s&&(s=1);var n=t/60,t=s*i,i=t*(1-Math.abs(n%2-1)),i=5<=n&&n<6?[t,0,i]:4<=n&&n<5?[i,0,t]:3<=n&&n<4?[0,i,t]:2<=n&&n<3?[0,t,i]:1<=n&&n<2?[i,t,0]:0<=n&&n<1?[t,i,0]:[0,0,0],t=s-t;return i[0]+=t,i[1]+=t,i[2]+=t,i[0]*=255,i[1]*=255,i[2]*=255,i},b.prototype.kn=function(){var e=this,t=at($(".colour_map",this.Bt._).val());return 1===t?function(t,i,s,n){return e.Sn(t,i,s,n)}:2===t?function(t,i,s,n){return e.En(t,i,s,n)}:3===t?function(t,i,s,n){return e.Cn(t,i,s,n)}:4===t?function(t,i,s,n){return e.An(t,i,s,n)}:function(t,i,s,n){return e.Fn(t,i,s,n)}},b.prototype.Sn=function(t,i,s,n){if(i===t)return this.Si;i=this.Bi?this.In(t,i,s,n):i,t=this.Bn(360*i/t,1,1);return t.push(255),t},b.prototype.En=function(t,i,s,n){if(i===t)return this.Si;i=this.Bi?this.In(t,i,s,n):i,t=this.Bn(360*i/t,1,10*i/t);return t.push(255),t},b.prototype.Cn=function(t,i,s,n){if(i===t)return this.Si;i=this.Bi?this.In(t,i,s,n):i,i=this.Bn(360*i/t,1,10*i/t),t=i[0];return i[0]=i[2],i[2]=t,i.push(255),i},b.prototype.Fn=function(t,i,s,n){if(i===t)return this.Si;i=this.Bi?this.In(t,i,s,n):i;return 255<(i=Math.floor(512*i/t))&&(i=255),[i,i,i,255]},b.prototype.hypot=function(t,i){return Math.sqrt(t*t+i*i)},b.prototype.An=function(t,i,s,n){if(i!==t)return this.Fn(t,i,s,n);n=255-Math.floor(255*Math.sqrt(s+n))%255;return n<0&&(n=0),255<n&&(n=255),[n,n,n,255]},P.prototype.reset=function(t,i){this.cs=void 0===t?this.element.width():t,this.ds=void 0===i?this.element.height():i,this.canvas.width=this.cs,this.canvas.height=this.ds;i=this.canvas.getContext("2d");i.width=this.cs,i.height=this.ds,i.rect(0,0,this.cs,this.ds),i.fillStyle="#000000",i.fill(),this.keys={}},P.prototype.hoverHandle=function(t){var i,s=0,n=[0,0];t&&(i=at((n=u(t,this.element))[0]+this.Ti),t=at(n[1]+this.ji),this.Wi&&i>=this.cs&&(i=at(i-this.cs)),s=65536*(t=this.canvas.getContext("2d").getImageData(i,t,1,1).data)[0]+256*t[1]+t[2]),s in this.keys?this.Ri(this.keys[s],n[0],n[1]):this.Ri(0,n[0],n[1])},P.prototype.clickHandle=function(t){var i=u(t,this.element),s=at(i[0]+this.Ti),t=at(i[1]+this.ji);this.Wi&&s>=this.cs&&(s=at(s-this.cs));t=this.canvas.getContext("2d").getImageData(s,t,1,1).data,t=65536*t[0]+256*t[1]+t[2];t in this.keys?this.Ji(this.keys[t],i[0],i[1]):this.Ji(0,i[0],i[1])},P.prototype.dblClickHandle=function(t){var i=u(t,this.element),s=at(i[0]+this.Ti),t=at(i[1]+this.ji);this.Wi&&s>=this.cs&&(s=at(s-this.cs));t=this.canvas.getContext("2d").getImageData(s,t,1,1).data,t=65536*t[0]+256*t[1]+t[2];t in this.keys&&this.Ui(this.keys[t],i[0],i[1])},P.prototype.hoverPolygon=function(t,i,s){var n=at(14680063*Math.random()+1048576),e="#"+n.toString(16),o=this.canvas.getContext("2d");o.beginPath(),o.moveTo(i[0][0],i[0][1]);for(var h=1;h<i.length;h++)o.lineTo(i[h][0],i[h][1]);o.closePath(),s?(o.fillStyle=e,o.fill()):(o.strokeStyle=e,o.lineWidth=12,o.stroke()),this.keys[n]=t},P.prototype.hoverCircle=function(t,i,s,n){var e=parseInt(14680063*Math.random()+1048576);col="#"+e.toString(16);var o=this.canvas.getContext("2d");o.beginPath(),o.arc(i,s,n,0,2*Math.PI),o.fillStyle=col,o.fill(),this.keys[e]=t},P.prototype.hoverLine=function(t,i,s,n,e){var o=at(14680063*Math.random()+1048576),h="#"+o.toString(16),a=this.canvas.getContext("2d");a.beginPath(),a.moveTo(i,s),a.lineTo(n,e),a.lineWidth=20,a.strokeStyle=h,a.stroke(),a.beginPath(),a.arc(i,s,10,0,2*Math.PI),a.arc(n,e,10,0,2*Math.PI),a.fillStyle=h,a.fill(),this.keys[o]=t},P.prototype.hoverBox=function(t,i,s,n,e){var o=at(14680063*Math.random()+1048576),h="#"+o.toString(16),a=this.canvas.getContext("2d");a.beginPath(),a.rect(i,s,n,e),a.fillStyle=h,a.fill(),this.keys[o]=t},k.prototype.vt=function(t){var i=this,s=i.n_ions,n=$(".simBuf",this._),e=t;(e=e||new lt(n[0],1,1)).dt(i.cs,i.ds),this.lt.reset();for(var o=0;o<s;o++){var h=i.ions[o],a=h.x*i.cs,r=i.ds-h.y*i.cs;e.Ds(h.col),e.Fi(),e.Js(a,r,h.r*i.cs,0,2*Math.PI,!1),e.Us(),i.lt.hoverCircle(o+1e3,a,r,h.r*i.cs+6)}},k.prototype.Gs=function(){for(var t,i=this,s=i.n_ions,n=i.K,e=0;e<s;e++)e!==this.Vi&&((t=i.ions[e]).x+=t.vx*n,t.y+=t.vy*n,t.vx*=.99995,t.vy*=.99995,t.x<t.r&&t.vx<0&&(t.vx*=-1),t.x>1-t.r&&0<t.vx&&(t.vx*=-1),t.y<t.r&&t.vy<0&&(t.vy*=-1),t.y>this.G-t.r&&0<t.vy&&(t.vy*=-1));for(e=0;e<s;e++){t=i.ions[e];for(var o=0;o<e;o++){var h,a=i.ions[o],r=a.x-t.x,l=a.y-t.y,p=r*r+l*l,u=t.r+a.r,c=Math.sqrt(p),r=r/c,c=l/c;u*u<p?(h=t.q*a.q/p*15e-7,t.vx-=h*r,t.vy-=h*c,a.vx+=h*r,a.vy+=h*c):(p=r*t.vx+c*t.vy)-(h=r*a.vx+c*a.vy)<0||(t.vx+=.9*(h-p)*r,t.vy+=.9*(h-p)*c,a.vx+=.9*(p-h)*r,a.vy+=.9*(p-h)*c)}}},k.prototype.yt=function(){for(var t=0;t<4;t++)this.Gs();this.vt()},k.prototype.Gi=function(){var t=parseInt($(".charge_a",this._).val());t<-5&&(t=-5),5<t&&(t=5);var i=parseInt($(".charge_b",this._).val());i<-5&&(i=-5),5<i&&(i=5);var s=Math.abs(i),n=s+Math.abs(t),e=120;e-=120%n,this.n_ions=e;for(var o=[],h=0;h<e;h++){var a={x:Math.random(),y:Math.random()*this.G,vx:.015*(.5-Math.random()),vy:.015*(.5-Math.random()),type:s<=h%n?1:0,r:.015};a.col=a.type?"#0000ff":"#ff0000",o.push(a)}this.ions=o,this.Qi()},k.prototype.Qi=function(){var t,i=parseInt($(".charge_a",this._).val());i<-5&&(i=-5),5<i&&(i=5),$(".charge_a",this._).val(i);var s=parseInt($(".charge_b",this._).val());s<-5&&(s=-5),5<s&&(s=5),$(".charge_b",this._).val(s);var n=parseFloat($(".radius_a",this._).val());n<.2&&(n=.2),5<n&&(n=5),$(".radius_a",this._).val(n);var e=parseFloat($(".radius_b",this._).val());for(e<.2&&(e=.2),5<e&&(e=5),$(".radius_b",this._).val(e),t=0;t<this.n_ions;t++){var o=this.ions[t];0===o.type?(o.q=i,o.r=.01*n):(o.q=s,o.r=.01*e)}},k.prototype.dt=function(){var t=$(".simulation_canvas",this._);this.cs=t.width(),this.ds=Math.min(.7*$(window).height(),$(window).height()-240),this.ds=Math.max(this.ds,200),this.G=this.ds/this.cs,$(".simulation_holder, .sim",this._).width(this.cs).height(this.ds),$(".simulation_canvas",this._).css("height",at(this.ds)+"px"),w(null,$(".simBack",this._),this.Hi),this.vt()},k.prototype.ct=function(t,i,s){0<t&&(this.Vi=t-1e3,this.Ln=[[i,s,new Date/1e3]],this.ut(t,i,s))},k.prototype.ut=function(t,i,s){var n;0===i&&0===s||null!==this.Vi&&(n=new Date/1e3,this.ions[this.Vi].x=i/this.cs,this.ions[this.Vi].y=this.G-s/this.cs,this.Ln.push([i,s,n]))},k.prototype.xt=function(){if(null!==this.Vi){var t=this.Ln.length-1,i=this.Ln[t][0],s=this.Ln[t][1];this.ions[this.Vi].x=i/this.cs,this.ions[this.Vi].y=this.G-s/this.cs;for(var n=new Date/1e3,e=this.Ln.length-1;0<e&&!(this.Ln[e][2]<n-.25);e--);t=this.X/this.cs/(n-this.Ln[e][2])*1.2;this.ions[this.Vi].vx=(i-this.Ln[e][0])*t,this.ions[this.Vi].vy=-(s-this.Ln[e][1])*t,this.Vi=null}},$(function(){$(".ionic_lattice").each(function(t,i){var s=$(i),i=new k(s.data("meta"),s);s.data("handler",i)})}),z.prototype.yt=function(){for(var s=this,t=0;t<this.Zi;t++)!function(i){var t;null!==s.ps[i].slider||(t=$("#focal_length_slide_"+i,s._).data("handler"))&&(s.ps[i].slider=t).tn("change",function(t){s.ps[i].focal_length=s.ts+t*(s.ss-s.ts),s.W()})}(t)},z.prototype.us=function(){var s=this,n=0,e=!1;this.qi&&($.each(this.ps,function(t,i){i.position>n&&(n=i.position)}),$.each(this.ps,function(t,i){i.enabled||e||(i.enabled=!0,i.position=n+100,i.concave=!1,i.focal_length=s.M.focal_length_a,e=!0)}),this.W())},z.prototype.W=function(t){var a=this,r=Math.min(a.es,.45*a.ds),i=r/2,s=$(".simBuf",this._),l=t;(l=l||new lt(s[0],1,1)).dt(s.width(),s.height()),this.lt.reset();var n=0;$.each(this.ps,function(t,i){i.position<15&&(i.position=15),i.position>a.cs-15&&(i.position=a.cs-15),$(".type_"+g,a._).val(i.concave?"Concave":"Convex"),$(".focal_length_"+t,a._).val(i.focal_length),$(".focal_power_"+t,a._).val(10/i.focal_length),i.enabled?$(".lens-"+t,a._).removeClass("lens_deactivate"):$(".lens-"+t,a._).addClass("lens_deactivate"),null!==i.slider&&i.slider.Zt((i.focal_length-a.ts)/(a.ss-a.ts)),i.enabled&&n++}),this.qi=n<this.Zi,this.Yi=1<n,this.qi?$(".btn-add-lens",this._).prop("disabled",!1):$(".btn-add-lens",this._).prop("disabled",!0),this.Yi?$(".btn-remove-lens",this._).prop("disabled",!1):$(".btn-remove-lens",this._).prop("disabled",!0);var p=[];$.each(this.ps,function(t,i){i.enabled&&p.push([t,i.position])}),p.sort(function(t,i){return t[1]-i[1]});var e="Image plane"===$(".source",this._).val();e&&0<p.length&&(this.ls=Math.min(this.ls,a.ps[p[0][0]].position-10)),this.ls=Math.max(this.ls,2);function o(e,o,h){$.each(u.rays,function(t,i){var s=o?u.real_ray_segments:u.virtual_ray_segments,n=i[1]+(e-i[0])*Math.tan(Math.PI/2-i[2]);s.push([i[0],i[1],e,n,i[3]]),h&&(i[0]=e,i[1]=n)})}var u={rays:[],can_change_rays:!0,real_image:e,image_x:e?this.ls:-1e9,image_size:e?i:1e9,image_from_lens:-1,real_ray_segments:[],virtual_ray_segments:[],real_image_planes:[],virtual_image_planes:[]};$.each(p,function(t){var i=a.ps[p[t][0]];u.real_image&&i.position>u.image_x?(u.real_image_planes.push([u.image_x,u.image_size,u.image_from_lens]),o(u.image_x,!0,!0),u.can_change_rays&&(u.rays=[[u.image_x,u.image_size,Math.PI/2,[0,0,0]],[u.image_x,u.image_size,Math.PI/2+Math.atan2(u.image_size,i.position-u.image_x),[0,0,0]]]),o(i.position,!0,!0)):u.real_image?(o(i.position,!0,!0),o(u.image_x,!1,!1),u.virtual_image_planes.push([u.image_x,u.image_size,u.image_from_lens])):(0<u.rays.length||(n=3*Math.PI/180,u.rays=[[0,-a.es/2,Math.PI/2,[1,0,0]],[0,a.es/2,Math.PI/2,[1,0,0]],[0,-a.es/2+i.position*Math.atan(n),Math.PI/2+n,[0,0,1]],[0,a.es/2+i.position*Math.atan(n),Math.PI/2+n,[0,0,1]]],u.can_change_rays=!1),o(i.position,!0,!0));var e=i.focal_length*a.Hi*(i.concave?-1:1),s=i.position-u.image_x,n=1/(1/e-1/s);isFinite(n)||(n=1e9),u.image_size*=-n/s,u.image_x=i.position+n,u.image_from_lens=p[t][0],u.real_image=0<n,$.each(u.rays,function(t,i){var s=i[1]-1e3*Math.tan(Math.PI/2-i[2]),n=1/(1/e-.001),s=-n/1e3*s;i[2]=Math.atan2(n,s-i[1])}),u.real_image||o(u.image_x,!1,!1)}),u.real_image&&u.image_x<a.cs?(u.real_image_planes.push([u.image_x,u.image_size,u.image_from_lens]),o(u.image_x,!0,!0)):(u.virtual_image_planes.push([u.image_x,u.image_size,u.image_from_lens]),o(a.cs,!0,!0)),$(".show_virtual",a._).is(":checked")||(u.virtual_ray_segments=[],u.virtual_image_planes=[]);var c=a.ds/2;$.each([["virtual_ray_segments",[204,204,204]],["real_ray_segments",[110,110,100]]],function(t,n){$.each(u[n[0]],function(t,i){var s="rgb("+(i[4][0]?255:n[1][0])+","+(i[4][1]?255:n[1][1])+","+(i[4][2]?255:n[1][2])+")";l.Ai(s,1.5),l.Fi(),l.Li(i[0],c-i[1]),l.Oi(i[2],c-i[3]),l.Di()})});var d=[];$.each([["virtual_image_planes",!1],["real_image_planes",!0]],function(t,n){$.each(u[n[0]],function(t,i){var s;i[0]<0||i[0]>a.cs||(e?(s=n[1]?"#ff2222":"#cccccc",l.Ai(s,3),l.Fi(),l.Li(i[0],c),l.Oi(i[0],c-.9*i[1]),l.Di(),l.Ds(s),l.Fi(),l.Li(i[0],c-i[1]),l.Oi(i[0]-.12*i[1],c-.82*i[1]),l.Oi(i[0],c-.86*i[1]),l.Oi(i[0]+.12*i[1],c-.82*i[1]),l.On(),l.Us()):(l.Ai(n[1]?"#222222":"#cccccc",3),l.Fi(),l.Li(i[0],c-.8*a.es),l.Oi(i[0],c+.8*a.es),l.Di()),i[2]<0?d.push([i[0],["Source","Image"]]):d.push([i[0],[n[1]?"Real":"Virtual","Image from","Lens "+(i[2]+1)]]))})}),e&&a.lt.hoverBox(9e3,a.ls-25,c-r,50,r),$.each(p,function(t){var i,s,n=a.ps[p[t][0]],e=n.position,o=n.focal_length*a.Hi,h=2*(a.ns-1)*o,h=Math.max(h,1.01*r),o=Math.asin(r/h);n.concave?(i=a.os/2+h,s=a.os/2+h*(1-Math.cos(o)),l.Fi(),l.Li(e-s,c-r),l.Js(e-i,c,h,-o,o,!1),l.Oi(e+s,c+r)):(s=h-(i=r/Math.tan(o)),l.Fi(),l.Li(e,c-r),l.Js(e-i,c,h,-o,o,!1)),l.Js(e+i,c,h,Math.PI-o,Math.PI+o,!1),l.On(),l.Ds("rgba(0,0,0,0.17)"),l.Us(),l.Ai("#000000",1.5),l.Di(),d.push([e,["Lens",p[t][0]+1]]),a.lt.hoverBox(1e3+p[t][0],e-s,c-r,2*s,2*r)}),d.sort(function(t,i){return t[0]-i[0]}),l.Ds("#222222"),l.Dn("Arial,Helvetica,sans-serif",14,"bold","");for(var h,f=-1e3,y=-1,g=0;g<d.length;g++){for(var M=0<(h=d[g][0]-f<90?-y:-1)?22:a.ds-22,x=d[g][1].length,v=0;v<x;v++){var _=0<h?v:x-1-v;l.Ts(d[g][0],M,0,-h,1,d[g][1][_],!1,!1),M+=16*h}y=h,f=d[g][0]}},z.prototype.dt=function(){var t=$(".simulation_canvas",this._);this.cs=t.width(),this.ds=Math.min(.7*$(window).height(),$(window).height()-320,400),this.ds=Math.max(this.ds,200),$(".simulation_holder, .sim",this._).width(this.cs).height(this.ds),$(".simulation_canvas",this._).css("height",at(this.ds)+"px"),w(null,$(".simBack",this._),this.Hi,this.cs/2,this.ds/2),this.W()},z.prototype.ct=function(t,i,s){0<t&&(this.Ki=t-1e3,this.ut(t,i,s))},z.prototype.ut=function(t,i,s){0===i&&0===s||null!==this.Ki&&(1e3<this.Ki?this.ls=i:this.ps[this.Ki].position=i,this.W())},z.prototype.xt=function(){this.ps.sort(function(t,i){return t.enabled!==i.enabled?at(i.enabled)-at(t.enabled):t.position-i.position}),this.Ki=null,this.W()},$(function(){$(".lenses_demo").each(function(t,i){var s=$(i),i=new z(s.data("meta"),s);s.data("handler",i)})}),N.prototype.Tn=function(t,i,s){var n=t.jn(i),e=new R(0,0,1).jn(n),o=t.Rn(Math.pow(i.Ps(),2)-s/t.Ps()).Jn(i.Rn(t.Un(i))).Rn(1/s);.98<o.Ps()&&(o=o.Rn(.98/o.Ps()));var h,a,r=o.Ps(),l=Math.pow(i.Ps(),2)/2-s/t.Ps();1e-6<Math.abs(r-1)?a=(h=-s/(2*l))*(1-Math.pow(r,2)):(a=Math.pow(n.Ps(),2)/s,h=1e6),h=Math.abs(h),a=Math.abs(a);l=Math.acos(n.Wn/n.Ps()),n=Math.acos(e.Hn/e.Ps());e.Vn<0&&(n=2*Math.PI-n);e=Math.acos(e.Un(o)/(e.Ps()*r));o.Wn<0&&(e=2*Math.PI-e);o=Math.acos(o.Un(t)/(r*t.Ps()));return t.Un(i)<0&&(o=2*Math.PI-o),1e3<h&&(h=1e3),{epoch:this.vs,a:h,p:a,e:r,i:l,omega:n,argp:e,nu:o,mu:s,mean_motion:Math.sqrt(s/Math.pow(h,3))/this.Ms}},N.prototype.zs=function(t,i){var s=Number(t.a),n=Number(t.e),e=t.omega,o=t.i,h=t.argp,a=t.mean_anomaly,r=t.mean_motion,l=(a+(i-t.epoch)*r)%(2*Math.PI),r=[],p=0;if(0===s)r.x=r.y=r.z=0;else{if(n<1e6){for(var u,p=.5,c=l,d=0;d<50&&1e-8<p;d++)u=c+(l+n*Math.sin(c)-c)/(1-n*Math.cos(c)),(p=Math.abs(u/c))<1&&(p=1/p),--p,c=u;M=s*(Math.cos(c)-n),f=s*(Math.sqrt(1-n*n)*Math.sin(c)),g=Math.atan2(f,M),M=Math.sqrt(M*M+f*f)}else var f=s*(1-n),s=.75*((i-Number(t.epoch_peri))/86400)*.01720209895*Math.sqrt((1+n)/Math.pow(f,3)),i=Math.sqrt(1+s*s),t=Math.pow(i+s,.333333333)-Math.pow(i-s,.33333333),y=(1-n)/(1+n),i=t*t/(1+t*t),s=y*i*i,s=t*(1+y*i*(2/3+.4*t*t+(1.4+33/35*t*t+37/175*Math.pow(t,4))*s+t*t*(432/175+956/1125*t*t+84/1575*Math.pow(t,4))*s*s)),g=2*Math.atan(s),M=f*(1+s*s)/(1+s*s*y);y=e,e=h,h=M*(Math.cos(y)*Math.cos(g+e)-Math.sin(y)*Math.sin(g+e)*Math.cos(o)),y=M*(Math.sin(y)*Math.cos(g+e)+Math.cos(y)*Math.sin(g+e)*Math.cos(o)),o=M*(Math.sin(g+e)*Math.sin(o));r.x=h,r.y=y,r.z=o,r.error_ratio=p}return r},N.prototype.Gn=function(){this.Qn=2.02*Math.PI/this.ys.mean_motion/1e3;for(var t=[],i=0;i<1e3;i++){var s=this.ys.epoch+i*this.Qn,s=this.zs(this.ys,s);1e-7<s.error_ratio||t.push(s)}return t},N.prototype.Xn=function(t,i){for(var s=this.ys,n=1e6,e=0,o=0;o<this._s.length;o++){var h=this._s[o].x-t,a=this._s[o].y-i,h=h*h+a*a;h<n&&(a=s.epoch+o*this.Qn,e=(s.mean_anomaly+(a-s.epoch)*s.mean_motion)%(2*Math.PI),n=h)}return e},N.prototype.yt=function(){var i=this;if(this.vs+=.05*this.xs,null===this.gs){var t=$("#simulation_speed").data("handler");if(!t)return;this.gs=t,this.gs.tn("change",function(t){i.xs=Math.exp((t-.5)/.5)})}this.W()},N.prototype.W=function(t){var i;if(null!==this.ys){var s,n=$(".simBuf",this._),e=t;if((e=e||new lt(n[0],1,1)).dt(n.width(),n.height()),this.lt.reset(),e.Ds("#0040ff"),e.Fi(),e.Js(this.cs/2,this.ds/2,7,0,2*Math.PI,!1),e.Us(),$(".show_orbit",this._).is(":checked")&&!this.fs){for(e.Ai("#cccccc",1.4),e.Li(this._s[0].x+this.cs/2,this._s[0].y+this.ds/2),i=1;i<this._s.length;i++)e.Oi(this._s[i].x+this.cs/2,this._s[i].y+this.ds/2);e.Di()}this.fs?(s=this.Kn.length-1,o={x:this.Kn[s][0]-this.cs/2,y:this.Kn[s][1]-this.ds/2}):(n=this.vs,o=this.zs(this.ys,n),s=n-this.bs[2],this.ws=[(o.x-this.bs[0])/s,(o.y-this.bs[1])/s],this.bs=[o.x,o.y,n]),e.Ds("#ff0000"),e.Fi(),e.Js(o.x+this.cs/2,o.y+this.ds/2,7,0,2*Math.PI,!1),e.Us();var o=this.ws;$(".out_speed").text(Math.sqrt(o[0]*o[0]+o[1]*o[1]).toFixed(1));o=this.bs;$(".out_dist").text(Math.sqrt(o[0]*o[0]+o[1]*o[1]).toFixed(1))}},N.prototype.dt=function(){var t=$(".simulation_canvas",this._);this.cs=t.width(),this.ds=Math.min(.7*$(window).height(),$(window).height()-320),this.ds=Math.max(this.ds,200),$(".simulation_holder, .sim",this._).width(this.cs).height(this.ds),$(".simulation_canvas",this._).css("height",at(this.ds)+"px"),w(null,$(".simBack",this._),this.Hi,this.cs/2,this.ds/2),this.Ms=3*Math.max(1,1e3/this.cs),this.W()},N.prototype.ct=function(t,i,s){this.fs=!0,this.Kn=[[i,s,new Date/1e3]],this.ut(t,i,s)},N.prototype.ut=function(t,i,s){var n;0===i&&0===s||this.fs&&(n=new Date/1e3,this.Kn.push([i,s,n]))},N.prototype.xt=function(){if(this.fs){for(var t=this.Kn.length-1,i=this.Kn[t][0],s=this.Kn[t][1],n=new Date/1e3,e=this.Kn.length-1;0<e&&!(this.Kn[e][2]<n-.25);e--);var o=1/(n-this.Kn[e][2]),t=(i-this.Kn[e][0])*o,o=(s-this.Kn[e][1])*o;this.fs=!1,this.ks(i,s,t,o,!0)}},N.prototype.ks=function(t,i,s,n,e){var o=t-this.cs/2,t=i-this.ds/2,i=new R(o,t,.1),n=new R(s,n,.1);e&&(350<(e=n.Ps())&&(n=n.Rn(350/e)),e<.1&&(n=new R(.5,.5,0))),this.ys=this.Tn(i,n,this.$s),this.ys.mean_anomaly=0,this._s=this.Gn(),this.ys.mean_anomaly=this.Xn(o,t),this.bs=[0,0,0],this.ws=[0,0];t=2*Math.PI/this.ys.mean_motion;$(".out_a").text(this.ys.a.toFixed(1)),$(".out_e").text(this.ys.e.toFixed(4)),$(".out_argp").text((180*this.ys.argp/Math.PI).toFixed(1)),$(".out_period").text(t.toFixed(1))},$(function(){$(".orbits_keplerian").each(function(t,i){var s=$(i),i=new N(s.data("meta"),s);s.data("handler",i)})}),I.prototype.W=function(){var t=parseInt($(".seed",this._).val()),i=this.Mn(t),s="<div class='lightgreybox'><span class='line'>"+t+" = ",n=!0;$.each(i,function(t,i){n||(s+=" &times; "),s+=""+i,n=!1}),s+="</span></div>",$(".result",this._).html(s)},I.prototype.Mn=function(t){for(var i,s,n,e=[],o=2;o<=Math.sqrt(t);o++){if(i=!0,o<53)i=2===o||3===o||5===o||7===o||11===o||13===o||17===o||19===o||23===o||29===o||31===o||37===o||41===o||43===o||47===o;else if(o%2==0||o%3==0||o%5==0||o%7==0)i=!1;else{for(n=at(Math.sqrt(o)),s=11;s<=n&&i;s+=6)o%s==0&&(i=!1),o%(s+2)==0&&(i=!1);i=!0}if(i)for(;t%o==0&&(e.push(o),1!=(t/=o)););}return 1!==t&&e.push(t),e},$(function(){$(".prime_factors").each(function(t,i){var s=$(i),i=new I(s.data("meta"),s);s.data("handler",i)})}),B.prototype.Os=function(t,i){var s=i[t.nodeNames[0]][0];return i[t.nodeNames[1]][0]-s},B.prototype.Zn=function(t){t||(this.js=1e-6),t||this.Pi.qn(),$.each(this.As,function(t,i){i.push(0),i.push({})}),this.Yn()},B.prototype.te=function(){$(".element_info_extra",this._).empty()},B.prototype.ie=function(t){var i=this.Pi.se[t],s=i.type;if(-3===s){var n=prompt("Texte de l'étiquette :",i.htmlElement.html);return n&&(i.htmlElement.html=$("<div>").text(n).html()),this.Pi.ne(i),void this.Pi.Vt()}null!==this.Es&&this.Es.hasOwnProperty(t)&&(i=this.Es[t],(s=this.Ls[s]).hasOwnProperty("hook_buttonClick")&&s.hook_buttonClick(i,this.As))},B.prototype.ee=function(e,o){var h=this,a={};$.each(this.Es,function(t,s){var i,n=null===e;null!==e&&$.each(e,function(t,i){n||-1!==$.inArray(i,s.nodeNames)&&(n=!0)}),n&&((i=s.type)<0||((i=h.Ls[i].hook_setCurrent)&&i(s,h.As),$.each(s.nodeNames,function(t,i){a[i]=!0})))}),$.each(a,function(t,i){var s=0,n=h.As[t];$.each(n[1],function(t,i){s+=i}),o[t]=s})},B.prototype.oe=function(){var n={},o=[];return $.each(this.Es,function(t,i){var s=i.type;(0===s||97===s||10===s&&0<i.pushTimer||11===s&&1===i.switchState)&&(o.push(i.nodeNames),$.each(i.nodeNames,function(t,i){n[i]=!0})),12===s&&(s=i.nodeNames,i.switchState?(o.push([s[0],s[2]]),n[s[0]]=!0,n[s[1]]=!0):(o.push([s[0],s[1]]),n[s[0]]=!0,n[s[2]]=!0))}),$.each(n,function(s){var n=[],e=[];$.each(o,function(t,i){-1!==$.inArray(s,i)?$.each(i,function(t,i){-1===$.inArray(i,n)&&n.push(i)}):e.push(i)}),e.push(n),o=e}),o},B.prototype.he=function(t,s){var n=this,e=0;if($.each(t,function(t,i){e+=s[i]}),0!==(e/=t.length)){$.each(t,function(t,i){n.As[i][0]+=1e-6}),n.ee(t,s);var o=0;$.each(t,function(t,i){o+=s[i]});var i=(o/=t.length)-e;if(0!=i){var h=-5e-7*e/i;return.2<Math.abs(h)&&(h*=.2/Math.abs(h)),$.each(t,function(t,i){n.As[i][0]+=h}),n.ee(t,s),h}}},B.prototype.Yn=function(t){var i,o=this;void 0===t&&(t=100),$.each(this.As,function(t,i){i[1]={}});var s=this.oe(),n={};for(o.ee(null,n),i=0;i<t;i++){var e=0,h=0;if($.each(this.As,function(t,i){e=o.he([t],n),h=Math.max(h,Math.abs(e))}),$.each(s,function(t,i){e=o.he(i,n),h=Math.max(h,Math.abs(e))}),h<1e-5)break}this.Pi.ae("updateState");var a=null,r=null;$.each(this.As,function(t,i){isNaN(i[0])&&(i[0]=0),(a>i[0]||null===a)&&(a=i[0]),(r<i[0]||null===r)&&(r=i[0])}),null===a&&(a=0),null===r&&(r=0),this.js=Math.max(this.js,r-a),$.each(this.As,function(t,i){i[0]-=a}),$.each(this.Es,function(t,i){var e=[];$.each(i.nodeNames,function(t,i){var s=o.As[i][0],n=o.js,i=Math.abs((s-o.js)/n),n=Math.abs(s/n);e.push(o.Pi.Rs([i,n],[o.Is,o.Ns],!1))}),i.nodeColors=e});var l,p="";this.Pi.re&&this.Es.hasOwnProperty(this.Pi.re)&&((l=this.Es[this.Pi.re]).hasOwnProperty("voltage")&&(p+="<p class='heading'>Voltage</p><p class='value'>"+o.Ws(l.voltage)+" V</p>"),l.hasOwnProperty("current")&&(p+="<p class='heading'>Current</p><p class='value'>"+o.Ws(l.current)+" A</p>"),0===p.length&&(p="Click on any component to see the voltage across it and current flowing through it.")),$(".element_info_extra",this._).html(p)},B.prototype.Ws=function(t){return Math.round(1e4*Math.abs(t))/1e4},$(function(){$(".sim_electronics").each(function(t,i){var s=$(i),i=new B(s.data("meta"),s);s.data("handler",i)})});var S=[{name:" Potential divider",elements:{id:"electronics",elements:{1:{id:1,type:20,xpos:10,ypos:3,settings:{voltage:12}},2:{id:2,type:30,xpos:30,ypos:13,settings:{resistance:1.5}},3:{id:3,type:30,xpos:30,ypos:33,settings:{resistance:1.5}},4:{id:4,type:30,xpos:42,ypos:33,settings:{resistance:1.5}},5:{id:5,type:97,xpos:12,ypos:15,settings:{}},6:{id:6,type:97,xpos:12,ypos:35,settings:{}},7:{id:7,type:98,xpos:29,ypos:20,settings:{}},8:{id:8,type:98,xpos:29,ypos:40,settings:{}},9:{id:9,type:0,xpos:10,ypos:5,settings:{},nodePositions:[[0,0],[0,10]]},10:{id:10,type:0,xpos:10,ypos:15,settings:{},nodePositions:[[0,0],[5,0]]},11:{id:11,type:0,xpos:10,ypos:15,settings:{},nodePositions:[[0,0],[0,20]]},12:{id:12,type:0,xpos:10,ypos:35,settings:{},nodePositions:[[0,0],[5,0]]},13:{id:13,type:0,xpos:19,ypos:15,settings:{},nodePositions:[[0,0],[11,0]]},14:{id:14,type:0,xpos:19,ypos:35,settings:{},nodePositions:[[0,0],[11,0]]},15:{id:15,type:0,xpos:30,ypos:15,settings:{},nodePositions:[[0,0],[2,5]]},16:{id:16,type:0,xpos:36,ypos:20,settings:{},nodePositions:[[0,0],[2,-5]]},17:{id:17,type:0,xpos:30,ypos:35,settings:{},nodePositions:[[0,0],[2,5]]},18:{id:18,type:0,xpos:36,ypos:40,settings:{},nodePositions:[[0,0],[2,-5]]},19:{id:19,type:0,xpos:38,ypos:35,settings:{},nodePositions:[[0,0],[4,0]]},20:{id:20,type:0,xpos:50,ypos:35,settings:{},nodePositions:[[0,0],[0,-20]]},21:{id:21,type:0,xpos:38,ypos:15,settings:{},nodePositions:[[0,0],[12,0]]},22:{id:22,type:0,xpos:50,ypos:15,settings:{},nodePositions:[[0,0],[0,-10]]},23:{id:23,type:0,xpos:50,ypos:5,settings:{},nodePositions:[[0,0],[-35,0]]}}}},{name:"Charging/discharging capacitor",elements:{id:"electronics",elements:{1:{id:1,type:20,xpos:10,ypos:3,settings:{voltage:12}},2:{id:2,type:31,xpos:16,ypos:18,settings:{capacitance:2}},3:{id:3,type:12,xpos:37,ypos:17,settings:{}},4:{id:4,type:30,xpos:52,ypos:19,settings:{resistance:1.5}},5:{id:5,type:0,xpos:10,ypos:5,settings:{},nodePositions:[[0,0],[0,7]]},6:{id:6,type:0,xpos:15,ypos:5,settings:{},nodePositions:[[0,0],[45,0]]},7:{id:7,type:0,xpos:50,ypos:5,settings:{},nodePositions:[[10,0],[10,16]]},8:{id:8,type:0,xpos:10,ypos:15,settings:{},nodePositions:[[0,-3],[0,5]]},9:{id:9,type:30,xpos:22,ypos:10,settings:{resistance:1.5}},10:{id:10,type:0,xpos:18,ypos:25,settings:{},nodePositions:[[-5,4],[0,4]]},11:{id:11,type:0,xpos:26,ypos:25,settings:{},nodePositions:[[19,-13],[4,-13]]},12:{id:12,type:98,xpos:15,ypos:29,settings:{}},13:{id:13,type:99,xpos:15,ypos:37,settings:{}},14:{id:14,type:0,xpos:10,ypos:15,settings:{},nodePositions:[[0,5],[6,5]]},15:{id:15,type:0,xpos:16,ypos:15,settings:{},nodePositions:[[0,5],[-3,14]]},16:{id:16,type:0,xpos:22,ypos:21,settings:{},nodePositions:[[5,8],[2,-1]]},17:{id:17,type:0,xpos:32,ypos:21,settings:{},nodePositions:[[13,0],[20,0]]},18:{id:18,type:0,xpos:32,ypos:19,settings:{},nodePositions:[[13,0],[13,-7]]},19:{id:19,type:0,xpos:22,ypos:29,settings:{},nodePositions:[[0,0],[5,0]]},20:{id:20,type:0,xpos:27,ypos:29,settings:{},nodePositions:[[0,0],[0,8]]},21:{id:21,type:0,xpos:27,ypos:37,settings:{},nodePositions:[[0,0],[-5,0]]},22:{id:22,type:0,xpos:18,ypos:37,settings:{},nodePositions:[[0,0],[-5,0]]},23:{id:23,type:0,xpos:13,ypos:37,settings:{},nodePositions:[[0,0],[0,-8]]},24:{id:24,type:0,xpos:10,ypos:12,settings:{},nodePositions:[[0,0],[12,0]]},25:{id:25,type:0,xpos:24,ypos:20,settings:{},nodePositions:[[0,0],[13,0]]}}}},{name:"A diode",elements:{id:"electronics",elements:{1:{id:1,type:21,xpos:10,ypos:8,settings:{voltage:12,period:4}},2:{id:2,type:98,xpos:9,ypos:17,settings:{}},3:{id:3,type:98,xpos:54,ypos:17,settings:{}},4:{id:4,type:99,xpos:9,ypos:27,settings:{}},5:{id:5,type:99,xpos:54,ypos:27,settings:{}},6:{id:6,type:49,xpos:25,ypos:8,settings:{}},7:{id:7,type:30,xpos:55,ypos:8,settings:{resistance:1.5}},8:{id:8,type:0,xpos:10,ypos:10,settings:{},nodePositions:[[-5,0],[-5,-8]]},9:{id:9,type:0,xpos:12,ypos:27,settings:{},nodePositions:[[0,0],[-5,0]]},10:{id:10,type:0,xpos:7,ypos:27,settings:{},nodePositions:[[0,0],[0,-10]]},11:{id:11,type:0,xpos:7,ypos:17,settings:{},nodePositions:[[0,0],[5,0]]},12:{id:12,type:0,xpos:12,ypos:17,settings:{},nodePositions:[[0,0],[-2,-7]]},13:{id:13,type:0,xpos:17,ypos:10,settings:{},nodePositions:[[0,0],[-1,7]]},14:{id:14,type:0,xpos:16,ypos:17,settings:{},nodePositions:[[0,0],[5,0]]},15:{id:15,type:0,xpos:21,ypos:17,settings:{},nodePositions:[[0,0],[0,10]]},16:{id:16,type:0,xpos:21,ypos:27,settings:{},nodePositions:[[0,0],[-5,0]]},17:{id:17,type:0,xpos:17,ypos:10,settings:{},nodePositions:[[0,0],[8,0]]},18:{id:18,type:0,xpos:33,ypos:10,settings:{},nodePositions:[[0,0],[4,0]]},19:{id:19,type:97,xpos:34,ypos:10,settings:{}},20:{id:20,type:0,xpos:57,ypos:27,settings:{},nodePositions:[[0,0],[-5,0]]},21:{id:21,type:0,xpos:52,ypos:27,settings:{},nodePositions:[[0,0],[0,-10]]},22:{id:22,type:0,xpos:52,ypos:17,settings:{},nodePositions:[[0,0],[5,0]]},23:{id:23,type:0,xpos:61,ypos:17,settings:{},nodePositions:[[0,0],[5,0]]},24:{id:24,type:0,xpos:66,ypos:17,settings:{},nodePositions:[[0,0],[0,10]]},25:{id:25,type:0,xpos:66,ypos:27,settings:{},nodePositions:[[0,0],[-5,0]]},26:{id:26,type:0,xpos:52,ypos:10,settings:{},nodePositions:[[3,0],[0,7]]},27:{id:27,type:0,xpos:60,ypos:10,settings:{},nodePositions:[[3,0],[6,7]]},28:{id:28,type:0,xpos:60,ypos:10,settings:{},nodePositions:[[7,0],[7,-8]]},29:{id:29,type:0,xpos:60,ypos:5,settings:{},nodePositions:[[7,-3],[-55,-3]]},30:{id:30,type:0,xpos:41,ypos:10,settings:{},nodePositions:[[0,0],[14,0]]},32:{id:32,type:0,xpos:5,ypos:10,settings:{},nodePositions:[[0,0],[5,0]]},33:{id:33,type:0,xpos:63,ypos:10,settings:{},nodePositions:[[0,0],[4,0]]}}}},{name:"Rectifier",elements:{id:"electronics",elements:{1:{id:1,type:21,xpos:20,ypos:8,settings:{voltage:12,period:4}},2:{id:2,type:49,xpos:12,ypos:18,settings:{}},3:{id:3,type:49,xpos:20,ypos:18,settings:{}},4:{id:4,type:49,xpos:42,ypos:18,settings:{}},5:{id:5,type:49,xpos:50,ypos:18,settings:{}},6:{id:6,type:0,xpos:20,ypos:10,settings:{},nodePositions:[[0,0],[0,10]]},7:{id:7,type:0,xpos:27,ypos:10,settings:{},nodePositions:[[0,0],[23,0]]},8:{id:8,type:0,xpos:50,ypos:10,settings:{},nodePositions:[[0,0],[0,10]]},9:{id:9,type:0,xpos:12,ypos:20,settings:{},nodePositions:[[0,0],[0,10]]},10:{id:10,type:0,xpos:28,ypos:20,settings:{},nodePositions:[[0,0],[0,5]]},11:{id:11,type:0,xpos:28,ypos:25,settings:{},nodePositions:[[0,0],[30,0]]},12:{id:12,type:0,xpos:58,ypos:20,settings:{},nodePositions:[[0,0],[0,5]]},13:{id:13,type:0,xpos:12,ypos:30,settings:{},nodePositions:[[0,0],[30,0]]},14:{id:14,type:0,xpos:42,ypos:20,settings:{},nodePositions:[[0,0],[0,10]]},15:{id:15,type:0,xpos:42,ypos:30,settings:{},nodePositions:[[0,0],[25,0]]},16:{id:16,type:31,xpos:67,ypos:28,settings:{capacitance:2}},17:{id:17,type:0,xpos:58,ypos:25,settings:{},nodePositions:[[0,0],[17,0]]},18:{id:18,type:0,xpos:75,ypos:25,settings:{},nodePositions:[[0,0],[0,5]]},19:{id:19,type:98,xpos:66,ypos:36,settings:{}},20:{id:20,type:99,xpos:66,ypos:45,settings:{}},21:{id:21,type:0,xpos:67,ypos:30,settings:{},nodePositions:[[0,0],[2,6]]},22:{id:22,type:0,xpos:75,ypos:30,settings:{},nodePositions:[[0,0],[-2,6]]},23:{id:23,type:0,xpos:69,ypos:36,settings:{},nodePositions:[[0,0],[-5,0]]},24:{id:24,type:0,xpos:64,ypos:36,settings:{},nodePositions:[[0,0],[0,9]]},25:{id:25,type:0,xpos:64,ypos:45,settings:{},nodePositions:[[0,0],[5,0]]},26:{id:26,type:0,xpos:73,ypos:36,settings:{},nodePositions:[[0,0],[5,0]]},27:{id:27,type:0,xpos:78,ypos:36,settings:{},nodePositions:[[0,0],[0,9]]},28:{id:28,type:0,xpos:78,ypos:45,settings:{},nodePositions:[[0,0],[-5,0]]},29:{id:29,type:-3,xpos:54,ypos:38,settings:{},htmlElement:{editable:!0,html:"DC output"},size:[20,3.3]},30:{id:30,type:-3,xpos:20,ypos:5,settings:{},htmlElement:{editable:!0,html:"AC input"},size:[20,3.3]},31:{id:31,type:-3,xpos:52,ypos:4,settings:{},htmlElement:{editable:!0,html:"A Rectifier Circuit"},size:[20,3.3]}}}},{name:"OpAmp: Non-inverting Amp",elements:{id:"electronics",elements:{1:{id:1,type:35,xpos:41,ypos:17,settings:{}},2:{id:2,type:20,xpos:28,ypos:12,settings:{voltage:15}},3:{id:3,type:21,xpos:8,ypos:17,settings:{voltage:5,period:3}},4:{id:4,type:30,xpos:33,ypos:27,settings:{resistance:1.5}},5:{id:5,type:30,xpos:41,ypos:27,settings:{resistance:1.5}},6:{id:6,type:0,xpos:41,ypos:21,settings:{},nodePositions:[[0,0],[0,8]]},7:{id:7,type:0,xpos:16,ypos:31,settings:{},nodePositions:[[10,9],[-11,9]]},8:{id:8,type:0,xpos:5,ypos:31,settings:{},nodePositions:[[0,9],[0,-12]]},9:{id:9,type:0,xpos:5,ypos:19,settings:{},nodePositions:[[0,0],[3,0]]},10:{id:10,type:0,xpos:30,ypos:19,settings:{},nodePositions:[[17,1],[19,1]]},11:{id:11,type:0,xpos:50,ypos:20,settings:{},nodePositions:[[-1,0],[-1,9]]},12:{id:12,type:99,xpos:7,ypos:23,settings:{}},14:{id:14,type:0,xpos:44,ypos:14,settings:{},nodePositions:[[0,0],[0,3]]},15:{id:15,type:0,xpos:44,ypos:23,settings:{},nodePositions:[[0,0],[-16,0]]},16:{id:16,type:0,xpos:28,ypos:23,settings:{},nodePositions:[[0,0],[0,-9]]},17:{id:17,type:0,xpos:8,ypos:19,settings:{},nodePositions:[[0,0],[2,4]]},18:{id:18,type:0,xpos:15,ypos:19,settings:{},nodePositions:[[0,0],[-1,4]]},19:{id:19,type:0,xpos:15,ypos:19,settings:{},nodePositions:[[0,0],[26,0]]},20:{id:20,type:0,xpos:26,ypos:40,settings:{},nodePositions:[[0,0],[0,-11]]},21:{id:21,type:0,xpos:26,ypos:29,settings:{},nodePositions:[[0,0],[7,0]]},24:{id:24,type:0,xpos:29,ypos:36,settings:{},nodePositions:[[4,0],[36,0]]},25:{id:25,type:99,xpos:62,ypos:36,settings:{}},26:{id:26,type:0,xpos:49,ypos:20,settings:{},nodePositions:[[0,0],[20,0]]},27:{id:27,type:0,xpos:69,ypos:20,settings:{},nodePositions:[[0,0],[0,16]]},28:{id:28,type:-3,xpos:28,ypos:8,settings:{},htmlElement:{editable:!0,html:"OpAmp power supply"},size:[20,3.6]},29:{id:29,type:-3,xpos:4,ypos:13,settings:{},htmlElement:{editable:!0,html:"Input signal generator"},size:[20,3.6]},30:{id:30,type:-3,xpos:52,ypos:16,settings:{},htmlElement:{editable:!0,html:"Output signal"},size:[20,3.6]},31:{id:31,type:-3,xpos:67,ypos:32,settings:{},htmlElement:{editable:!0,html:"+"},size:[20,3.6]},32:{id:32,type:-3,xpos:62,ypos:33,settings:{},htmlElement:{editable:!0,html:"–"},size:[20,3.6]},33:{id:33,type:-3,xpos:16,ypos:21,settings:{},htmlElement:{editable:!0,html:"+"},size:[20,3.6]},34:{id:34,type:-3,xpos:7,ypos:21,settings:{},htmlElement:{editable:!0,html:"–"},size:[20,3.6]},35:{id:35,type:-3,xpos:36,ypos:24,settings:{},htmlElement:{editable:!0,html:"A"},size:[20,3.6]},36:{id:36,type:-3,xpos:44,ypos:24,settings:{},htmlElement:{editable:!0,html:"B"},size:[20,3.6]},37:{id:37,type:-3,xpos:37,ypos:42,settings:{},htmlElement:{editable:!0,html:"Gain = 1 + R_B / R_A"},size:[20,3.6]},38:{id:38,type:20,xpos:33,ypos:12,settings:{voltage:12}},39:{id:39,type:0,xpos:39,ypos:14,settings:{},nodePositions:[[-1,0],[5,0]]},41:{id:41,type:0,xpos:33,ypos:14,settings:{},nodePositions:[[0,0],[0,15]]},42:{id:42,type:0,xpos:33,ypos:29,settings:{},nodePositions:[[0,0],[0,7]]}}}},{name:"OpAmp: Inverting Amp",elements:{id:"electronics",elements:{1:{id:1,type:35,xpos:41,ypos:17,settings:{}},3:{id:3,type:21,xpos:8,ypos:27,settings:{voltage:5,period:3}},4:{id:4,type:30,xpos:33,ypos:27,settings:{resistance:1.5}},5:{id:5,type:30,xpos:41,ypos:27,settings:{resistance:1.5}},6:{id:6,type:0,xpos:41,ypos:21,settings:{},nodePositions:[[0,0],[0,8]]},7:{id:7,type:0,xpos:5,ypos:45,settings:{},nodePositions:[[0,-26],[0,-16]]},8:{id:8,type:0,xpos:5,ypos:29,settings:{},nodePositions:[[0,0],[3,0]]},9:{id:9,type:0,xpos:30,ypos:19,settings:{},nodePositions:[[17,1],[19,1]]},10:{id:10,type:0,xpos:50,ypos:20,settings:{},nodePositions:[[-1,0],[-1,9]]},11:{id:11,type:99,xpos:7,ypos:33,settings:{}},13:{id:13,type:0,xpos:44,ypos:14,settings:{},nodePositions:[[0,0],[0,3]]},14:{id:14,type:0,xpos:44,ypos:23,settings:{},nodePositions:[[0,0],[-10,0]]},16:{id:16,type:0,xpos:8,ypos:29,settings:{},nodePositions:[[0,0],[2,4]]},17:{id:17,type:0,xpos:15,ypos:29,settings:{},nodePositions:[[0,0],[-1,4]]},18:{id:18,type:0,xpos:15,ypos:19,settings:{},nodePositions:[[-10,0],[14,0]]},19:{id:19,type:0,xpos:26,ypos:29,settings:{},nodePositions:[[-11,0],[7,0]]},21:{id:21,type:0,xpos:29,ypos:19,settings:{},nodePositions:[[0,0],[0,17]]},22:{id:22,type:0,xpos:29,ypos:36,settings:{},nodePositions:[[0,0],[36,0]]},23:{id:23,type:99,xpos:62,ypos:36,settings:{}},24:{id:24,type:0,xpos:49,ypos:20,settings:{},nodePositions:[[0,0],[20,0]]},25:{id:25,type:0,xpos:69,ypos:20,settings:{},nodePositions:[[0,0],[0,16]]},26:{id:26,type:-3,xpos:31,ypos:8,settings:{},htmlElement:{editable:!0,html:"OpAmp power supply"},size:[20,3.6]},27:{id:27,type:-3,xpos:8,ypos:23,settings:{},htmlElement:{editable:!0,html:"Input signal generator"},size:[20,3.6]},28:{id:28,type:-3,xpos:52,ypos:16,settings:{},htmlElement:{editable:!0,html:"Output signal"},size:[20,3.6]},29:{id:29,type:-3,xpos:67,ypos:32,settings:{},htmlElement:{editable:!0,html:"+"},size:[20,3.6]},30:{id:30,type:-3,xpos:62,ypos:33,settings:{},htmlElement:{editable:!0,html:"–"},size:[20,3.6]},31:{id:31,type:-3,xpos:16,ypos:31,settings:{},htmlElement:{editable:!0,html:"+"},size:[20,3.6]},32:{id:32,type:-3,xpos:7,ypos:31,settings:{},htmlElement:{editable:!0,html:"–"},size:[20,3.6]},33:{id:33,type:-3,xpos:36,ypos:24,settings:{},htmlElement:{editable:!0,html:"A"},size:[20,3.6]},34:{id:34,type:-3,xpos:44,ypos:24,settings:{},htmlElement:{editable:!0,html:"B"},size:[20,3.6]},35:{id:35,type:-3,xpos:37,ypos:42,settings:{},htmlElement:{editable:!0,html:"Gain = –R_B / R_A"},size:[20,3.6]},37:{id:37,type:20,xpos:34,ypos:12,settings:{voltage:12}},38:{id:38,type:20,xpos:39,ypos:12,settings:{voltage:12}},40:{id:40,type:0,xpos:39,ypos:14,settings:{},nodePositions:[[0,0],[0,5]]},42:{id:42,type:0,xpos:34,ypos:14,settings:{},nodePositions:[[0,0],[0,9]]},44:{id:44,type:0,xpos:39,ypos:19,settings:{},nodePositions:[[0,0],[2,0]]},45:{id:45,type:0,xpos:39,ypos:19,settings:{},nodePositions:[[0,0],[-10,0]]}}}},{name:"OpAmp: Dimmer Switch",elements:{id:"electronics",elements:{1:{id:1,type:20,xpos:10,ypos:18,settings:{voltage:12}},2:{id:2,type:30,xpos:20,ypos:18,settings:{resistance:5}},3:{id:3,type:30,xpos:33,ypos:18,settings:{resistance:1.5}},4:{id:4,type:35,xpos:34,ypos:28,settings:{}},5:{id:5,type:0,xpos:28,ypos:20,settings:{},nodePositions:[[0,0],[0,12]]},6:{id:6,type:0,xpos:28,ypos:32,settings:{},nodePositions:[[0,0],[6,0]]},7:{id:7,type:0,xpos:37,ypos:34,settings:{},nodePositions:[[0,0],[0,4]]},8:{id:8,type:0,xpos:37,ypos:38,settings:{},nodePositions:[[0,0],[-32,0]]},9:{id:9,type:0,xpos:10,ypos:38,settings:{},nodePositions:[[0,-8],[0,-18]]},10:{id:10,type:0,xpos:15,ypos:20,settings:{},nodePositions:[[0,0],[0,6]]},11:{id:11,type:0,xpos:15,ypos:26,settings:{},nodePositions:[[0,0],[22,0]]},12:{id:12,type:0,xpos:37,ypos:26,settings:{},nodePositions:[[0,0],[0,2]]},13:{id:13,type:0,xpos:15,ypos:20,settings:{},nodePositions:[[0,0],[5,0]]},14:{id:14,type:0,xpos:28,ypos:20,settings:{},nodePositions:[[0,0],[5,0]]},15:{id:15,type:0,xpos:34,ypos:30,settings:{},nodePositions:[[0,0],[-24,0]]},17:{id:17,type:0,xpos:40,ypos:31,settings:{},nodePositions:[[0,0],[4,0]]},18:{id:18,type:0,xpos:44,ypos:31,settings:{},nodePositions:[[0,0],[0,-11]]},19:{id:19,type:0,xpos:41,ypos:20,settings:{},nodePositions:[[0,0],[3,0]]},20:{id:20,type:0,xpos:37,ypos:44,settings:{},nodePositions:[[-27,0],[4,0]]},21:{id:21,type:98,xpos:40,ypos:51,settings:{}},22:{id:22,type:0,xpos:44,ypos:31,settings:{},nodePositions:[[0,0],[4,0]]},23:{id:23,type:0,xpos:48,ypos:31,settings:{},nodePositions:[[0,0],[0,13]]},25:{id:25,type:20,xpos:5,ypos:18,settings:{voltage:12}},26:{id:26,type:0,xpos:5,ypos:20,settings:{},nodePositions:[[0,0],[0,18]]},27:{id:27,type:0,xpos:10,ypos:30,settings:{},nodePositions:[[0,0],[0,14]]},28:{id:28,type:80,xpos:41,ypos:42,settings:{}},29:{id:29,type:0,xpos:41,ypos:44,settings:{},nodePositions:[[0,0],[2,7]]},30:{id:30,type:0,xpos:48,ypos:44,settings:{},nodePositions:[[0,0],[-1,7]]},31:{id:31,type:-3,xpos:23,ypos:14,settings:{},htmlElement:{editable:!0,html:"A"},size:[20,3.6]},32:{id:32,type:-3,xpos:36,ypos:14,settings:{},htmlElement:{editable:!0,html:"B"},size:[20,3.6]},33:{id:33,type:-3,xpos:9,ypos:48,settings:{},htmlElement:{editable:!0,html:"Vary resistor B to dim the lamp"},size:[20,6]}}}},{name:"OpAmp: Buffer",elements:{id:"electronics",elements:{1:{id:1,type:20,xpos:17,ypos:8,settings:{voltage:12}},2:{id:2,type:30,xpos:10,ypos:18,settings:{resistance:2.5}},3:{id:3,type:30,xpos:22,ypos:18,settings:{resistance:2.5}},4:{id:4,type:35,xpos:22,ypos:29,settings:{}},5:{id:5,type:0,xpos:10,ypos:10,settings:{},nodePositions:[[0,0],[0,10]]},6:{id:6,type:0,xpos:18,ypos:20,settings:{},nodePositions:[[0,0],[4,0]]},7:{id:7,type:0,xpos:30,ypos:20,settings:{},nodePositions:[[0,0],[0,-10]]},8:{id:8,type:0,xpos:30,ypos:10,settings:{},nodePositions:[[0,0],[-8,0]]},9:{id:9,type:0,xpos:10,ypos:10,settings:{},nodePositions:[[0,0],[7,0]]},10:{id:10,type:0,xpos:25,ypos:27,settings:{},nodePositions:[[0,0],[5,0]]},11:{id:11,type:0,xpos:30,ypos:29,settings:{},nodePositions:[[0,-2],[0,-9]]},12:{id:12,type:0,xpos:25,ypos:35,settings:{},nodePositions:[[0,0],[0,3]]},13:{id:13,type:0,xpos:25,ypos:38,settings:{},nodePositions:[[0,0],[-15,0]]},14:{id:14,type:0,xpos:10,ypos:38,settings:{},nodePositions:[[0,0],[0,-18]]},15:{id:15,type:0,xpos:25,ypos:27,settings:{},nodePositions:[[0,0],[0,2]]},16:{id:16,type:0,xpos:28,ypos:32,settings:{},nodePositions:[[0,0],[4,0]]},17:{id:17,type:0,xpos:32,ypos:32,settings:{},nodePositions:[[0,0],[0,4]]},18:{id:18,type:0,xpos:32,ypos:36,settings:{},nodePositions:[[0,0],[-13,0]]},19:{id:19,type:0,xpos:19,ypos:36,settings:{},nodePositions:[[0,0],[0,-3]]},20:{id:20,type:0,xpos:19,ypos:33,settings:{},nodePositions:[[0,0],[3,0]]},21:{id:21,type:0,xpos:22,ypos:31,settings:{},nodePositions:[[0,0],[0,-11]]},22:{id:22,type:80,xpos:37,ypos:30,settings:{}},23:{id:23,type:0,xpos:32,ypos:32,settings:{},nodePositions:[[0,0],[5,0]]},24:{id:24,type:98,xpos:35,ypos:38,settings:{}},25:{id:25,type:0,xpos:37,ypos:31,settings:{},nodePositions:[[0,1],[1,7]]},26:{id:26,type:0,xpos:44,ypos:32,settings:{},nodePositions:[[0,0],[-2,6]]},27:{id:27,type:0,xpos:44,ypos:32,settings:{},nodePositions:[[0,0],[4,0]]},28:{id:28,type:0,xpos:48,ypos:32,settings:{},nodePositions:[[0,0],[0,15]]},29:{id:29,type:0,xpos:48,ypos:47,settings:{},nodePositions:[[0,0],[-38,0]]},30:{id:30,type:0,xpos:10,ypos:47,settings:{},nodePositions:[[0,0],[0,-9]]}}}},{name:"OpAmp: Comparator",elements:{id:"electronics",elements:{1:{id:1,type:35,xpos:41,ypos:17,settings:{}},2:{id:2,type:20,xpos:33,ypos:12,settings:{voltage:12}},3:{id:3,type:21,xpos:8,ypos:17,settings:{voltage:2.24,period:5}},4:{id:4,type:0,xpos:41,ypos:21,settings:{},nodePositions:[[0,0],[0,8]]},5:{id:5,type:0,xpos:16,ypos:31,settings:{},nodePositions:[[13,9],[-11,9]]},6:{id:6,type:0,xpos:5,ypos:31,settings:{},nodePositions:[[0,9],[0,-12]]},7:{id:7,type:0,xpos:5,ypos:19,settings:{},nodePositions:[[0,0],[3,0]]},9:{id:9,type:99,xpos:7,ypos:23,settings:{}},10:{id:10,type:0,xpos:38,ypos:14,settings:{},nodePositions:[[0,0],[6,0]]},11:{id:11,type:0,xpos:44,ypos:14,settings:{},nodePositions:[[0,0],[0,3]]},13:{id:13,type:0,xpos:29,ypos:23,settings:{},nodePositions:[[0,6],[0,-9]]},14:{id:14,type:0,xpos:8,ypos:19,settings:{},nodePositions:[[0,0],[2,4]]},15:{id:15,type:0,xpos:15,ypos:19,settings:{},nodePositions:[[0,0],[-1,4]]},16:{id:16,type:0,xpos:15,ypos:19,settings:{},nodePositions:[[0,0],[26,0]]},17:{id:17,type:0,xpos:29,ypos:40,settings:{},nodePositions:[[0,0],[0,-11]]},18:{id:18,type:0,xpos:26,ypos:29,settings:{},nodePositions:[[3,0],[15,0]]},19:{id:19,type:0,xpos:33,ypos:14,settings:{},nodePositions:[[0,0],[-4,0]]},22:{id:22,type:99,xpos:62,ypos:29,settings:{}},23:{id:23,type:0,xpos:49,ypos:20,settings:{},nodePositions:[[-2,0],[20,0]]},25:{id:25,type:-3,xpos:28,ypos:8,settings:{},htmlElement:{editable:!0,html:"OpAmp power supply"},size:[20,3.6]},26:{id:26,type:-3,xpos:4,ypos:13,settings:{},htmlElement:{editable:!0,html:"Input signal generator"},size:[20,3.6]},27:{id:27,type:-3,xpos:56,ypos:16,settings:{},htmlElement:{editable:!0,html:"Output signal"},size:[20,3.6]},29:{id:29,type:-3,xpos:7,ypos:21,settings:{},htmlElement:{editable:!0,html:"–"},size:[20,3.6]},30:{id:30,type:0,xpos:41,ypos:29,settings:{},nodePositions:[[0,0],[3,0]]},31:{id:31,type:0,xpos:44,ypos:23,settings:{},nodePositions:[[0,0],[0,6]]},33:{id:33,type:0,xpos:69,ypos:20,settings:{},nodePositions:[[0,0],[0,9]]},34:{id:34,type:0,xpos:65,ypos:29,settings:{},nodePositions:[[0,0],[-21,0]]},35:{id:35,type:-3,xpos:16,ypos:21,settings:{},htmlElement:{editable:!0,html:"+"},size:[20,3.6]}}}},{name:"RC filter",elements:{id:"electronics",elements:{1:{id:1,type:30,xpos:15,ypos:36,settings:{resistance:1.5}},2:{id:2,type:31,xpos:33,ypos:36,settings:{capacitance:2}},3:{id:3,type:21,xpos:20,ypos:3,settings:{voltage:18,period:3}},4:{id:4,type:99,xpos:19,ypos:10,settings:{}},5:{id:5,type:99,xpos:32,ypos:45,settings:{}},6:{id:6,type:98,xpos:19,ypos:25,settings:{}},7:{id:7,type:98,xpos:32,ypos:60,settings:{}},8:{id:8,type:0,xpos:20,ypos:5,settings:{},nodePositions:[[0,0],[2,5]]},9:{id:9,type:0,xpos:22,ypos:10,settings:{},nodePositions:[[0,0],[-8,0]]},10:{id:10,type:0,xpos:17,ypos:10,settings:{},nodePositions:[[-3,0],[-3,15]]},11:{id:11,type:0,xpos:16,ypos:22,settings:{},nodePositions:[[-2,3],[6,3]]},12:{id:12,type:0,xpos:26,ypos:25,settings:{},nodePositions:[[0,0],[12,0]]},13:{id:13,type:0,xpos:38,ypos:21,settings:{},nodePositions:[[0,4],[0,-11]]},14:{id:14,type:0,xpos:31,ypos:10,settings:{},nodePositions:[[7,0],[-5,0]]},15:{id:15,type:0,xpos:26,ypos:10,settings:{},nodePositions:[[0,0],[1,-5]]},16:{id:16,type:0,xpos:17,ypos:10,settings:{},nodePositions:[[-3,0],[-7,0]]},17:{id:17,type:0,xpos:10,ypos:10,settings:{},nodePositions:[[0,0],[0,28]]},18:{id:18,type:0,xpos:41,ypos:38,settings:{},nodePositions:[[0,0],[9,0]]},19:{id:19,type:0,xpos:50,ypos:34,settings:{},nodePositions:[[0,4],[0,-24]]},20:{id:20,type:0,xpos:35,ypos:10,settings:{},nodePositions:[[15,0],[3,0]]},30:{id:30,type:0,xpos:33,ypos:38,settings:{},nodePositions:[[0,0],[-10,0]]},31:{id:31,type:0,xpos:10,ypos:38,settings:{},nodePositions:[[0,0],[5,0]]},33:{id:33,type:0,xpos:28,ypos:45,settings:{},nodePositions:[[0,0],[0,15]]},34:{id:34,type:0,xpos:28,ypos:60,settings:{},nodePositions:[[0,0],[7,0]]},35:{id:35,type:0,xpos:39,ypos:60,settings:{},nodePositions:[[0,0],[12,0]]},36:{id:36,type:0,xpos:51,ypos:60,settings:{},nodePositions:[[0,0],[0,-15]]},37:{id:37,type:0,xpos:51,ypos:45,settings:{},nodePositions:[[0,0],[-10,0]]},38:{id:38,type:0,xpos:41,ypos:45,settings:{},nodePositions:[[0,0],[-2,0]]},39:{id:39,type:0,xpos:35,ypos:45,settings:{},nodePositions:[[0,0],[-2,0]]},40:{id:40,type:0,xpos:33,ypos:45,settings:{},nodePositions:[[0,0],[-5,0]]},41:{id:41,type:0,xpos:33,ypos:38,settings:{},nodePositions:[[0,0],[0,7]]},42:{id:42,type:0,xpos:41,ypos:38,settings:{},nodePositions:[[0,0],[0,7]]}}}},{name:"Flip-flop (two transistors)",elements:{id:"electronics",elements:{1:{id:1,type:20,xpos:10,ypos:8,settings:{voltage:12}},2:{id:2,type:30,xpos:20,ypos:13,settings:{resistance:1.5}},3:{id:3,type:30,xpos:28,ypos:16,settings:{resistance:1.5}},4:{id:4,type:30,xpos:58,ypos:18,settings:{resistance:1.5}},5:{id:5,type:30,xpos:66,ypos:13,settings:{resistance:1.5}},6:{id:6,type:40,xpos:23,ypos:32,settings:{}},7:{id:7,type:40,xpos:61,ypos:32,settings:{}},8:{id:8,type:10,xpos:53,ypos:38,settings:{}},9:{id:9,type:10,xpos:15,ypos:38,settings:{}},11:{id:11,type:0,xpos:15,ypos:10,settings:{},nodePositions:[[0,0],[5,0]]},12:{id:12,type:0,xpos:20,ypos:10,settings:{},nodePositions:[[0,0],[0,5]]},13:{id:13,type:0,xpos:28,ypos:15,settings:{},nodePositions:[[0,0],[0,3]]},14:{id:14,type:0,xpos:28,ypos:20,settings:{},nodePositions:[[0,-2],[0,12]]},15:{id:15,type:0,xpos:50,ypos:25,settings:{},nodePositions:[[16,7],[16,-5]]},16:{id:16,type:0,xpos:58,ypos:20,settings:{},nodePositions:[[8,0],[8,-5]]},17:{id:17,type:0,xpos:74,ypos:15,settings:{},nodePositions:[[0,0],[0,-5]]},18:{id:18,type:0,xpos:20,ypos:10,settings:{},nodePositions:[[0,0],[54,0]]},20:{id:20,type:0,xpos:36,ypos:20,settings:{},nodePositions:[[0,-2],[25,16]]},21:{id:21,type:0,xpos:23,ypos:36,settings:{},nodePositions:[[0,0],[0,5]]},22:{id:22,type:0,xpos:15,ypos:41,settings:{},nodePositions:[[0,0],[0,9]]},23:{id:23,type:0,xpos:53,ypos:41,settings:{},nodePositions:[[0,0],[0,9]]},24:{id:24,type:0,xpos:37,ypos:53,settings:{},nodePositions:[[-9,-3],[-22,-3]]},25:{id:25,type:0,xpos:15,ypos:50,settings:{},nodePositions:[[0,0],[-5,0]]},26:{id:26,type:0,xpos:10,ypos:5,settings:{},nodePositions:[[0,5],[0,45]]},27:{id:27,type:0,xpos:53,ypos:50,settings:{},nodePositions:[[0,0],[13,0]]},28:{id:28,type:0,xpos:66,ypos:40,settings:{},nodePositions:[[0,0],[0,10]]},29:{id:29,type:0,xpos:28,ypos:40,settings:{},nodePositions:[[0,0],[0,10]]},30:{id:30,type:0,xpos:28,ypos:50,settings:{},nodePositions:[[0,0],[16,0]]},31:{id:31,type:0,xpos:50,ypos:20,settings:{},nodePositions:[[8,0],[-27,10]]},32:{id:32,type:0,xpos:23,ypos:24,settings:{},nodePositions:[[0,6],[0,12]]},33:{id:33,type:30,xpos:28,ypos:30,settings:{resistance:4}},34:{id:34,type:81,xpos:36,ypos:30,settings:{}},41:{id:41,type:0,xpos:44,ypos:32,settings:{},nodePositions:[[0,0],[0,18]]},42:{id:42,type:0,xpos:61,ypos:36,settings:{},nodePositions:[[0,0],[0,5]]},43:{id:43,type:30,xpos:66,ypos:30,settings:{resistance:4}},44:{id:44,type:81,xpos:74,ypos:30,settings:{}},45:{id:45,type:0,xpos:82,ypos:32,settings:{},nodePositions:[[0,0],[0,18]]},46:{id:46,type:0,xpos:82,ypos:50,settings:{},nodePositions:[[0,0],[-16,0]]},47:{id:47,type:0,xpos:53,ypos:50,settings:{},nodePositions:[[0,0],[-9,0]]}}}}];function E(t,i){var a=this;this.M=t,this.$t=C,this._=i,this.Ns=[255,0,0],this.Is=[0,0,0],this.Bs=150,this.Es=null,this.Cs=null,this.As=null,this.Fs="logic_gates",

this.Ls={
1:{id:1,stringLike:!0, name:"wire",shortName:["Fil", ""],size:[8,0],nodePositions:[[0,0],[8,0]],drawInstructions:[["line_colored",[0,0],[8,0],[1,0],[0,1]]],htmlBelow:null,hook_initialise:null,hook_setOutput:null,hook_propagate:function(t,i){a.le(t,i)},hook_updateState:null},
	
11:{id:11,stringLike:!1,name:"switch",shortName:["Interrup.", ""],size:[8,3],nodePositions:[[0,3],[8,3]],drawInstructions:[["line_colored",[0,3],[2.5,3],[1,0],[1,0]],["line_colored",[5.5,3],[8,3],[0,1],[0,1]],["line_colored",[2.5,3],[5,1],[1,0],[1,0]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,3],.4]],drawInstructions_variants:[[["line_colored",[0,3],[8,3],[1,0],[0,1]],["circle_filled",[2.5,3],.4],["circle_filled",[5.5,3],.4]]],htmlBelow:'<input class="btn btn-success clickable" type="button" value="Appuyer" />',hook_initialise:function(t,i){t.switchState=!1,t.variantState=null},hook_setOutput:null,hook_propagate:function(t,i){t.switchState&&a.le(t,i)},hook_updateState:null,hook_buttonClick:function(t,i){t.switchState=!t.switchState,t.variantState=t.switchState?0:null}},

20:{id:20,stringLike:!1,name:"positive input",shortName:["Entrée","à 1"],size:[5,4],nodePositions:[[5,2]],drawInstructions:[["line_colored",[3,2],[5,2],[1],[1]],["text",[1,2],"1"]],htmlBelow:null,hook_initialise:null,hook_setOutput:function(t,i){i[t.nodeNames[0]]=[t.id,0,1]},hook_propagate:null,hook_updateState:null},

21:{id:21,stringLike:!1,name:"zero input",shortName:["Entrée","à 0"],size:[5,4],nodePositions:[[5,2]],drawInstructions:[["line_colored",[3,2],[5,2],[1],[1]],["text",[1,2],"0"]],htmlBelow:null,hook_initialise:null,hook_setOutput:function(t,i){i[t.nodeNames[0]]=[t.id,0,0]},hook_propagate:null,hook_updateState:null},

30:{id:30,stringLike:!1,name:"LED output",shortName:["Sortie","LED"],size:[5,4],nodePositions:[[0,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1],[1]],["circle",[3.5,2],1.5]],drawInstructions_variants:[[["line_colored",[0,2],[2,2],[1],[1]],["circle_filled",[3.5,2],1.5,"red"],["circle",[3.5,2],1.5]]],htmlBelow:null,hook_initialise:function(t,i){t.variantState=null},hook_setOutput:null,hook_propagate:null,hook_updateState:function(t,i){var s=t.nodeNames[0],s=a.pe(s);t.variantState=s?0:null}},

31:{id:31,stringLike:!1,name:"hexadecimal digit display",shortName:["Afficheur","hexadéc."],size:[5,5],nodePositions:[[0,1],[0,2],[0,3],[0,4]],drawInstructions:[["line_colored",[0,1],[2,1],[1,0,0,0],[1,0,0,0]],["line_colored",[0,2],[2,2],[0,1,0,0],[0,1,0,0]],["line_colored",[0,3],[2,3],[0,0,1,0],[0,0,1,0]],["line_colored",[0,4],[2,4],[0,0,0,1],[0,0,0,1]],["line_filled",[[2,.5],[2,4.5],[4.5,4.5],[4.5,.5]]],["text_custom","digitState",[3.2,2.6],26,"#ff4444"]],htmlBelow:null,hook_initialise:function(t,i){t.digitState=null},hook_setOutput:null,hook_propagate:null,hook_updateState:function(t,i){var s=0;a.pe(t.nodeNames[0])&&(s+=8),a.pe(t.nodeNames[1])&&(s+=4),a.pe(t.nodeNames[2])&&(s+=2),a.pe(t.nodeNames[3])&&(s+=1),t.digitState="0123456789ABCDEF".slice(s,s+1)}},

40:{id:40,stringLike:!1,name:"NOT gate",shortName:["Porte","NON"],size:[8,4],nodePositions:[[0,2],[8,2]],drawInstructions:[["line_colored",[0,2],[2,2],[1,0],[1,0]],["line_colored",[6,2],[8,2],[0,1],[0,1]],["line_closed",[[2,0],[2,4],[5,2]]],["circle",[5.5,2],.5]],htmlBelow:null,hook_initialise:function(t,i){t.outputState=!1},hook_setOutput:function(t,i){i[t.nodeNames[1]]=[t.id,0,t.outputState?1:0]},hook_propagate:null,hook_updateState:function(t,i){var s=a.pe(t.nodeNames[0]);t.outputState=!s}},

41:{id:41,stringLike:!1,name:"AND gate",shortName:["Porte","ET"],size:[8,4],nodePositions:[[0,1],[0,3],[8,2]],drawInstructions:[["line_colored",[0,1],[2,1],[1,0,0],[1,0,0]],["line_colored",[0,3],[2,3],[0,1,0],[0,1,0]],["line_colored",[6,2],[8,2],[0,0,1],[0,0,1]],["line_open",[[4,0],[2,0],[2,4],[4,4]]],["bezier",[4,0],[6,2],[5,0],[6,1]],["bezier",[4,4],[6,2],[5,4],[6,3]]],htmlBelow:null,hook_initialise:function(t,i){t.outputState=!1},hook_setOutput:function(t,i){i[t.nodeNames[2]]=[t.id,0,t.outputState?1:0]},hook_propagate:null,hook_updateState:function(t,i){var s=a.pe(t.nodeNames[0]),n=a.pe(t.nodeNames[1]);t.outputState=s&&n}},

42:{id:42,stringLike:!1,name:"OR gate",shortName:["Porte","OU"],size:[8,4],nodePositions:[[0,1],[0,3],[8,2]],drawInstructions:[["line_colored",[0,1],[2.5,1],[1,0,0],[1,0,0]],["line_colored",[0,3],[2.5,3],[0,1,0],[0,1,0]],["line_colored",[6,2],[8,2],[0,0,1],[0,0,1]],["bezier",[2,0],[2,4],[2.9,.9],[2.9,3.1]],["bezier",[2,0],[6,2],[4,0],[5.5,1]],["bezier",[2,4],[6,2],[4,4],[5.5,3]]],htmlBelow:null,hook_initialise:function(t,i){t.outputState=!1},hook_setOutput:function(t,i){i[t.nodeNames[2]]=[t.id,0,t.outputState?1:0]},hook_propagate:null,hook_updateState:function(t,i){var s=a.pe(t.nodeNames[0]),n=a.pe(t.nodeNames[1]);t.outputState=s||n}},

45:{id:45, stringLike:!1, name:"XOR gate", shortName:["Porte OU","EXCLUSIF"], size:[8,4], nodePositions:[[0,1],[0,3],[8,2]], drawInstructions:[["line_colored",[0,1],[2.5,1],[1,0,0],[1,0,0]],["line_colored",[0,3],[2.5,3],[0,1,0],[0,1,0]],["line_colored",[6,2],[8,2],[0,0,1],[0,0,1]],["bezier",[1.25,0],[1.25,4],[2.15,.9],[2.15,3.1]],["bezier",[2,0],[2,4],[2.9,.9],[2.9,3.1]],["bezier",[2,0],[6,2],[4,0],[5.5,1]],["bezier",[2,4],[6,2],[4,4],[5.5,3]]], htmlBelow:null, hook_initialise:function(t,i){t.outputState=!1}, hook_setOutput:function(t,i){i[t.nodeNames[2]]=[t.id,0,t.outputState?1:0]}, hook_propagate:null, hook_updateState:function(t,i){var s=a.pe(t.nodeNames[0]),n=a.pe(t.nodeNames[1]);t.outputState=s&&!n||n&&!s}},

},

this.Pi=new A(this,1)}E.prototype.pe=function(t){if(!this.As.hasOwnProperty(t))return 0;t=this.As[t];return!(t.length<3)&&t[2]?1:0},E.prototype.le=function(t,e,i){void 0===i&&(i=t.nodeNames);var o=null,h=null,a=null;$.each(i,function(t,i){var s,n=e[i];n.length<3||(s=n[0],i=n[1],n=n[2],(null===h||i<h)&&(o=s,h=i,a=n))}),null!==h&&(h+=1,$.each(i,function(t,i){var s=e[i],s=3<=s.length?s[1]:null;(null===s||h<s)&&(e[i]=[o,h,a])}))},E.prototype.Zn=function(t){},E.prototype.te=function(){},E.prototype.ie=function(t){var i=this.Pi.se[t],s=i.type;if(-3===s){var n=prompt("Texte de l'étiquette :",i.htmlElement.html);return n&&(i.htmlElement.html=$("<div>").text(n).html()),this.Pi.ne(i),void this.Pi.Vt()}null!==this.Es&&this.Es.hasOwnProperty(t)&&(i=this.Es[t],(s=this.Ls[s]).hasOwnProperty("hook_buttonClick")&&s.hook_buttonClick(i,this.As))},E.prototype.Yn=function(){var t,i,n=this;for(this.Pi.qn(),i=0;i<3;i++){for(this.Pi.ae("setOutput"),t=0;t<25;t++)this.Pi.ae("propagate");this.Pi.ae("updateState")}$.each(this.Es,function(t,i){var s=[];$.each(i.nodeNames,function(t,i){i=n.pe(i);s.push(i?n.Ns:n.Is)}),i.nodeColors=s})},$(function(){$(".sim_logic_gates").each(function(t,i){var s=$(i),i=new E(s.data("meta"),s);s.data("handler",i)})});




var C=[{name:"Flip-flop (two NOR gates)",elements:{id:"logic_gates",elements:{1:{id:1,type:20,xpos:5,ypos:18,settings:{}},2:{id:2,type:10,xpos:20,ypos:7,settings:{}},3:{id:3,type:10,xpos:20,ypos:27,settings:{}},4:{id:4,type:44,xpos:40,ypos:9,settings:{}},5:{id:5,type:44,xpos:40,ypos:27,settings:{}},6:{id:6,type:30,xpos:55,ypos:9,settings:{}},7:{id:7,type:30,xpos:55,ypos:27,settings:{}},8:{id:8,type:1,xpos:10,ypos:20,settings:{},nodePositions:[[0,0],[10,-10]]},9:{id:9,type:1,xpos:10,ypos:20,settings:{},nodePositions:[[0,0],[10,10]]},10:{id:10,type:1,xpos:28,ypos:10,settings:{},nodePositions:[[0,0],[12,0]]},11:{id:11,type:1,xpos:28,ypos:30,settings:{},nodePositions:[[0,0],[12,0]]},12:{id:12,type:1,xpos:40,ypos:12,settings:{},nodePositions:[[0,0],[9,17]]},13:{id:13,type:1,xpos:40,ypos:28,settings:{},nodePositions:[[0,0],[9,-17]]},14:{id:14,type:1,xpos:49,ypos:11,settings:{},nodePositions:[[0,0],[6,0]]},15:{id:15,type:1,xpos:49,ypos:29,settings:{},nodePositions:[[0,0],[6,0]]}}}},{name:"Ripple counter (JK flip-flops)",elements:{id:"logic_gates",elements:{1:{id:1,type:62,xpos:18,ypos:13,settings:{}},2:{id:2,type:62,xpos:34,ypos:13,settings:{}},3:{id:3,type:62,xpos:49,ypos:13,settings:{}},4:{id:4,type:62,xpos:64,ypos:13,settings:{}},5:{id:5,type:20,xpos:5,ypos:16,settings:{}},6:{id:6,type:10,xpos:10,ypos:15,settings:{}},7:{id:7,type:1,xpos:18,ypos:14,settings:{},nodePositions:[[0,0],[0,2]]},8:{id:8,type:1,xpos:34,ypos:14,settings:{},nodePositions:[[0,0],[0,2]]},9:{id:9,type:1,xpos:49,ypos:14,settings:{},nodePositions:[[0,0],[0,2]]},10:{id:10,type:1,xpos:64,ypos:14,settings:{},nodePositions:[[0,0],[0,2]]},11:{id:11,type:1,xpos:64,ypos:14,settings:{},nodePositions:[[0,0],[0,-3]]},12:{id:12,type:1,xpos:64,ypos:11,settings:{},nodePositions:[[0,0],[-15,0]]},13:{id:13,type:1,xpos:49,ypos:11,settings:{},nodePositions:[[0,0],[0,3]]},14:{id:14,type:1,xpos:49,ypos:11,settings:{},nodePositions:[[0,0],[-15,0]]},15:{id:15,type:1,xpos:34,ypos:11,settings:{},nodePositions:[[0,0],[0,3]]},16:{id:16,type:1,xpos:34,ypos:11,settings:{},nodePositions:[[0,0],[-16,0]]},17:{id:17,type:1,xpos:18,ypos:11,settings:{},nodePositions:[[0,0],[0,3]]},18:{id:18,type:1,xpos:18,ypos:11,settings:{},nodePositions:[[0,0],[-8,0]]},19:{id:19,type:20,xpos:5,ypos:9,settings:{}},20:{id:20,type:1,xpos:27,ypos:14,settings:{},nodePositions:[[0,0],[3,0]]},21:{id:21,type:1,xpos:30,ypos:14,settings:{},nodePositions:[[0,0],[0,14]]},22:{id:22,type:1,xpos:43,ypos:14,settings:{},nodePositions:[[0,0],[3,0]]},23:{id:23,type:1,xpos:46,ypos:14,settings:{},nodePositions:[[0,0],[0,13]]},24:{id:24,type:1,xpos:58,ypos:14,settings:{},nodePositions:[[0,0],[3,0]]},25:{id:25,type:1,xpos:61,ypos:14,settings:{},nodePositions:[[0,0],[0,12]]},27:{id:27,type:1,xpos:77,ypos:14,settings:{},nodePositions:[[-4,0],[-1,0]]},30:{id:30,type:1,xpos:76,ypos:14,settings:{},nodePositions:[[0,0],[0,11]]},31:{id:31,type:1,xpos:27,ypos:17,settings:{},nodePositions:[[0,0],[7,1]]},32:{id:32,type:1,xpos:43,ypos:17,settings:{},nodePositions:[[0,0],[6,1]]},33:{id:33,type:1,xpos:58,ypos:17,settings:{},nodePositions:[[0,0],[6,1]]},34:{id:34,type:31,xpos:80,ypos:24,settings:{}},35:{id:35,type:1,xpos:76,ypos:25,settings:{},nodePositions:[[0,0],[4,0]]},36:{id:36,type:1,xpos:80,ypos:26,settings:{},nodePositions:[[0,0],[-19,0]]},37:{id:37,type:1,xpos:80,ypos:27,settings:{},nodePositions:[[0,0],[-34,0]]},38:{id:38,type:1,xpos:80,ypos:28,settings:{},nodePositions:[[0,0],[-50,0]]},39:{id:39,type:-3,xpos:20,ypos:6,settings:{},htmlElement:{editable:!0,html:"Bit 1"},size:[20,3.3]},40:{id:40,type:-3,xpos:36,ypos:6,settings:{},htmlElement:{editable:!0,html:"Bit 2"},size:[20,3.3]},41:{id:41,type:-3,xpos:51,ypos:6,settings:{},htmlElement:{editable:!0,html:"Bit 3"},size:[20,3.3]},42:{id:42,type:-3,xpos:66,ypos:6,settings:{},htmlElement:{editable:!0,html:"Bit 4"},size:[20,3.3]},43:{id:43,type:-3,xpos:8,ypos:27,settings:{},htmlElement:{editable:!0,html:"Press the button to increment the counter"},size:[20,5.4]}}}},{name:"Shift register",elements:{id:"logic_gates",elements:{1:{id:1,type:20,xpos:5,ypos:13,settings:{}},2:{id:2,type:22,xpos:3,ypos:23,settings:{}},3:{id:3,type:11,xpos:10,ypos:12,settings:{}},4:{id:4,type:61,xpos:30,ypos:14,settings:{}},5:{id:5,type:1,xpos:10,ypos:25,settings:{},nodePositions:[[0,0],[20,0]]},6:{id:6,type:1,xpos:30,ypos:25,settings:{},nodePositions:[[0,0],[0,-7]]},7:{id:7,type:61,xpos:45,ypos:14,settings:{}},8:{id:8,type:61,xpos:60,ypos:14,settings:{}},9:{id:9,type:61,xpos:75,ypos:14,settings:{}},10:{id:10,type:1,xpos:30,ypos:25,settings:{},nodePositions:[[0,0],[15,0]]},11:{id:11,type:1,xpos:45,ypos:25,settings:{},nodePositions:[[0,0],[0,-7]]},12:{id:12,type:1,xpos:45,ypos:25,settings:{},nodePositions:[[0,0],[15,0]]},13:{id:13,type:1,xpos:60,ypos:25,settings:{},nodePositions:[[0,0],[0,-7]]},14:{id:14,type:1,xpos:60,ypos:25,settings:{},nodePositions:[[0,0],[15,0]]},15:{id:15,type:1,xpos:75,ypos:25,settings:{},nodePositions:[[0,0],[0,-7]]},16:{id:16,type:1,xpos:69,ypos:15,settings:{},nodePositions:[[0,0],[6,0]]},17:{id:17,type:1,xpos:54,ypos:15,settings:{},nodePositions:[[0,0],[6,0]]},18:{id:18,type:1,xpos:39,ypos:15,settings:{},nodePositions:[[0,0],[6,0]]},19:{id:19,type:1,xpos:18,ypos:15,settings:{},nodePositions:[[0,0],[12,0]]},20:{id:20,type:30,xpos:39,ypos:8,settings:{}},21:{id:21,type:30,xpos:54,ypos:8,settings:{}},22:{id:22,type:30,xpos:69,ypos:8,settings:{}},23:{id:23,type:30,xpos:84,ypos:8,settings:{}},24:{id:24,type:1,xpos:39,ypos:10,settings:{},nodePositions:[[0,0],[0,5]]},25:{id:25,type:1,xpos:54,ypos:10,settings:{},nodePositions:[[0,0],[0,5]]},26:{id:26,type:1,xpos:69,ypos:10,settings:{},nodePositions:[[0,0],[0,5]]},27:{id:27,type:1,xpos:84,ypos:10,settings:{},nodePositions:[[0,0],[0,5]]},28:{id:28,type:30,xpos:30,ypos:28,settings:{}},29:{id:29,type:1,xpos:30,ypos:25,settings:{},nodePositions:[[0,0],[0,5]]},30:{id:30,type:-3,xpos:30,ypos:33,settings:{},htmlElement:{editable:!0,html:"Clock pulses"},size:[20,3.3]},31:{id:31,type:-3,xpos:41,ypos:5,settings:{},htmlElement:{editable:!0,html:"Bit 1"},size:[20,3.3]},32:{id:32,type:-3,xpos:56,ypos:5,settings:{},htmlElement:{editable:!0,html:"Bit 2"},size:[20,3.3]},33:{id:33,type:-3,xpos:71,ypos:5,settings:{},htmlElement:{editable:!0,html:"Bit 3"},size:[20,3.3]},34:{id:34,type:-3,xpos:86,ypos:5,settings:{},htmlElement:{editable:!0,html:"Bit 4"},size:[20,3.3]},35:{id:35,type:-3,xpos:7,ypos:6,settings:{},htmlElement:{editable:!0,html:"Toggle switch to set input"},size:[20,3.3]}}}},{name:"4-bit addition",elements:{id:"logic_gates",elements:{1:{id:1,type:11,xpos:10,ypos:10,settings:{}},2:{id:2,type:11,xpos:10,ypos:22,settings:{}},3:{id:3,type:11,xpos:10,ypos:34,settings:{}},4:{id:4,type:11,xpos:10,ypos:46,settings:{}},5:{id:5,type:11,xpos:10,ypos:64,settings:{}},6:{id:6,type:11,xpos:10,ypos:76,settings:{}},7:{id:7,type:11,xpos:10,ypos:88,settings:{}},8:{id:8,type:11,xpos:10,ypos:100,settings:{}},9:{id:9,type:20,xpos:5,ypos:11,settings:{}},10:{id:10,type:-3,xpos:11,ypos:4,settings:{},htmlElement:{editable:!0,html:"Input 1"},size:[20,3.6]},11:{id:11,type:-3,xpos:15,ypos:9,settings:{},htmlElement:{editable:!0,html:"Bit 1"},size:[20,3.6]},12:{id:12,type:-3,xpos:15,ypos:21,settings:{},htmlElement:{editable:!0,html:"Bit 2"},size:[20,3.6]},13:{id:13,type:-3,xpos:15,ypos:87,settings:{},htmlElement:{editable:!0,html:"Bit 3"},size:[20,3.6]},14:{id:14,type:-3,xpos:15,ypos:45,settings:{},htmlElement:{editable:!0,html:"Bit 4"},size:[20,3.6]},15:{id:15,type:-3,xpos:15,ypos:63,settings:{},htmlElement:{editable:!0,html:"Bit 1"},size:[20,3.6]},16:{id:16,type:-3,xpos:15,ypos:75,settings:{},htmlElement:{editable:!0,html:"Bit 2"},size:[20,3.6]},17:{id:17,type:-3,xpos:15,ypos:33,settings:{},htmlElement:{editable:!0,html:"Bit 3"},size:[20,3.6]},18:{id:18,type:-3,xpos:15,ypos:99,settings:{},htmlElement:{editable:!0,html:"Bit 4"},size:[20,3.6]},19:{id:19,type:-3,xpos:12,ypos:60,settings:{},htmlElement:{editable:!0,html:"Input 2"},size:[20,3.6]},20:{id:20,type:1,xpos:10,ypos:13,settings:{},nodePositions:[[0,0],[0,12]]},21:{id:21,type:1,xpos:10,ypos:25,settings:{},nodePositions:[[0,0],[0,12]]},22:{id:22,type:1,xpos:5,ypos:35,settings:{},nodePositions:[[5,2],[5,14]]},23:{id:23,type:1,xpos:8,ypos:50,settings:{},nodePositions:[[2,-1],[2,17]]},24:{id:24,type:1,xpos:4,ypos:34,settings:{},nodePositions:[[6,45],[6,33]]},25:{id:25,type:1,xpos:10,ypos:79,settings:{},nodePositions:[[0,0],[0,12]]},26:{id:26,type:1,xpos:6,ypos:92,settings:{},nodePositions:[[4,-1],[4,11]]},27:{id:27,type:31,xpos:28,ypos:5,settings:{}},28:{id:28,type:31,xpos:28,ypos:59,settings:{}},29:{id:29,type:1,xpos:52,ypos:12,settings:{},nodePositions:[[-29,1],[-34,1]]},30:{id:30,type:1,xpos:56,ypos:17,settings:{},nodePositions:[[-33,-8],[-33,-4]]},31:{id:31,type:1,xpos:58,ypos:23,settings:{},nodePositions:[[-30,-14],[-35,-14]]},32:{id:32,type:1,xpos:62,ypos:27,settings:{},nodePositions:[[-38,-2],[-44,-2]]},33:{id:33,type:1,xpos:71,ypos:15,settings:{},nodePositions:[[-47,-7],[-47,10]]},34:{id:34,type:1,xpos:59,ypos:8,settings:{},nodePositions:[[-31,0],[-35,0]]},35:{id:35,type:1,xpos:61,ypos:11,settings:{},nodePositions:[[-43,26],[-36,26]]},36:{id:36,type:1,xpos:64,ypos:14,settings:{},nodePositions:[[-39,23],[-39,-7]]},37:{id:37,type:1,xpos:67,ypos:16,settings:{},nodePositions:[[-42,-9],[-39,-9]]},38:{id:38,type:1,xpos:68,ypos:19,settings:{},nodePositions:[[-50,30],[-42,30]]},39:{id:39,type:1,xpos:70,ypos:21,settings:{},nodePositions:[[-44,28],[-44,-15]]},40:{id:40,type:1,xpos:71,ypos:25,settings:{},nodePositions:[[-45,-19],[-43,-19]]},41:{id:41,type:1,xpos:73,ypos:28,settings:{},nodePositions:[[-55,39],[-50,39]]},42:{id:42,type:1,xpos:76,ypos:35,settings:{},nodePositions:[[-53,32],[-53,28]]},43:{id:43,type:1,xpos:59,ypos:8,settings:{},nodePositions:[[-31,55],[-36,55]]},44:{id:44,type:1,xpos:75,ypos:63,settings:{},nodePositions:[[-51,16],[-57,16]]},45:{id:45,type:1,xpos:76,ypos:65,settings:{},nodePositions:[[-52,-3],[-52,14]]},46:{id:46,type:1,xpos:77,ypos:68,settings:{},nodePositions:[[-49,-6],[-53,-6]]},47:{id:47,type:1,xpos:79,ypos:71,settings:{},nodePositions:[[-54,20],[-61,20]]},48:{id:48,type:1,xpos:82,ypos:73,settings:{},nodePositions:[[-57,-12],[-57,18]]},49:{id:49,type:1,xpos:84,ypos:75,settings:{},nodePositions:[[-56,-14],[-59,-14]]},50:{id:50,type:1,xpos:85,ypos:86,settings:{},nodePositions:[[-59,17],[-67,17]]},51:{id:51,type:1,xpos:88,ypos:84,settings:{},nodePositions:[[-62,-24],[-62,19]]},52:{id:52,type:1,xpos:26,ypos:60,settings:{},nodePositions:[[0,0],[2,0]]},53:{id:53,type:1,xpos:23,ypos:13,settings:{},nodePositions:[[0,0],[19,0]]},54:{id:54,type:45,xpos:44,ypos:12,settings:{}},55:{id:55,type:45,xpos:56,ypos:13,settings:{}},56:{id:56,type:1,xpos:48,ypos:14,settings:{},nodePositions:[[4,0],[8,0]]},57:{id:57,type:1,xpos:23,ypos:67,settings:{},nodePositions:[[0,0],[11,0]]},58:{id:58,type:1,xpos:34,ypos:67,settings:{},nodePositions:[[0,0],[0,-52]]},59:{id:59,type:1,xpos:34,ypos:15,settings:{},nodePositions:[[0,0],[9,0]]},60:{id:60,type:1,xpos:50,ypos:7,settings:{},nodePositions:[[4,0],[4,9]]},61:{id:61,type:1,xpos:50,ypos:16,settings:{},nodePositions:[[4,0],[6,0]]},62:{id:62,type:41,xpos:56,ypos:19,settings:{}},63:{id:63,type:41,xpos:56,ypos:25,settings:{}},64:{id:64,type:42,xpos:64,ypos:22,settings:{}},65:{id:65,type:1,xpos:56,ypos:26,settings:{},nodePositions:[[0,0],[-13,0]]},66:{id:66,type:1,xpos:43,ypos:26,settings:{},nodePositions:[[0,0],[0,-11]]},67:{id:67,type:1,xpos:56,ypos:28,settings:{},nodePositions:[[0,0],[-14,0]]},68:{id:68,type:1,xpos:42,ypos:28,settings:{},nodePositions:[[0,0],[0,-15]]},69:{id:69,type:1,xpos:42,ypos:13,settings:{},nodePositions:[[0,0],[2,0]]},70:{id:70,type:1,xpos:43,ypos:15,settings:{},nodePositions:[[0,0],[1,0]]},71:{id:71,type:1,xpos:52,ypos:14,settings:{},nodePositions:[[0,0],[0,8]]},72:{id:72,type:1,xpos:52,ypos:22,settings:{},nodePositions:[[0,0],[4,0]]},73:{id:73,type:1,xpos:54,ypos:16,settings:{},nodePositions:[[0,0],[0,4]]},74:{id:74,type:1,xpos:54,ypos:20,settings:{},nodePositions:[[0,0],[2,0]]},75:{id:75,type:1,xpos:76,ypos:18,settings:{},nodePositions:[[-12,3],[-12,5]]},76:{id:76,type:1,xpos:81,ypos:16,settings:{},nodePositions:[[-17,11],[-17,9]]},77:{id:77,type:1,xpos:72,ypos:24,settings:{},nodePositions:[[0,0],[0,11]]},78:{id:78,type:1,xpos:72,ypos:35,settings:{},nodePositions:[[0,0],[-18,0]]},79:{id:79,type:45,xpos:44,ypos:37,settings:{}},80:{id:80,type:45,xpos:56,ypos:38,settings:{}},81:{id:81,type:41,xpos:56,ypos:44,settings:{}},82:{id:82,type:41,xpos:56,ypos:50,settings:{}},83:{id:83,type:42,xpos:64,ypos:47,settings:{}},84:{id:84,type:1,xpos:54,ypos:60,settings:{},nodePositions:[[0,0],[18,0]]},85:{id:85,type:1,xpos:72,ypos:60,settings:{},nodePositions:[[0,0],[0,-11]]},86:{id:86,type:1,xpos:54,ypos:35,settings:{},nodePositions:[[0,0],[0,6]]},87:{id:87,type:1,xpos:54,ypos:41,settings:{},nodePositions:[[0,0],[2,0]]},88:{id:88,type:1,xpos:52,ypos:39,settings:{},nodePositions:[[0,0],[4,0]]},89:{id:89,type:1,xpos:54,ypos:41,settings:{},nodePositions:[[0,0],[0,4]]},90:{id:90,type:1,xpos:54,ypos:45,settings:{},nodePositions:[[0,0],[2,0]]},91:{id:91,type:1,xpos:44,ypos:40,settings:{},nodePositions:[[0,0],[-1,0]]},92:{id:92,type:1,xpos:43,ypos:40,settings:{},nodePositions:[[0,0],[0,11]]},93:{id:93,type:1,xpos:43,ypos:51,settings:{},nodePositions:[[0,0],[13,0]]},94:{id:94,type:1,xpos:44,ypos:38,settings:{},nodePositions:[[0,0],[-2,0]]},95:{id:95,type:1,xpos:42,ypos:38,settings:{},nodePositions:[[0,0],[0,15]]},96:{id:96,type:1,xpos:42,ypos:53,settings:{},nodePositions:[[0,0],[14,0]]},97:{id:97,type:1,xpos:64,ypos:48,settings:{},nodePositions:[[0,0],[0,-2]]},98:{id:98,type:1,xpos:64,ypos:50,settings:{},nodePositions:[[0,0],[0,2]]},99:{id:99,type:1,xpos:56,ypos:47,settings:{},nodePositions:[[0,0],[-4,0]]},100:{id:100,type:1,xpos:52,ypos:47,settings:{},nodePositions:[[0,0],[0,-8]]},101:{id:101,type:1,xpos:24,ypos:25,settings:{},nodePositions:[[0,0],[15,0]]},102:{id:102,type:1,xpos:33,ypos:22,settings:{},nodePositions:[[6,3],[6,16]]},103:{id:103,type:1,xpos:33,ypos:34,settings:{},nodePositions:[[6,4],[9,4]]},104:{id:104,type:1,xpos:24,ypos:79,settings:{},nodePositions:[[0,0],[11,0]]},105:{id:105,type:1,xpos:35,ypos:76,settings:{},nodePositions:[[0,3],[0,-36]]},106:{id:106,type:1,xpos:35,ypos:36,settings:{},nodePositions:[[0,4],[8,4]]},107:{id:107,type:45,xpos:44,ypos:63,settings:{}},108:{id:108,type:45,xpos:56,ypos:64,settings:{}},109:{id:109,type:41,xpos:56,ypos:70,settings:{}},110:{id:110,type:41,xpos:56,ypos:76,settings:{}},111:{id:111,type:42,xpos:64,ypos:73,settings:{}},112:{id:112,type:1,xpos:54,ypos:60,settings:{},nodePositions:[[0,0],[0,7]]},113:{id:113,type:1,xpos:54,ypos:67,settings:{},nodePositions:[[0,0],[2,0]]},114:{id:114,type:1,xpos:54,ypos:67,settings:{},nodePositions:[[0,0],[0,4]]},115:{id:115,type:1,xpos:54,ypos:71,settings:{},nodePositions:[[0,0],[2,0]]},116:{id:116,type:1,xpos:52,ypos:65,settings:{},nodePositions:[[0,0],[4,0]]},117:{id:117,type:1,xpos:52,ypos:65,settings:{},nodePositions:[[0,0],[0,8]]},118:{id:118,type:1,xpos:52,ypos:73,settings:{},nodePositions:[[0,0],[4,0]]},119:{id:119,type:1,xpos:44,ypos:66,settings:{},nodePositions:[[0,0],[-1,0]]},120:{id:120,type:1,xpos:43,ypos:66,settings:{},nodePositions:[[0,0],[0,11]]},121:{id:121,type:1,xpos:43,ypos:77,settings:{},nodePositions:[[0,0],[13,0]]},122:{id:122,type:1,xpos:44,ypos:64,settings:{},nodePositions:[[0,0],[-2,0]]},123:{id:123,type:1,xpos:42,ypos:64,settings:{},nodePositions:[[0,0],[0,15]]},124:{id:124,type:1,xpos:42,ypos:79,settings:{},nodePositions:[[0,0],[14,0]]},125:{id:125,type:1,xpos:64,ypos:74,settings:{},nodePositions:[[0,0],[0,-2]]},126:{id:126,type:1,xpos:64,ypos:76,settings:{},nodePositions:[[0,0],[0,2]]},127:{id:127,type:1,xpos:72,ypos:75,settings:{},nodePositions:[[0,0],[0,11]]},128:{id:128,type:1,xpos:72,ypos:86,settings:{},nodePositions:[[0,0],[-18,0]]},129:{id:129,type:1,xpos:25,ypos:37,settings:{},nodePositions:[[0,0],[11,0]]},130:{id:130,type:1,xpos:36,ypos:31,settings:{},nodePositions:[[0,6],[0,33]]},131:{id:131,type:1,xpos:36,ypos:68,settings:{},nodePositions:[[0,-4],[6,-4]]},132:{id:132,type:1,xpos:25,ypos:91,settings:{},nodePositions:[[0,0],[11,0]]},133:{id:133,type:1,xpos:36,ypos:85,settings:{},nodePositions:[[0,6],[0,-19]]},134:{id:134,type:1,xpos:36,ypos:70,settings:{},nodePositions:[[0,-4],[7,-4]]},135:{id:135,type:45,xpos:44,ypos:89,settings:{}},136:{id:136,type:45,xpos:57,ypos:90,settings:{}},137:{id:137,type:41,xpos:57,ypos:96,settings:{}},138:{id:138,type:41,xpos:57,ypos:102,settings:{}},139:{id:139,type:1,xpos:44,ypos:92,settings:{},nodePositions:[[0,0],[-1,0]]},140:{id:140,type:1,xpos:44,ypos:90,settings:{},nodePositions:[[0,0],[-2,0]]},141:{id:141,type:1,xpos:52,ypos:91,settings:{},nodePositions:[[0,0],[5,0]]},142:{id:142,type:1,xpos:54,ypos:86,settings:{},nodePositions:[[0,0],[0,7]]},143:{id:143,type:1,xpos:54,ypos:93,settings:{},nodePositions:[[0,0],[3,0]]},144:{id:144,type:1,xpos:54,ypos:93,settings:{},nodePositions:[[0,0],[0,4]]},145:{id:145,type:1,xpos:54,ypos:97,settings:{},nodePositions:[[0,0],[3,0]]},146:{id:146,type:1,xpos:52,ypos:91,settings:{},nodePositions:[[0,0],[0,8]]},147:{id:147,type:1,xpos:52,ypos:99,settings:{},nodePositions:[[0,0],[5,0]]},148:{id:148,type:1,xpos:43,ypos:92,settings:{},nodePositions:[[0,0],[0,11]]},149:{id:149,type:1,xpos:43,ypos:103,settings:{},nodePositions:[[0,0],[14,0]]},150:{id:150,type:1,xpos:57,ypos:105,settings:{},nodePositions:[[0,0],[-15,0]]},151:{id:151,type:1,xpos:42,ypos:105,settings:{},nodePositions:[[0,0],[0,-15]]},152:{id:152,type:42,xpos:65,ypos:99,settings:{}},153:{id:153,type:1,xpos:65,ypos:100,settings:{},nodePositions:[[0,0],[0,-2]]},154:{id:154,type:1,xpos:65,ypos:102,settings:{},nodePositions:[[0,0],[0,2]]},155:{id:155,type:1,xpos:26,ypos:103,settings:{},nodePositions:[[0,0],[4,0]]},156:{id:156,type:1,xpos:30,ypos:103,settings:{},nodePositions:[[0,0],[0,-11]]},157:{id:157,type:1,xpos:30,ypos:101,settings:{},nodePositions:[[0,-9],[13,-9]]},158:{id:158,type:1,xpos:26,ypos:49,settings:{},nodePositions:[[0,0],[11,0]]},159:{id:159,type:1,xpos:37,ypos:40,settings:{},nodePositions:[[0,9],[0,50]]},160:{id:160,type:1,xpos:37,ypos:90,settings:{},nodePositions:[[0,0],[5,0]]},161:{id:161,type:31,xpos:82,ypos:5,settings:{}},162:{id:162,type:1,xpos:64,ypos:15,settings:{},nodePositions:[[0,0],[15,0]]},163:{id:163,type:1,xpos:79,ypos:15,settings:{},nodePositions:[[0,0],[0,-6]]},164:{id:164,type:1,xpos:79,ypos:9,settings:{},nodePositions:[[0,0],[3,0]]},165:{id:165,type:1,xpos:64,ypos:40,settings:{},nodePositions:[[0,0],[14,0]]},166:{id:166,type:1,xpos:78,ypos:40,settings:{},nodePositions:[[0,0],[0,-32]]},167:{id:167,type:1,xpos:78,ypos:8,settings:{},nodePositions:[[0,0],[4,0]]},168:{id:168,type:1,xpos:64,ypos:66,settings:{},nodePositions:[[0,0],[13,0]]},169:{id:169,type:1,xpos:77,ypos:66,settings:{},nodePositions:[[0,0],[0,-59]]},170:{id:170,type:1,xpos:77,ypos:7,settings:{},nodePositions:[[0,0],[5,0]]},171:{id:171,type:1,xpos:65,ypos:92,settings:{},nodePositions:[[0,0],[11,0]]},172:{id:172,type:1,xpos:76,ypos:92,settings:{},nodePositions:[[0,0],[0,-86]]},173:{id:173,type:1,xpos:76,ypos:34,settings:{},nodePositions:[[0,-28],[6,-28]]},174:{id:174,type:1,xpos:79,ypos:45,settings:{},nodePositions:[[-6,56],[1,56]]},175:{id:175,type:1,xpos:80,ypos:101,settings:{},nodePositions:[[0,0],[0,-81]]},176:{id:176,type:30,xpos:80,ypos:18,settings:{}},177:{id:177,type:-3,xpos:82,ypos:22,settings:{},htmlElement:{editable:!0,html:"Overflow"},size:[20,3.6]},178:{id:178,type:-3,xpos:83,ypos:11,settings:{},htmlElement:{editable:!0,html:"Output"},size:[20,3.6]},179:{id:179,type:-3,xpos:56,ypos:32,settings:{},htmlElement:{editable:!0,html:"Carry from bit 1"},size:[20,3.6]},180:{id:180,type:-3,xpos:66,ypos:12,settings:{},htmlElement:{editable:!0,html:"Output bit 1"},size:[20,3.6]},181:{id:181,type:-3,xpos:57,ypos:57,settings:{},htmlElement:{editable:!0,html:"Carry from bit 2"},size:[20,3.6]},182:{id:182,type:-3,xpos:66,ypos:37,settings:{},htmlElement:{editable:!0,html:"Output bit 2"},size:[20,3.6]},183:{id:183,type:-3,xpos:56,ypos:83,settings:{},htmlElement:{editable:!0,html:"Carry from bit 3"},size:[20,3.6]},184:{id:184,type:-3,xpos:66,ypos:63,settings:{},htmlElement:{editable:!0,html:"Output bit 3"},size:[20,3.6]},185:{id:185,type:-3,xpos:71,ypos:101,settings:{},htmlElement:{editable:!0,html:"Carry from bit 4"},size:[20,3.6]},186:{id:186,type:-3,xpos:66,ypos:89,settings:{},htmlElement:{editable:!0,html:"Output bit 4"},size:[20,3.6]},187:{id:187,type:21,xpos:49,ypos:5,settings:{}}}}}];



function A(t){var o=this;this.Bt=t,this.ue=0,this.ce=0,this.Wt="Simulation is running.",this.Ut="Simulation is paused. Click play to resume.",this.de="Simulation is currently stopped. Click play above to start.",this.Hi=10,this.fe=-1,this.jt="stopped",this.re=null,this.ye=null,this.ge=null,this.Me=0,this.xe=0,this.se={},this.ve=1,this._e={};t=$(".simFore",this.Bt._);this.lt=new P(t,!1,function(t,i,s){o.ut(t,i,s)},function(t,i,s){o.ct(t,i,s)},function(t,i,s){o.me(t,i,s)}),t.on({mouseup:function(){o.xt()},mouseout:function(){o.be()},touchend:function(t){t.preventDefault(),o.xt()},touchcancel:function(t){t.preventDefault(),o.xt()}}),o.we(),o.dt(),$(window).resize(function(){o.dt()}),$(".load_button",this.Bt._).click(function(){$(".load_file",o.Bt._).trigger("click")}),$(".load_file",o.Bt._).change(function(){o.$e()}),$(".toolbar_button_play",this.Bt._).click(function(){"stopped"===o.jt&&o.Zn(!1),o.jt="playing",$(".toolbar_button_play",o.Bt._).addClass("active"),$(".toolbar_button_pause",o.Bt._).removeClass("disabled").removeClass("active"),$(".toolbar_button_stop",o.Bt._).removeClass("active")}),$(".toolbar_button_stop",this.Bt._).click(function(){"stopped"!==o.jt&&o.te(),o.jt="stopped",$(".toolbar_button_play",o.Bt._).removeClass("active"),$(".toolbar_button_pause",o.Bt._).addClass("disabled").removeClass("active"),$(".toolbar_button_stop",o.Bt._).addClass("active")}),$(".toolbar_button_pause",this.Bt._).click(function(){"playing"===o.jt?(o.jt="paused",$(".play_status",o.Bt._).text(o.Ut),$(".toolbar_button_play",o.Bt._).removeClass("active"),$(".toolbar_button_pause",o.Bt._).addClass("active")):"paused"===o.jt&&(o.jt="playing",$(".play_status",o.Bt._).text(o.Wt),$(".toolbar_button_play",o.Bt._).addClass("active"),$(".toolbar_button_pause",o.Bt._).removeClass("active"))});var e=$(".presets_menu",this.Bt._);$.each(this.Bt.$t,function(t,i){var s=$("<li class='preset_item'>"),n=$("<a class='menu_item' style='width:100%; display: inline-block;'>");n.text(i.name),n.addClass("load_preset"),n.data("preset",t),s.append(n),e.append(s)}),$(".load_preset",this.Bt._).click(function(){o.Ht(o.Bt.$t[at($(this).data("preset"))].elements)}),$(".export_svg",this.Bt._).click(function(){var t=new ut(1,1);w(t,$(".simBack",o.Bt._),o.Hi);var e=new ut(1,1);o.Vt(e),e.Dn("Arial,Helvetica,sans-serif",14,"",""),e.Ds("#000"),$.each(o.se,function(t,i){var s=o.Hi,n=(i.xpos-o.ue)*s,s=(i.ypos-o.ce)*s;i.hasOwnProperty("htmlElement")&&(n=Math.round(n)+6,s=Math.round(s)+6+14,i=i.htmlElement.html,e.Ts(n,s,-1,-1,1,i,0,0))}),t.Xi(e),ot("simulation.svg",t._t())}),this.te(),setInterval(function(){o.yt()},this.Bt.Bs)}function F(t,i){var s=this;this.M=t,this._=i,this.Pe={change:[]},this.ke=t.steps,this.ze=t.default/this.ke,this.Ne=!1,$(window).resize(function(){s.dt()}),this.dt();i=function(){s.Ie()};$(".dcfslide",this._).slider({min:0,max:this.ke,value:t.default,change:i,slide:i})}function L(t,i,s){this.title=t,this.styling=i,this.data=s}function O(t,i){var s=this;this.M=t,this._=i,this.Be=null;var n=new XMLHttpRequest,i=window.server+"solar_spectrum/solar_spectrum.bin";n.open("GET",i,!0),n.responseType="arraybuffer",n.onload=function(){var t=n.response;t?(s.Se=new Uint8Array(t),s.Ee=1e3,s.Ce=1e4,s.Ae=.1,jQuery.getJSON(window.server+"solar_spectrum/solar_spectrum.json",function(t){s.Fe=t,s.W(),$(window).resize(function(){s.W()})})):window.console.log("error")},n.send(null)}function D(t,i){var s=this;this.M=t,this._=i,this.Hi=10,this.Le=!1,this.Oe=0,this.De=null,s.dt(),$(window).resize(function(){s.dt()}),$(".btn-animate",this._).click(function(){s.Le=!0,s.Oe=Date.now()/1e3,s.W()}),$(".btn-result",this._).click(function(){s.Le=!1,s.W()}),$("input",this._).change(function(){s.W()}),setInterval(function(){s.yt()},50),$(".btn-export",this._).click(function(){var t=new ut(1,1);w(t,$(".simBack",s._),s.Hi,s.cs/2,s.ds/2);var i=new ut(1,1);s.W(i),t.Xi(i),ot("simulation.svg",t._t())})}function T(t,i,s){this.Hn=t,this.Vn=i,this.Wn=s}function j(t,i,s,n){t*=Math.PI/180,i*=Math.PI/180;n=K(n)*Math.PI/12,s=6371e3+s;return new T(s*Math.cos(i+n)*Math.cos(t),s*Math.sin(i+n)*Math.cos(t),s*Math.sin(t))}function R(t,i,s){this.Hn=t,this.Vn=i,this.Wn=s}function J(t,i){return t*=Math.PI/12,i*=Math.PI/180,new R(Math.cos(t)*Math.cos(i),Math.sin(t)*Math.cos(i),Math.sin(i))}function U(t,i){this.mi=t,this.Te=i}function W(){this.je=[[1,0,0],[0,1,0],[0,0,1]]}function H(t,i,s){var n=new W,e=n.je;return e[1][1]=Math.cos(t)*Math.cos(i),e[1][0]=Math.sin(s)*Math.sin(t)*Math.cos(i)-Math.cos(s)*Math.sin(i),e[1][2]=Math.cos(s)*Math.sin(t)*Math.cos(i)+Math.sin(s)*Math.sin(i),e[0][1]=Math.cos(t)*Math.sin(i),e[0][0]=Math.sin(s)*Math.sin(t)*Math.sin(i)+Math.cos(s)*Math.cos(i),e[0][2]=Math.cos(s)*Math.sin(t)*Math.sin(i)-Math.sin(s)*Math.cos(i),e[2][1]=-Math.sin(t),e[2][0]=Math.sin(s)*Math.cos(t),e[2][2]=Math.cos(s)*Math.cos(t),n}function V(t){var i=new W;return i.je=[[1,0,0],[0,Math.sin(t),-Math.cos(t)],[0,Math.cos(t),Math.sin(t)]],i}function G(t,i,s,n){var i=new J(12*t/Math.PI,180*i/Math.PI);.999999999<(i=(i=i.Je(-s)).Re(Math.PI/2-n)).Wn&&(i.Wn=1),i.Wn<-.999999999&&(i.Wn=-1);n=Math.asin(i.Wn),i=Math.abs(Math.cos(n))<1e-7?0:Math.atan2(i.Vn/Math.cos(n),i.Hn/Math.cos(n));return[Math.PI/2-n,i]}function Q(t,i,s,n,e){t*=Math.PI/12,i*=Math.PI/180,s*=Math.PI/12,n*=Math.PI/180,e*=Math.PI/180;s=G(t,i,s,n),n=s[0],s=s[1];if(s-=e,n>Math.PI/2)return 0;e=Math.tan(n/2),n=e*Math.cos(s);return[e*-Math.sin(s),n]}function X(t,i,s,n,e){var o=2*Math.atan(t*t+i*i),e=Math.atan2(-t,i)+e,o=Math.PI/2-o;if(o<0)return 0;o=new R(Math.cos(o)*Math.cos(e),Math.cos(o)*Math.sin(e),Math.sin(o));return o=(o=o.Re(-Math.PI/2+n)).Je(s),[12*Math.atan2(o.Vn,o.Hn)/Math.PI,180*Math.asin(o.Wn)/Math.PI]}function K(t){var i=40587.5+t/86400,t=(i-51545)/36525;return(280.46061837+360.98564736629*(i-51545)+387933e-9*t*t+t*t*t/3871e4)%360*12/180}function Z(t,i,s){s=K(s)*Math.PI/12;return t*=Math.PI/180,i*=Math.PI/180,new R(Math.cos(i+s)*Math.cos(t),Math.sin(i+s)*Math.cos(t),Math.sin(t)).Ue()}function q(t,i,s,n){i*=Math.PI/180,n*=Math.PI/180,t*=Math.PI/12,s*=Math.PI/12;n=new R(Math.cos(s)*Math.cos(n),Math.sin(s)*Math.cos(n),Math.sin(n));return n=(n=n.Je(-t)).Re(Math.PI/2-i),180*Math.atan2(n.Vn,-n.Hn)/Math.PI}function Y(t,i,s){s=-s;var n=Math.sin(t),t=Math.PI/2-i,i=(n-Math.sin(s)*Math.cos(t))/(Math.cos(s)*Math.sin(t)),n=Math.sqrt(1-Math.pow(i,2)),t=Math.atan2(n*Math.cos(s),i*Math.cos(s)*Math.cos(t)-Math.sin(s)*Math.sin(t));return isNaN(t)?-1:43200*(1-Math.abs(t/Math.PI))}function tt(t){var i=(t-946684800)/31557600,s=i/100,n=.0002236174+1.35263017e-7*s,e=971719333e-13+4.14515697e-8*s,o=Math.PI/180,h=(t/86400+2440587.5-2451545)/36525,s=357.52911+35999.05029*h+1537e-7*h*h,t=280.46646+36000.76983*h+3032e-7*h*h+((1.914602-.004817*h-14e-6*h*h)*Math.sin(s*o)+(.019993-101e-6*h)*Math.sin(2*s*o)+289e-6*Math.sin(3*s*o)),s=23.43929111111111+46.815/3600*h,h=Math.atan2(Math.cos(s*o)*Math.sin(t*o),Math.cos(t*o)),o=Math.sin(s*o)*Math.sin(t*o);return[h+=(n+e*Math.sin(h)*Math.tan(o))*i,o+=e*Math.cos(h)*i]}function it(t){var i=t/86400+2440587.5,t=(i-2451545)/36525;return(280.46061837+360.98564736629*(i-2451545)+387933e-9*t*t+t*t*t/3871e4)*(Math.PI/180)}function st(t){return t*t}function nt(t,i,s,n){var e=Math.sin(t)*Math.cos(i),o=Math.cos(t)*Math.cos(i),t=Math.sin(i),i=Math.sin(s)*Math.cos(n),s=Math.cos(s)*Math.cos(n),n=Math.sin(n),n=Math.sqrt(st(e-i)+st(o-s)+st(t-n));return 2*Math.asin(n/2)}function et(t){return t<10?"0"+t:""+t}function ot(t,i){var s="text/plain";t.endsWith(".svg")&&(s="image/svg+xml"),t.endsWith(".csv")&&(s="text/csv");i=new Blob([i],{type:s});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveBlob(i,t):((s=window.document.createElement("a")).href=window.URL.createObjectURL(i),s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s))}function ht(){var t=window.navigator.userAgent,i=t.indexOf("MSIE ");if(0<i)return parseInt(t.substring(i+5,t.indexOf(".",i)),10);if(0<t.indexOf("Trident/")){var s=t.indexOf("rv:");return parseInt(t.substring(s+3,t.indexOf(".",s)),10)}s=t.indexOf("Edge/");return 0<s&&parseInt(t.substring(s+5,t.indexOf(".",s)),10)}function at(t){return~~t}function u(t,i){i=i.offset();return[t.pageX-i.left,t.pageY-i.top]}function rt(t){function i(t){return parseInt(t,16)}return 4===t.length?new Mt(i(t[1]+t[1])/255,i(t[2]+t[1])/255,i(t[3]+t[3])/255,1):new Mt(i(t.slice(1,3))/255,i(t.slice(3,5))/255,i(t.slice(5))/255,1)}function lt(t,i,s){this.We=t,this.He=new pt,this.dt(i,s)}function pt(){this.D()}function ut(t,i){this.We=document.createElement("canvas"),this.He=new pt,this.dt(t,i)}function ct(t){this.page=null,this.itemType="arrow",this.z_index=0,this.arrowType="single",this.color=new Mt(0,0,0,1),this.strokeLineWidth=1,this.origin=[0,0],this.target=[0,0],this.configure(t),this.cleanWorkspace()}function dt(t,i,s,n){this.graph=t,this.axis_name=i,this.atZero=!1,this.enabled=s,this.visible=!0,this.linkTo=null,this.rangeReversed=!1,this.arrowType="none",this.logarithmic=!1,this.min=null,this.max=null,this.data_type="numeric",this.scrollEnabled=!1,this.scrollMin=null,this.scrollMax=null,this.scrollSpan=null,this.zoomEnabled=!1,this.mirror=!1,this.tickLabelRotation=0,this.labelRotate=0,this.ticking_allocator=null,this.label=null,this.showLabels=!0,this.ticksMinor=new ft({}),this.ticks=new ft({}),this.configure(n),this.cleanWorkspace()}function ft(t){this.ticDir=null,this.tickMin=null,this.tickMax=null,this.tickStep=null,this.tickList=null,this.configure(t)}function yt(t,i){var s=this;this.itemList=t,this.settings={},this.settings.allow_export_png=!0,this.settings.allow_export_svg=!0,this.settings.allow_export_csv=!1,this.constants={},this.constants.DEFAULT_LINEWIDTH=.566929,this.constants.DEFAULT_PS=3,this.constants.ARROW_ANGLE=45*Math.PI/180,this.constants.ARROW_CONSTRICT=.2,this.constants.ARROW_HEADSIZE=6,this.constants.AXES_LINEWIDTH=2.5,this.constants.AXES_MAJTICKLEN=8,this.constants.AXES_MINTICKLEN=4,this.constants.AXES_SEPARATION=.008,this.constants.AXES_TEXTGAP=6,this.constants.AXES_LABELGAP=34,this.constants.COLORSCALE_MARG=.003,this.constants.COLORSCALE_WIDTH=.004,this.constants.GRID_MAJLINEWIDTH=.8,this.constants.GRID_MINLINEWIDTH=.5,this.constants.LEGEND_fontFamily="Arial,Helvetica,sans-serif",this.constants.LEGEND_fontSize=14,this.constants.LEGEND_fontWeight="",this.constants.LEGEND_fontStyle="",this.constants.LEGEND_color=new Mt(0,0,0,1),this.constants.LEGEND_margin=30,this.constants.LEGEND_horizontal_spacing=48,this.constants.LEGEND_vertical_spacing=9,this.constants.LEGEND_MAX_HGAP=25,this.constants.LEGEND_MAX_VGAP=25,this.configure(i),this.styling=new Bt(this),this.page_width=1024,this.html_initialised=!1,this.workspace={},this.workspace.errorLog="",this.interactive_holder_element=null,this.interactive_canvas_element=null,this.is_pinching=!1,this.pinch_distance=0,this.mousedown=!1,this.pos_start=[0,0],this.pos_latest=[0,0],this.needs_refresh=!1,this.canvas=null,this.threeDimensionalBuffer=null,setInterval(function(){s.needs_refresh&&null!==s.interactive_holder_element&&(s.renderToCanvas(s.interactive_holder_element),s.needs_refresh=!1)},100)}function gt(t){this.page=null,this.itemType="circle",this.z_index=0,this.strokeColor=new Mt(0,0,0,1),this.fillColor=new Mt(.6,.6,.6,1),this.strokeLineWidth=1,this.origin=[0,0],this.radius=50,this.configure(t),this.cleanWorkspace()}function Mt(t,i,s,n){this.red=t,this.green=i,this.blue=s,this.alpha=n}function xt(t,i,s,n){var e=this;this.title=t,this.style=new zt({}),this.axes={1:"x1",2:"y1",3:"z1"},this.data=s,this.update_callback=n,this.grid=!1,this.grid_dimensions=null,$.each(i,function(t,i){var s;"axis1"===t?e.axes[1]=i:"axis2"===t?e.axes[2]=i:"axis3"===t?e.axes[3]=i:((s={})[t]=i,e.style.configure(s))}),this.cleanWorkspace()}function vt(){}function _t(t){this.page=null,this.itemType="ellipse",this.z_index=0,this.strokeColor=new Mt(0,0,0,1),this.fillColor=new Mt(.6,.6,.6,1),this.strokeLineWidth=1,this.origin=[0,0],this.minor_axis=50,this.major_axis=100,this.position_angle=30,this.configure(t),this.cleanWorkspace()}function mt(t,i,s){this.title=t,this.styling=i,this.functions=s}function bt(t,i){this.page=null,this.itemType="graph",this.z_index=0,this.aspect=null,this.aspectZ=1,this.axesColor=new Mt(0,0,0,1),this.gridMajorColor=new Mt(.8,.8,.8,1),this.gridMinorColor=new Mt(.8,.8,.8,1),this.textColor=new Mt(0,0,0,1),this.clip=!0,this.key=!1,this.keyColumns=null,this.keyPosition="tr",this.bar=1,this.fontSize=1,this.gridAxes=["x1","y1","z1"],this.boxFrom=null,this.boxWidth=null,this.keyOffset=[0,0],this.origin=[0,0],this.titleVerticalOffset=60,this.titleOffset=[0,0],this.width=null,this.widthIncludesAxes=!0,this.viewAngleXY=60,this.viewAngleYZ=30,this.title=null,this.threeDimensional=!1,this.interactiveMode="none",this.axes={x1:new dt(this,"x1",!0,{}),x2:new dt(this,"x2",!1,{}),y1:new dt(this,"y1",!0,{}),y2:new dt(this,"y2",!1,{}),z1:new dt(this,"z1",!0,{}),z2:new dt(this,"z2",!1,{})},this.dataSets=t,this.annotations=[],this.configure(i),this.cleanWorkspace()}function wt(t,i,s,n,e,o,h,a){this.page=t,this.graph=i,this.color=o,this.line_type=h,this.line_width=a,this.axis_x=s,this.axis_y=n,this.axis_z=e,this.pt_old=null,this.line_list=[],this.point_list_in_progress=[]}function $t(t){this.itemType="text",this.z_index=0,this.text="Hello world",this.color=new Mt(0,0,0,1),this.fontSize=13,this.fontFamily="Arial,Helvetica,sans-serif",this.fontWeight="",this.fontStyle="",this.position=[0,0],this.axis_x=null,this.axis_y=null,this.axis_z=null,this.h_align="center",this.v_align="center",this.configure(t)}function Pt(t){this.itemType="arrow",this.z_index=0,this.arrowType="single",this.color=new Mt(0,0,0,1),this.strokeLineWidth=1,this.origin=[0,0],this.target=[0,0],this.axis_x=null,this.axis_y=null,this.axis_z=null,this.configure(t)}function kt(t,i){this.page=t,this.graph=i,this.legend_items=[],this.bounding_box=null,this.x_offset=null,this.y_offset=null,this.column_arrangement=null}function zt(t){this.color=null,this.fillColor=new Mt(0,0,0,0),this.plotStyle="lines",this.lineType=null,this.pointType=null,this.lineWidth=2,this.pointLineWidth=1,this.pointSize=1,this.configure(t)}function Nt(t,i){this.page=t,this.graph=i}function It(t){this.page=null,this.itemType="rectangle",this.z_index=0,this.strokeColor=new Mt(0,0,0,1),this.fillColor=new Mt(.6,.6,.6,1),this.strokeLineWidth=1,this.origin=[0,0],this.width=50,this.height=50,this.configure(t),this.cleanWorkspace()}function Bt(t){this.page=t,this.defaultColors=this.getDefaultColors(),this.pointTypes=this.getPointTypes()}function St(t){this.page=null,this.itemType="text",this.z_index=0,this.text="Hello world",this.color=new Mt(0,0,0,1),this.fontSize=13,this.fontFamily="Arial,Helvetica,sans-serif",this.fontWeight="",this.fontStyle="",this.origin=[0,0],this.h_align="center",this.v_align="center",this.configure(t),this.cleanWorkspace()}function Et(){this.reset()}function Ct(t){this.axis=t,this.max_allowed_ticks=256}function At(t){this.axis=t}function Ft(t){this.axis=t,this.max_allowed_ticks=256,this.acceptable_intervals=[1,2,5,10,20,30,60,120,300,600,900,1800,3600,7200,10800,14400,21600,43200,86400,172800,259200,345600,604800]}function Lt(t,i,s){this.Hn=t,this.Vn=i,this.Wn=s}function Ot(t,i,s){this.Hn=t,this.Vn=i,this.Wn=s}function Dt(t,i){return new Ot(Math.cos(i)*Math.cos(t),Math.sin(i)*Math.cos(t),Math.sin(t))}function Tt(t,i){this.mi=t,this.Te=i}function jt(){this.je=[[1,0,0],[0,1,0],[0,0,1]]}function Rt(t,i,s){var n=new jt,e=n.je;return e[1][1]=Math.cos(t)*Math.cos(i),e[1][0]=Math.sin(s)*Math.sin(t)*Math.cos(i)-Math.cos(s)*Math.sin(i),e[1][2]=Math.cos(s)*Math.sin(t)*Math.cos(i)+Math.sin(s)*Math.sin(i),e[0][1]=Math.cos(t)*Math.sin(i),e[0][0]=Math.sin(s)*Math.sin(t)*Math.sin(i)+Math.cos(s)*Math.cos(i),e[0][2]=Math.cos(s)*Math.sin(t)*Math.sin(i)-Math.sin(s)*Math.cos(i),e[2][1]=-Math.sin(t),e[2][0]=Math.sin(s)*Math.cos(t),e[2][2]=Math.cos(s)*Math.cos(t),n}A.prototype.Ve=function(){var t,i="None";this.re&&this.se.hasOwnProperty(this.re)&&(i=0<=(t=this.se[this.re].type)?c(this.Ls[t].name):"Text label"),$(".selected_element_name",this.Bt._).text(i),$(".element_controls",this.Bt._).empty(),this._e.hasOwnProperty(this.re)&&$(".element_controls",this.Bt._).append(this._e[this.re]())},A.prototype.ct=function(t,i,s){var n=this,e={},o=null,h=this.Ge();if(h)alert(h);else{h=!1;if(0<=this.fe&&(a=this.fe,h=(e=this.Ls[a]).hasOwnProperty("stringLike")&&e.stringLike),0<t&&!h){if(-2===this.fe)return delete this.se[t],$(".element_"+t,this.Bt._).remove(),this.re=null,this.Ve(),this.ye=null,this.ge=null,void this.we();$(".toolbar_button_-1",this.Bt._).click(),this.re=t,this.Ve(),this.ye=t;var a,r=this.se[t],e=0<=(a=r.type)?this.Ls[a]:{};return this.Me=i-(r.xpos-this.ue)*this.Hi,this.xe=s-(r.ypos-this.ce)*this.Hi,this.ge=null,void(e.hasOwnProperty("stringLike")&&e.stringLike&&$.each(r.nodePositions,function(t,i){i[0]===Math.round(n.Me/n.Hi)&&i[1]===Math.round(n.xe/n.Hi)&&(n.ge=t)}))}if(0<=this.fe||-3===this.fe){if(e={},0<=(a=this.fe))e=this.Ls[a];else if(null===(o=prompt("Texte de l'étiquette :",""))||0===o.length)return;r=Math.round(i/this.Hi)+this.ue,i=Math.round(s/this.Hi)+this.ce;s=[];e.hasOwnProperty("stringLike")&&e.stringLike&&(s=[[0,0],[0,0]],this.ye=this.ve,this.ge=1);var l={};e.hasOwnProperty("settings")&&null!==e.settings&&$.each(e.settings,function(t,i){l[i.name]=i.default});i={id:this.ve,type:a,xpos:r,ypos:i,settings:l};0<s.length&&(i.nodePositions=s),-3===a&&(i.htmlElement={editable:!0,html:$("<div>").text(o).html()}),this.ne(i),this.se[this.ve]=i,this.re=this.ve,this.Ve(),this.ve+=1,this.we()}}},A.prototype.ne=function(a){var t,r=this,i=a.type,s=0<=i?this.Ls[i]:{},n="element_"+a.id;$("."+n,this.Bt._).remove(),a.hasOwnProperty("htmlElement")&&null!==a.htmlElement&&(t=$("<div></div>"),i=a.htmlElement.html,t.addClass(n).css("position","absolute").html(i),$(".html_elements").append(t),a.size=[t.outerWidth()/this.Hi,t.outerHeight()/this.Hi],a.htmlElement.editable&&(i=" <a class='clickable' href='javascript:;'></a>",(t=$("<div></div>")).addClass(n).css("position","absolute").html(i),$(".html_below").append(t))),s.hasOwnProperty("htmlBelow")&&null!==s.htmlBelow&&((t=$("<div></div>")).addClass(n).css("position","absolute").html(s.htmlBelow),$(".html_below").append(t)),this._e[a.id]=function(){var h=$("<div>");return h.addClass(n),s.hasOwnProperty("settings")&&null!==s.settings&&$.each(s.settings,function(t,i){var s=$('<p class="heading">'+i.heading+"</p>"),n=$('<div style="margin: 8px 0;">'),e=$("<div>");e.text(i.render_value(a.settings[i.name]));function o(){var t=n.slider("value")/100*(i.max-i.min)+i.min;a.settings[i.name]=t,null!==r.Bt.Es&&r.Bt.Es.hasOwnProperty(a.id)&&(r.Bt.Es[a.id].settings[i.name]=t),e.text(i.render_value(a.settings[i.name])),r.Vt()}n.slider({min:0,max:100,value:(a.settings[i.name]-i.min)/(i.max-i.min)*100,change:o,slide:o}),h.append(s),h.append(n),h.append(e)}),h},$("."+n+" .clickable",r.Bt._).click(function(){r.Bt.ie(a.id)})},A.prototype.xt=function(){var t,i;0<this.ye&&((i=0<=(i=(t=this.se[this.ye]).type)?this.Ls[i]:{}).hasOwnProperty("stringLike")&&i.stringLike&&t.nodePositions[0][0]===t.nodePositions[1][0]&&t.nodePositions[0][1]===t.nodePositions[1][1]&&(delete this.se[this.ye],$(".element_"+this.ye,this.Bt._).remove()),this.ye=null,this.ge=null,this.we())},A.prototype.be=function(){this.xt()},A.prototype.ut=function(t,i,s){0<this.ye&&(0===t&&0===i&&0===s||(t=this.se[this.ye],null===this.ge?(t.xpos=Math.round((i-this.Me)/this.Hi)+this.ue,t.ypos=Math.round((s-this.xe)/this.Hi)+this.ce):(i=Math.round(i/this.Hi)+this.ue-t.xpos,s=Math.round(s/this.Hi)+this.ce-t.ypos,t.nodePositions[this.ge]=[i,s]),this.we()))},A.prototype.me=function(t,i,s){},A.prototype.dt=function(){var l=this,t=$(".simulation_canvas",this.Bt._);this.cs=t.width(),this.ds=Math.min(.7*$(window).height(),$(window).height()-240),this.ds=Math.max(this.ds,400),$(".simulation_holder",this.Bt._).width(this.cs).height(this.ds),$(".simulation_canvas, .info_pane",this.Bt._).css("height",at(this.ds)+"px");var i=Math.ceil((this.cs-30)/this.Hi),t=Math.ceil((this.ds-30)/this.Hi),p=5,u=0,c=5,d=0,f=!0;$.each(this.se,function(t,i){var s,n,e,o,h,a=i.type,r=0<=a?l.Ls[a]:{},a=(i.hasOwnProperty("size")?i:r).size,a=r.hasOwnProperty("stringLike")&&r.stringLike?(o=[],h=[],$.each(i.nodePositions,function(t,i){o.push(i[0]),h.push(i[1])}),s=g(o)+i.xpos,e=M(o)+i.xpos,n=g(h)+i.ypos,M(h)+i.ypos):(s=i.xpos,n=i.ypos,e=i.xpos+a[0],i.ypos+a[1]);d=f?(p=s,u=e,c=n,a):(p=Math.min(p,s),u=Math.max(u,e),c=Math.min(c,n),Math.max(d,a)),f=!1}),p-=5,c-=5,d+=5,(u+=5)<i&&(p=Math.min(0,p)),d<t&&(c=Math.min(0,c)),u=Math.max(u,p+i),d=Math.max(d,c+t),this.ue=Math.floor(p),this.ce=Math.floor(c),this.Qe=Math.ceil(u-p)*this.Hi,this.Xe=Math.ceil(d-c)*this.Hi,$(".simulation_holder2, .sim",this.Bt._).width(this.Qe).height(this.Xe),w(null,$(".simBack",this.Bt._),this.Hi),this.Ke(),this.Vt()},A.prototype.Ke=function(){var a=this,t=$(".toolbar",this.Bt._);this.Ls=this.Bt.Ls;var s=[];$.each(this.Ls,function(t,i){s.push(et(t))}),s.sort();t.empty();

var n="<div class='toolbar_button toolbar_button_-2' style='text-align:center; box-sizing:content-box; width:66px; height:66px;' data-item='-2'><br><br><div class='toolbar_button_label'>Effacer</div></div><div class='toolbar_button toolbar_button_-1' style='text-align:center; box-sizing:content-box; width:66px; height:66px;' data-item='-1'><br><br><div class='toolbar_button_label'>Déplacer</div></div><div class='toolbar_button toolbar_button_-3' style='text-align:center; box-sizing:content-box; width:66px; height:66px;' data-item='-3'><br><br><div class='toolbar_button_label'>Etiquette</div></div>";

$.each(s,function(t,i){i=at(i),n+="<div class='toolbar_button toolbar_button_"+i+"' data-item='"+i+"'><canvas></canvas></div>"}),t.html(n),




$.each(s,function(t,i){i=at(i);var s=new lt($(".toolbar_button_"+i+" canvas",a.Bt._)[0],66,66),n=a.Ls[i],e=n.size[1]<8?4:3,o=(66-e*n.size[0])/2,h=(39.6-e*n.size[1])/2;a.Ze(s,1,i,o,h,e,null),s.Ds("#000"),s.Dn("Arial,Helvetica,sans-serif",14,"",""),s.Ts(33,66*.7,0,0,1,n.shortName[0],0,0),s.Ts(33,66*.92,0,0,1,n.shortName[1],0,0)}),$(".toolbar .toolbar_button",a.Bt._).each(function(){var t,i=$(this).data("item");void 0!==i&&(t=at(i),$(this).click(function(){a.qe(t)}))}),this.qe(this.fe)},A.prototype.qe=function(t){var i=$(".toolbar .toolbar_button_"+t,this.Bt._).data("help");$(".help_text",this.Bt._).text(i),$(".toolbar .toolbar_button",this.Bt._).removeClass("active"),$(".toolbar .toolbar_button_"+t,this.Bt._).addClass("active"),this.fe=t,this.Vt()},A.prototype.Ye=function(t,i,s,n){return[i+t[0]*n,s+t[1]*n]},A.prototype.Ze=function(o,h,t,a,r,l,p){var u,c,d,i,f=this,s=this.Ls[t];if(s.stringLike&&p)for(o.Ai("#000",h),i=p.nodePositions,u=0;u<i.length-1;u++){var n,e,y,g=f.Ye(i[u],a,r,l),M=f.Ye(i[u+1],a,r,l);p&&p.hasOwnProperty("nodeColors")&&(n=f.Rs([1],[p.nodeColors[u]],!0),e=f.Rs([1],[p.nodeColors[u+1]],!0),o instanceof lt?((y=o.io.createLinearGradient(g[0],g[1],M[0],M[1])).addColorStop(0,n),y.addColorStop(1,e),o.io.strokeStyle=y):o.Ai(n,h)),o.Fi(),o.Li(g[0],g[1]),o.Oi(M[0],M[1]),o.Di()}else{var x=s.drawInstructions;p&&p.hasOwnProperty("variantState")&&null!==p.variantState&&(x=s.drawInstructions_variants[p.variantState]),$.each(x,function(t,i){if(o.Ai("#000",h),o.Ds("#000"),o.Dn("Arial,Helvetica,sans-serif",1<h?14:8,"bold",""),"line_open"===i[0]||"line_closed"===i[0]||"line_filled"===i[0]){for(o.Fi(),g=f.Ye(i[1][0],a,r,l),o.Li(g[0],g[1]),u=1;u<i[1].length;u++)g=f.Ye(i[1][u],a,r,l),o.Oi(g[0],g[1]);"line_closed"===i[0]&&o.On(),"line_filled"===i[0]&&(o.Ds("rgba(0,0,0,0.8)"),o.On(),o.Us()),o.Di()}else{var s,n,e;"arrow"===i[0]?(o.Fi(),g=f.Ye(i[1],a,r,l),o.Li(g[0],g[1]),M=f.Ye(i[2],a,r,l),o.Oi(M[0],M[1]),o.Di(),o.an(M[0],M[1],Math.atan2(M[1]-g[1],M[0]-g[0])),n=.75*h,o.Li(4*n,0),o.Oi(-4*n,3*n),o.Oi(-2.5*n,0),o.Oi(-4*n,-3*n),o.On(),o.Us(),o.rn()):"circle"===i[0]||"circle_filled"===i[0]||"arc"===i[0]?(o.Fi(),g=f.Ye(i[1],a,r,l),c=0,d=2*Math.PI,"arc"===i[0]&&(c=i[3],d=i[4]*Math.PI/180),o.Js(g[0],g[1],i[2]*l,c,d,!1),o.Di(),"circle_filled"===i[0]&&(3<i.length&&o.Ds(i[3]),o.Us())):"bezier"===i[0]?(o.Fi(),g=f.Ye(i[1],a,r,l),o.Li(g[0],g[1]),M=f.Ye(i[2],a,r,l),c=f.Ye(i[3],a,r,l),d=f.Ye(i[4],a,r,l),o.so(c[0],c[1],d[0],d[1],M[0],M[1]),o.Di()):"text"===i[0]?(3<i.length&&o.Ds(i[3]),g=f.Ye(i[1],a,r,l),o.Ts(g[0],g[1],0,0,1,i[2],0,0)):"text_custom"===i[0]?(e=i[1],p&&p.hasOwnProperty(e)&&(o.Dn("monospace",i[3],"bold",""),o.Ds(i[4]),g=f.Ye(i[2],a,r,l),o.Ts(g[0],g[1],0,0,1,p[e],0,0))):"line_colored"===i[0]&&(g=f.Ye(i[1],a,r,l),M=f.Ye(i[2],a,r,l),p&&p.hasOwnProperty("nodeColors")&&(s=f.Rs(i[3],p.nodeColors,!0),n=f.Rs(i[4],p.nodeColors,!0),o instanceof lt?((e=o.io.createLinearGradient(g[0],g[1],M[0],M[1])).addColorStop(0,s),e.addColorStop(1,n),o.io.strokeStyle=e):o.Ai(s,h)),o.Fi(),o.Li(g[0],g[1]),o.Oi(M[0],M[1]),o.Di())}})}s.hasOwnProperty("hook_customDraw")&&s.hook_customDraw&&p&&s.hook_customDraw(o,h,t,a,r,l,p),i=s.nodePositions,s.stringLike&&p&&(i=p.nodePositions),$.each(i,function(t,i){i=f.Ye(i,a,r,l);o.Ai("#000",h),o.Ds("#fff"),p&&p.hasOwnProperty("nodeColors")&&o.Ai(f.Rs([1],[p.nodeColors[t]],!0),h),o.Fi(),o.Js(i[0],i[1],.4*l,0,2*Math.PI,!1),o.Us(),o.Di()})},A.prototype.Rs=function(t,i,s){for(var n=0,e=0,o=0,h=0,a=Math.min(t.length,i.length),r=0;r<a;r++)n+=t[r],e+=i[r][0]*t[r],o+=i[r][1]*t[r],h+=i[r][2]*t[r];return n<=0&&(e=o=h=0,n=1),s?f(at(e/n),at(o/n),at(h/n)):[e/n,o/n,h/n]},A.prototype.Vt=function(t){var i,l,p=this,s=$(".simBuf",this.Bt._),u=t;(u=u||new lt(s[0],1,1)).dt(s.width(),s.height());var c=this.Hi;this.lt.reset();var n=this.se;if("playing"===this.jt&&null!==this.Bt.Es&&(n=this.Bt.Es),this.re&&n.hasOwnProperty(this.re)){var e=n[this.re],o=e.type,h=0<=o?this.Ls[o]:{};if(u.Fi(),u.Ai("rgba(0,255,0,0.5)",1),u.Ds("rgba(0,255,0,0.1)"),h.hasOwnProperty("stringLike")&&h.stringLike)for(i=0;i<e.nodePositions.length-1;i++){var a=e.nodePositions[i],r=e.nodePositions[i+1],d=y(r[0]-a[0],r[1]-a[1]),f=0;0<d&&(f=Math.atan2(r[1]-a[1],r[0]-a[0])),u.an((a[0]+e.xpos-p.ue)*c,(a[1]+e.ypos-p.ce)*c,f),u.hn(-1*c,-1*c,(d+2)*c,2*c),u.Di(),u.Us(),u.rn()}else{var t=e.xpos-1-p.ue,s=e.ypos-1-p.ce,o=(e.hasOwnProperty("size")?e:h).size,h=o[0]+2,o=o[1]+2;u.hn(t*c,s*c,h*c,o*c),u.Di(),u.Us()}}$.each(n,function(s,t){var i,n,e=t.type,o=(t.xpos-p.ue)*c,h=(t.ypos-p.ce)*c,a=0<=e?p.Ls[e]:{};t.hasOwnProperty("htmlElement")?(i=Math.round(o),n=Math.round(h),(l=$(".html_elements .element_"+t.id,p.Bt._)).css("left",i+"px").css("top",n+"px"),(l=$(".html_below .element_"+t.id,p.Bt._)).css("left",i-8+"px").css("top",n-8+"px")):p.Ze(u,2,e,o,h,c,t);var r=[];a.hasOwnProperty("nodePositions")&&(r=a.nodePositions),t.hasOwnProperty("nodePositions")&&(r=t.nodePositions),a.hasOwnProperty("stringLike")&&a.stringLike?p.lt.hoverLine(s,o+r[0][0]*c,h+r[0][1]*c,o+r[1][0]*c,h+r[1][1]*c):(e=(t.hasOwnProperty("size")?t:a).size,p.lt.hoverBox(s,o-+c,h-+c,(e[0]+2)*c,(e[1]+2)*c)),-1===p.fe?$.each(r,function(t,i){p.lt.hoverBox(s,o+(i[0]-.7)*c,h+(i[1]-.7)*c,c,c)}):$.each(r,function(t,i){p.lt.hoverBox(0,o+(i[0]-.7)*c,h+(i[1]-.7)*c,1.4*c,1.4*c)}),a.hasOwnProperty("htmlBelow")&&(i=Math.round(o+a.size[0]*c*.5),n=Math.round(h+a.size[1]*c),(l=$(".html_below .element_"+t.id,p.Bt._)).css("left",i-l.width()/2+"px").css("top",n+20+"px"))})},A.prototype.ae=function(n,e){var o=this;void 0===e&&(e=1),$.each(this.Bt.Es,function(t,i){var s;Math.random()>e||((s=i.type)<0||(s=o.Bt.Ls[s]["hook_"+n])&&s(i,o.Bt.As))})},A.prototype.qn=function(){this.Bt.As=$.extend(!0,{},this.Bt.Cs)},A.prototype.Zn=function(t){var i,h=this;$(".play_status",this.Bt._).text(this.Wt),t||(this.Bt.Es={}),$.each(this.se,function(t,i){h.Bt.Es.hasOwnProperty(t)||(h.Bt.Es[t]={}),h.Bt.Es[t]=$.extend(!0,h.Bt.Es[t],i)}),t&&(i=[],$.each(h.Bt.Es,function(t){i.push(t)}),$.each(i,function(t,i){h.se.hasOwnProperty(i)||delete h.Bt.Es[i]})),this.Bt.Cs={},$.each(this.Bt.Es,function(t,i){var s,n,e=i.type,o=[];0<=e&&((e=0<=e?h.Ls[e]:{}).stringLike||(i.nodePositions=e.nodePositions),s=i.xpos,n=i.ypos,$.each(i.nodePositions,function(t,i){i=p(s+i[0],6)+"_"+p(n+i[1],6);o.push(i),h.Bt.Cs[i]=[]})),i.nodeNames=o}),this.qn(),$.each(this.Bt.Es,function(t,i){var s;i.hasOwnProperty("amInitialised")||(0<=(s=i.type)&&((s=h.Bt.Ls[s].hook_initialise)&&s(i,h.Bt.As)),i.amInitialised=!0)}),this.Bt.Zn(t),t||this.Bt.Yn()},A.prototype.te=function(){$(".play_status",this.Bt._).text(this.de),this.Bt.te(),this.Bt.Es=null,this.Bt.Cs=null,this.Bt.As=null,this.Vt()},A.prototype.Ge=function(){return 0},A.prototype.we=function(){var t={id:this.Bt.Fs,elements:this.se},i=JSON.stringify(t),t=new Blob([i],{type:"application/json"}),i=URL.createObjectURL(t),t=$(".save_link",this.Bt._)[0];t.download="schema.json",t.href=i,null===this.ye?this.dt():this.Vt(),"playing"!==this.jt&&"paused"!==this.jt||this.Zn(!0)},A.prototype.$e=function(){var i,s=this,t=$(".load_file",s.Bt._)[0];t.files&&t.files[0]?((i=new FileReader).onload=function(){var t;try{t=JSON.parse(i.result)}catch(t){return void alert("Format incorrect. Le fichier ne peut être chargé.")}"object"==typeof t&&t.hasOwnProperty("id")&&t.hasOwnProperty("elements")&&"object"==typeof t.elements&&t.id===s.Bt.Fs?s.Ht(t):alert("Format incorrect. Le fichier ne peut être chargé.")},i.readAsText($(".load_file",s.Bt._)[0].files[0])):alert("Impossible d'ouvrir le fichier.")},A.prototype.Ht=function(t){var s=this;$(".toolbar_button_stop",this.Bt._).click();var n={},e=1;$.each(t.elements,function(t,i){"object"==typeof i&&i.hasOwnProperty("type")&&i.hasOwnProperty("xpos")&&i.hasOwnProperty("ypos")?(i.id=e,n[e]=i,e+=1):alert("Format incorrect. Le fichier ne peut être chargé.")}),s.se=n,s.ve=e,$(".html_elements, .html_below").empty(),$.each(n,function(t,i){s.ne(i)}),s.we()},A.prototype.yt=function(){"playing"===this.jt&&(this.Bt.Yn(),this.Vt())},F.prototype.tn=function(t,i){this.Pe[t].push(i)},F.prototype.Ie=function(){var s=this,n=$(".dcfslide",s._).slider("value");this.ze=n/this.ke,s.Ne||$.each(s.Pe.change,function(t,i){i(n/s.ke)})},F.prototype.Zt=function(t){this.Ne=!0,$(".dcfslide",this._).slider({value:t*this.ke}),this.Ne=!1},F.prototype.no=function(){return this.ze},F.prototype.dt=function(){var t,i;this.cs=this._.width(),$(".dcfslide",this._).width(this.cs-16);var s=this.M.scale_labels,n=$(".dcfcanvas",this._),e=n[0];e.width=this.cs,e.height=n.height();var o=e.getContext("2d");for(o.beginPath(),t=0;t<s.length;t++)i=12+s[t][0]*(e.width-24)/this.ke,o.moveTo(i,19),o.lineTo(i,25);for(o.strokeStyle="#777",o.lineWidth=1.9,o.stroke(),o.fillStyle="#777",o.font="bold 11px Arial,Helvetica,sans-serif",o.textBaseline="middle",o.textAlign="center",t=0;t<s.length;t++)i=12+s[t][0]*(e.width-24)/this.ke,o.fillText(s[t][1],i,12)},$(function(){$(".slider_labelled").each(function(t,i){var s=$(i),i=new F(s.data("meta"),s);s.data("handler",i)})}),L.prototype.evaluate_linear_raster=function(t,i,g){function h(t,i){for(var s=[],n=(i-t)/(g-1)*5,n=Math.max(n,1.001*M.data.step),e=0;e<g;e++){var o=t+(i-t)/(g-1)*e,h=Math.floor((o-n/2-M.data.min)/M.data.step),h=Math.max(0,h);h=Math.min(M.data.length-2,h);var a=Math.ceil((o+n/2-M.data.min)/M.data.step),a=Math.max(h+1,a);a=Math.min(M.data.length-1,a);for(var r=0,l=1e-8,p=h;p<=a;p++)r+=M.data.data[p]/255,l+=1;s.push([o,r/l])}return s}var M=this;return new xt(this.title,this.styling,h(t,i),function(p,u,c){p.data=h(u,c);for(var t=M.data.SolarSpectrumDemo,i=new r,s=0;s<g;s++){var n=i.un(p.data[s][0]),e=i.cn(n,1,!0),o=2*(o=p.data[s][1])-1,n=1/(Math.max(e[0],e[1],e[2])+1e-6);5<n&&(n=5),o*=n,t.eo[s].fillColor.red=e[0]*o,t.eo[s].fillColor.green=e[1]*o,t.eo[s].fillColor.blue=e[2]*o}var d=t.Be.itemList.graph_1,f=[],y=[];$.each(t.Fe,function(t,i){var s=.1*i[1];if(!(50<y.length||s<=u||c<=s)){for(var n=(s-u)/(c-u)*d.width,e=0;e<y.length;e++)if(Math.abs(n-y[e])<40)return;y.push(n);var o,h=(s-u)/(c-u)*p.data.length,a=Math.max(Math.floor(h-5),0),r=Math.min(Math.ceil(5+h),p.data.length-1),l=1;for(e=a;e<=r;e++)l=Math.min(p.data[e][1],l);a=.35<l?(o=l-.05,-.1):(o=.7,.1),f.push(new $t({position:[s,o+1.6*a],text:i[0],fontWeight:"bold",fontSize:14,axis_x:d.axes.x1,axis_y:d.axes.y1,axis_z:d.axes.z1})),f.push(new Pt({origin:[s,o+a],target:[s,o],strokeLineWidth:2,axis_x:d.axes.x1,axis_y:d.axes.y1,axis_z:d.axes.z1})),2<i.length&&f.push(new $t({position:[s,o+2.2*a],text:i[2],fontWeight:"bold",fontSize:16,color:new Mt(.576,.137,.525,1),axis_x:d.axes.x1,axis_y:d.axes.y1,axis_z:d.axes.z1}))}}),d.annotations=f})},O.prototype.W=function(){var t=$(this._).width(),i=t-100,s=.3*i,n=Math.floor(t/1.4),e=this.Ee,t=this.Ce;null!==this.Be&&(e=this.Be.itemList.graph_1.axes.x1.min,t=this.Be.itemList.graph_1.axes.x1.max),this.Be=new yt({graph_1:new bt([new L("Solar spectrum",{},{min:this.Ee,max:this.Ce,step:this.Ae,length:this.Se.length,data:this.Se,SolarSpectrumDemo:this}).evaluate_linear_raster(e,t,n,!0)],{width:i,aspect:.3,interactiveMode:"pan",x1_axis:{label:"Wavelength (Å)",min:e,max:t,scrollMin:this.Ee,scrollMax:this.Ce,scrollEnabled:!0,zoomEnabled:!0},y1_axis:{label:"Continuum-normalised flux",min:0,max:1.1}})},{}),this.eo=[];for(var o=i/n,h=0;h<n;h++){var a=new It({origin:[o*h,-s-4],width:1+o,height:-50,strokeColor:null,fillColor:new Mt(0,1,0,1)});this.Be.itemList["bar"+h]=a,this.eo.push(a)}this.Be.itemList.graph_1.dataSets[0].axisRangeUpdated(e,t),this.Be.renderToCanvas($(".solar_spectrum_graph")[0])},$(function(){$(".solar_spectrum_demo").each(function(t,i){var s=$(i),i=new O(s.data("meta"),s);s.data("handler",i)})}),D.prototype.yt=function(){var i=this;if(null===this.De){var t=$("#pen_position").data("handler");if(!t)return;this.De=t,this.De.tn("change",function(t){i.W()}),i.W()}this.Le&&this.W()},D.prototype.W=function(t){var h,a,r,l,p,i,s,n,u,c,d=this;null!==this.De&&(s=$(".simBuf",this._),(h=(h=t)||new lt(s[0],1,1)).dt(s.width(),s.height()),n=parseInt($(".seed_a",this._).val()),(a=parseInt($(".seed_b",this._).val()))<n&&($(".seed_a",this._).val(a),n=a),r=.45*Math.min(this.cs,this.ds),l=r*n/a,i=$(".many_pens").is(":checked")?(p=2,[[.2,"#ff0000"],[.4,"#ff0088"],[.6,"#ff00ff"],[.8,"#8800ff"],[1,"#0000ff"]]):(p=3,[[this.De.no(),"#ff0000"]]),t=2*Math.PI*n,this.Le?(s=Date.now()/1e3,n=Math.PI/6,t<=(u=Math.min(t,n*(s-d.Oe)))&&(this.Le=!1)):u=t,$.each(i,function(t,i){h.Ai(i[1],p),h.Fi();var s,n,e=.1/a;for(c=0;c<u;c+=e){var o=(s=c,n=i[0],[d.cs/2+(r-l)*Math.cos(s)+l*n*Math.cos((r-l)*s/l),d.ds/2+(r-l)*Math.sin(s)-l*n*Math.sin((r-l)*s/l)]);0===c?h.Li(o[0],o[1]):h.Oi(o[0],o[1])}c-=e,h.Di(),$(".show_wheels",d._).is(":checked")&&(h.Ds(i[1]),h.Fi(),h.Js(o[0],o[1],5,0,2*Math.PI,!1),h.Us())}),$(".show_wheels",this._).is(":checked")&&(h.Ai("#000000",1.4),h.Fi(),h.Js(d.cs/2,d.ds/2,r,0,2*Math.PI,!1),h.Di(),h.Fi(),h.Js(d.cs/2+(r-l)*Math.cos(c),d.ds/2+(r-l)*Math.sin(c),l,0,2*Math.PI,!1),h.Di()))},D.prototype.dt=function(){var t=$(".simulation_canvas",this._);this.cs=t.width(),this.ds=Math.min(.7*$(window).height(),$(window).height()-240),this.ds=Math.max(this.ds,200),$(".simulation_holder, .sim",this._).width(this.cs).height(this.ds),$(".simulation_canvas",this._).css("height",at(this.ds)+"px"),w(null,$(".simBack",this._),this.Hi,this.cs/2,this.ds/2),this.W()},$(function(){$(".spirograph").each(function(t,i){var s=$(i),i=new D(s.data("meta"),s);s.data("handler",i)})}),T.prototype.oo=function(){return"Point("+this.Hn+","+this.Vn+","+this.Wn+")"},T.prototype.ho=function(){return new R(this.Hn,this.Vn,this.Wn)},T.prototype.ao=function(t){return new T(this.Hn+t.Hn,this.Vn+t.Vn,this.Wn+t.Wn)},T.prototype.ro=function(t){return new R(this.Hn-t.Hn,this.Vn-t.Vn,this.Wn-t.Wn)},T.prototype.lo=function(){return new R(this.Hn,this.Vn,this.Wn)},T.prototype.Ps=function(){return Math.sqrt(this.Hn*this.Hn+this.Vn*this.Vn+this.Wn*this.Wn)},T.prototype.po=function(t){for(var i=this.Ps(),s=180/Math.PI,n=K(t)*Math.PI/12,t=Math.asin(this.Wn/i)*s,e=(Math.atan2(this.Vn,this.Hn)-n)*s,e=Math.mod(e,360);e<0;)e+=360;return{lat:t,lng:e,alt:i-6371e3}},R.prototype.uo=function(){return[this.Hn,this.Vn,this.Wn]},R.prototype.oo=function(){return"Vector("+this.Hn+","+this.Vn+","+this.Wn+")"},R.prototype.co=function(t){return new R(this.Hn+t.Hn,this.Vn+t.Vn,this.Wn+t.Wn)},R.prototype.Jn=function(t){return new R(this.Hn-t.Hn,this.Vn-t.Vn,this.Wn-t.Wn)},R.prototype.Rn=function(t){return new R(this.Hn*t,this.Vn*t,this.Wn*t)},R.prototype.Ps=function(){return Math.sqrt(this.Hn*this.Hn+this.Vn*this.Vn+this.Wn*this.Wn)},R.prototype.Ue=function(){var t=this.Ps();if(0===t)return{ra:0,dec:0};var t=Math.asin(this.Wn/t),i=Math.atan2(this.Vn,this.Hn);for(i*=12/Math.PI,t*=180/Math.PI;i<0;)i+=24;for(;24<=i;)i-=24;return{ra:i,dec:t}},R.prototype.jn=function(t){return new R(this.Vn*t.Wn-this.Wn*t.Vn,this.Wn*t.Hn-this.Hn*t.Wn,this.Hn*t.Vn-this.Vn*t.Hn)},R.prototype.Un=function(t){return this.Hn*t.Hn+this.Vn*t.Vn+this.Wn*t.Wn},R.prototype.do=function(t){t=this.Un(t)/this.Ps()/t.Ps();return 1<t&&(t=1),t<-1&&(t=-1),180*Math.acos(t)/Math.PI},R.prototype.fo=function(){var t=this.Ps();return new R(this.Hn/t,this.Vn/t,this.Wn/t)},U.prototype.Ye=function(t){return this.mi.ao(this.Te.Rn(t))},U.prototype.yo=function(t){var i=this.mi,s=t.mi,n=this.Te,e=t.Te,s=s.ro(i),i=e.Un(n),e=(s.Un(e)-s.Un(n)*i)/(1-pow(i,2)),s=e*i-s.Un(n),n=this.Ye(s),s=t.Ye(e),t=Math.abs(n.ro(s)),e=Math.abs(n.lo().do(s.lo()));return{self_point:n,other_point:s,distance:t,angular_distance:e}},R.prototype.Je=function(t){return new R(this.Hn*Math.cos(t)+this.Vn*-Math.sin(t),this.Hn*Math.sin(t)+this.Vn*Math.cos(t),this.Wn)},R.prototype.Re=function(t){return new R(this.Hn*Math.cos(t)+this.Wn*-Math.sin(t),this.Vn,this.Hn*Math.sin(t)+this.Wn*Math.cos(t))},R.prototype.Mo=function(t){return new R(this.Hn,this.Vn*Math.cos(t)+this.Wn*-Math.sin(t),this.Vn*Math.sin(t)+this.Wn*Math.cos(t))},W.prototype.xo=function(t,i){var s=Math.sin(t),n=Math.cos(t),e=Math.sin(i),o=Math.cos(i),t=[[1,0,0],[0,1,0],[0,0,1]],i=this.je;t[0][0]=n*i[0][0]+s*i[2][0],t[0][1]=n*i[0][1]+s*i[2][1],t[0][2]=n*i[0][2]+s*i[2][2],t[1][0]=-s*e*i[0][0]+o*i[1][0]+e*n*i[2][0],t[1][1]=-s*e*i[0][1]+o*i[1][1]+e*n*i[2][1],t[1][2]=-s*e*i[0][2]+o*i[1][2]+e*n*i[2][2],t[2][0]=-o*s*i[0][0]-e*i[1][0]+o*n*i[2][0],t[2][1]=-o*s*i[0][1]-e*i[1][1]+o*n*i[2][1],t[2][2]=-o*s*i[0][2]-e*i[1][2]+o*n*i[2][2];i=new W;return i.je=t,i},W.prototype.vo=function(){var t,i,s,n,e=this.je;return 1<e[0][0]&&(e[0][0]=1),e[0][0]<-1&&(e[0][0]=-1),1<e[0][1]&&(e[0][1]=1),e[0][1]<-1&&(e[0][1]=-1),1<e[0][2]&&(e[0][2]=1),e[0][2]<-1&&(e[0][2]=-1),1<e[1][0]&&(e[1][0]=1),e[1][0]<-1&&(e[1][0]=-1),1<e[1][1]&&(e[1][1]=1),e[1][1]<-1&&(e[1][1]=-1),1<e[1][2]&&(e[1][2]=1),e[1][2]<-1&&(e[1][2]=-1),1<e[2][0]&&(e[2][0]=1),e[2][0]<-1&&(e[2][0]=-1),1<e[2][1]&&(e[2][1]=1),e[2][1]<-1&&(e[2][1]=-1),1<e[2][2]&&(e[2][2]=1),e[2][2]<-1&&(e[2][2]=-1),n=e[2][1]<1&&-1<e[2][1]?(s=-Math.asin(e[2][1]),t=Math.atan2(e[2][0]/Math.cos(s),e[2][2]/Math.cos(s)),i=s,s=Math.atan2(e[0][1]/Math.cos(s),e[1][1]/Math.cos(s)),t):(s=0,n=Math.atan2(e[1][0],e[1][2]),e[2][0]<0?(i=Math.PI/2,s+n):(i=-Math.PI/2,-s+n)),[i,s,n]},W.prototype._o=function(t){var i=this.je;return new R(t.Hn*i[0][0]+t.Vn*i[0][1]+t.Wn*i[0][2],t.Hn*i[1][0]+t.Vn*i[1][1]+t.Wn*i[1][2],t.Hn*i[2][0]+t.Vn*i[2][1]+t.Wn*i[2][2])},W.prototype.mo=function(t){var i=this.je,s=new W,n=s.je;return n[0][0]=i[0][0],n[0][1]=i[0][1],n[0][2]=i[0][2],n[1][0]=i[1][0]*Math.cos(t)-i[2][0]*Math.sin(t),n[1][1]=i[1][1]*Math.cos(t)-i[2][1]*Math.sin(t),n[1][2]=i[1][2]*Math.cos(t)-i[2][2]*Math.sin(t),n[2][0]=i[1][0]*Math.sin(t)+i[2][0]*Math.cos(t),n[2][1]=i[1][1]*Math.sin(t)+i[2][1]*Math.cos(t),n[2][2]=i[1][2]*Math.sin(t)+i[2][2]*Math.cos(t),s},W.prototype.bo=function(t){var i=this.je,s=new W,n=s.je;return n[0][0]=i[0][0]*Math.cos(t)+i[2][0]*Math.sin(t),n[0][1]=i[0][1]*Math.cos(t)+i[2][1]*Math.sin(t),n[0][2]=i[0][2]*Math.cos(t)+i[2][2]*Math.sin(t),n[1][0]=i[1][0],n[1][1]=i[1][1],n[1][2]=i[1][2],n[2][0]=-i[0][0]*Math.sin(t)+i[2][0]*Math.cos(t),n[2][1]=-i[0][1]*Math.sin(t)+i[2][1]*Math.cos(t),n[2][2]=-i[0][2]*Math.sin(t)+i[2][2]*Math.cos(t),s},W.prototype.wo=function(t){var i=this.je,s=new W,n=s.je;return n[0][0]=i[0][0]*Math.cos(t)-i[1][0]*Math.sin(t),n[0][1]=i[0][1]*Math.cos(t)-i[1][1]*Math.sin(t),n[0][2]=i[0][2]*Math.cos(t)-i[1][2]*Math.sin(t),n[1][0]=i[0][0]*Math.sin(t)+i[1][0]*Math.cos(t),n[1][1]=i[0][1]*Math.sin(t)+i[1][1]*Math.cos(t),n[1][2]=i[0][2]*Math.sin(t)+i[1][2]*Math.cos(t),n[2][0]=i[2][0],n[2][1]=i[2][1],n[2][2]=i[2][2],s},lt.prototype.dt=function(t,i){this.cs=t,this.ds=i,this.We.width=t,this.We.height=i,this.io=this.We.getContext("2d"),this.Dn("Arial,Helvetica,sans-serif",13,"",""),this.Ai("#000000",1),this.Ds("#000000"),this.$o=[],this.He.D()},lt.prototype.Po=function(){this.dt(this.cs,this.ds)},lt.prototype.an=function(t,i,s){this.io.save(),this.io.translate(t,i),this.io.rotate(s)},lt.prototype.rn=function(){this.io.restore()},lt.prototype.Ai=function(t,i){this.io.strokeStyle=t,this.io.lineWidth=i,this.ko=t,this.zo=i},lt.prototype.Ds=function(t){this.io.fillStyle=t,this.No=t},lt.prototype.Dn=function(t,i,s,n){this.Io=[t,i,s,n],this.io.font=n+" "+s+" "+i+"px "+t},lt.prototype.Fi=function(){this.io.beginPath()},lt.prototype.Li=function(t,i){this.io.moveTo(t,i)},lt.prototype.Oi=function(t,i){this.io.lineTo(t,i)},lt.prototype.On=function(){this.io.closePath()},lt.prototype.hn=function(t,i,s,n){this.io.rect(t,i,s,n)},lt.prototype.Js=function(t,i,s,n,e,o){this.io.arc(t,i,s,n,e,o)},lt.prototype.Bo=function(t,i,s,n,e){this.io.save(),this.io.translate(t,i),this.io.rotate(e),this.io.scale(n,s),this.io.arc(0,0,1,0,2*Math.PI,!1),this.io.restore()},lt.prototype.so=function(t,i,s,n,e,o){this.io.bezierCurveTo(t,i,s,n,e,o)},lt.prototype.Di=function(){this.io.stroke()},lt.prototype.Us=function(){this.io.closePath(),this.io.fill()},lt.prototype.So=function(){this.io.save(),this.io.clip()},lt.prototype.Eo=function(){this.io.restore()},lt.prototype.Ts=function(t,i,s,n,e,o,h,a){if(h||a){var r,l,p=this.io.measureText(o).width+4,u=this.Io[1]+4,p=s<0?(r=t)+p:0<s?(r=t-p,t):(r=t-p/2,t+p/2),u=n<0?(l=i-u,i):0<n?(l=i)+u:(l=i-u/2,i+u/2);if(this.He.Co(r,p,l,u,h,a))return 1}return this.io.textBaseline=n<0?"bottom":0<n?"top":"middle",this.io.textAlign=s<0?"left":0<s?"right":"center",e?this.io.fillText(o,t,i):this.io.strokeText(o,t,i),0},lt.prototype.Ao=function(t){return this.io.measureText(t).width},lt.prototype.Fo=function(t,i,s,n,e,o,h){this.$o.push([h,t,i,s,n,e,o,this.Io,this.ko,this.zo,this.No])},lt.prototype.Lo=function(){var s=this;this.$o.sort(function(t,i){return i[0]-t[0]}),$.each(this.$o,function(t,i){s.Ai(i[8],i[9]),s.Ds(i[10]),s.Dn(i[7][0],i[7][1],i[7][2],i[7][3]),s.Ts(i[1],i[2],i[3],i[4],i[5],i[6],!0,!0)}),this.$o=[]},lt.prototype.Oo=function(t,i,s,n,e,o,h,a,r){this.io.drawImage(t,i,s,n,e,o,h,a,r)},lt.prototype._t=function(){},lt.prototype.Xi=function(t){this.io.drawImage(t.We,0,0)},lt.prototype.Do=function(t){var i;ht()?(i=this.We.msToBlob(),window.navigator.msSaveBlob(i,t)):(t=this.We.toDataURL("image/png"),window.open().document.write("<img src='"+t+"'/>"))},pt.prototype.D=function(){this.To=[]},pt.prototype.Co=function(s,n,e,o,t,i){var h=!1;return t&&$.each(this.To,function(t,i){s<i[1]&&n>i[0]&&e<i[3]&&o>i[2]&&(h=!0)}),h?1:(i&&this.To.push([s,n,e,o]),0)},ut.prototype.dt=function(t,i){this.cs=t,this.ds=i,this.We.width=t,this.We.height=i,this.io=this.We.getContext("2d"),this.Po()},ut.prototype.Po=function(){this.Dn("Arial,Helvetica,sans-serif",13,"",""),this.Ai("#000000",1),this.Ds("#000000"),this.$o=[],this.He.D();var t={open:"<defs>",close:"</defs>",children:[{open:'<clipPath id="page">',close:"</clipPath>",children:[{open:'<rect x="0" y="0" width="'+this.cs+'" height="'+this.ds+'" />',close:"",children:[]}]}]},i={open:'<g clip-path="url(#page)">',close:"</g>",children:[]};this.jo={open:'<svg version="1.1" width="'+this.cs+'" height="'+this.ds+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">',close:"</svg>",children:[t,i]},this.Ro=t,this.Jo=[i],this.Uo=0,this.Fi()},ut.prototype.an=function(t,i,s){i={open:'<g transform="translate('+t+","+i+") rotate("+(s/Math.PI*180).toFixed(3)+')">',close:"</g>",children:[]},s=this.Jo.length-1;this.Jo[s].children.push(i),this.Jo.push(i)},ut.prototype.rn=function(){this.Jo.pop()},ut.prototype.Ai=function(t,i){this.ko=t,this.zo=i},ut.prototype.Ds=function(t){this.No=t},ut.prototype.Dn=function(t,i,s,n){this.Io=[t,i,s,n],this.io.font=n+" "+s+" "+i+"px "+t},ut.prototype.Fi=function(){this.Wo=[],this.Ho=null,this.Vo=null},ut.prototype.Li=function(t,i){null===this.Ho&&(this.Ho=[],this.Wo.push({type:"polygon",path:this.Ho})),this.Ho.push(["M",t.toFixed(2),i.toFixed(2)].join(" ")),this.Vo=[t,i]},ut.prototype.Oi=function(t,i){null!==this.Ho?this.Ho.push(["L",t.toFixed(2),i.toFixed(2)].join(" ")):this.Li(t,i)},ut.prototype.On=function(){this.Vo&&this.Oi(this.Vo[0],this.Vo[1])},ut.prototype.hn=function(t,i,s,n){this.Ho=null,this.Wo.push({type:"rect",path:[t.toFixed(2),i.toFixed(2),s.toFixed(2),n.toFixed(2)]})},ut.prototype.Js=function(t,i,s,n,e,o){var h,a;0===n&&e===2*Math.PI?(this.Ho=null,this.Wo.push({type:"circle",path:[t.toFixed(2),i.toFixed(2),s.toFixed(2)]})):(h=function(t,i,s,n){return{x:t+s*Math.cos(n),y:i+s*Math.sin(n)}},n%=2*Math.PI,(a=(e%=2*Math.PI)-n)<0&&(a+=2*Math.PI),n=h(t,i,s,n),e=h(t,i,s,e),a=o?a>Math.PI?0:1:a>Math.PI?1:0,o=at(!o),this.Oi(n.x,n.y),this.Ho.push(["A",s.toFixed(2),s.toFixed(2),0,a,o,e.x.toFixed(2),e.y.toFixed(2)].join(" ")))},ut.prototype.Bo=function(t,i,s,n,e){e=180*e/Math.PI;this.Ho=null,this.Wo.push({type:"ellipse",path:[t.toFixed(2),i.toFixed(2),n.toFixed(2),s.toFixed(2),e.toFixed(2)]})},ut.prototype.so=function(t,i,s,n,e,o){null!==this.Ho&&this.Ho.push(["C",t.toFixed(2),i.toFixed(2),",",s.toFixed(2),n.toFixed(2),",",e.toFixed(2),o.toFixed(2)].join(" "))},ut.prototype.Go=function(s){var n="";return $.each(this.Wo,function(t,i){"rect"===i.type?n+='<rect x="'+i.path[0]+'" y="'+i.path[1]+'" width="'+i.path[2]+'" height="'+i.path[3]+'" '+s+" />":"circle"===i.type?n+='<circle cx="'+i.path[0]+'" cy="'+i.path[1]+'" r="'+i.path[2]+'" '+s+" />":"ellipse"===i.type?n+='<ellipse cx="'+i.path[0]+'" cy="'+i.path[1]+'" rx="'+i.path[2]+'" ry="'+i.path[3]+'" transform="rotate('+i.path[4]+')" '+s+" />":"polygon"===i.type&&(n+='<path d="',n+=i.path.join(" "),n+='" '+s+" />")}),n},ut.prototype.Di=function(){var t='fill="none" stroke="'+this.ko+'" stroke-width="'+this.zo+'"',i=this.Jo.length-1;this.Jo[i].children.push({open:this.Go(t),close:"",children:[]})},ut.prototype.Us=function(){var t='stroke="none" fill="'+this.No+'"',i=this.Jo.length-1;this.Jo[i].children.push({open:this.Go(t),close:"",children:[]})},ut.prototype.So=function(){this.Ro.children.push({open:'<clipPath id="clip'+this.Uo+'">',close:"</clipPath>",children:[{open:this.Go(""),close:"",children:[]}]});var t={open:'<g clip-path="url(#clip'+this.Uo+')">',close:"</g>",children:[]},i=this.Jo.length-1;this.Jo[i].children.push(t),this.Jo.push(t),this.Uo++},ut.prototype.Eo=function(){this.Jo.pop()},ut.prototype.Ts=function(t,i,s,n,e,o,h,a){var r=this.io.measureText(o).width,l=this.Io[1];if(h||a){var p,u,c=s<0?(p=t)+r:0<s?(p=t-r,t):(p=t-r/2,t+r/2),r=n<0?(u=i-l,i):0<n?(u=i)+l:(u=i-l/2,i+l/2);if(this.He.Co(p,c,u,r,h,a))return 1}n<0||(i+=0<n?l:l/2),s=s<0?"start":0<s?"end":"middle";i='<text x="'+t.toFixed(2)+'" y="'+i.toFixed(2)+'" ';this.Io[0]&&(i+='font-family="'+this.Io[0]+'" '),this.Io[1]&&(i+='font-size="'+this.Io[1]+'" '),this.Io[2]&&(i+='font-weight="'+this.Io[2]+'" '),this.Io[3]&&(i+='font-style="'+this.Io[3]+'" '),i+='text-anchor="'+s+'" ',i+=e?'stroke="none" fill="'+this.No+'" ':'fill="none" stroke="'+this.ko+'" stroke-width="'+this.zo+'" ',i+=">"+o+"</text>";o=this.Jo.length-1;return this.Jo[o].children.push({open:i,close:"",children:[]}),0},ut.prototype.Ao=function(t){return this.io.measureText(t).width},ut.prototype.Fo=function(t,i,s,n,e,o,h){this.$o.push([h,t,i,s,n,e,o,this.Io,this.ko,this.zo,this.No])},ut.prototype.Lo=function(){var s=this;this.$o.sort(function(t,i){return i[0]-t[0]}),$.each(this.$o,function(t,i){s.Ai(i[8],i[9]),s.Ds(i[10]),s.Dn(i[7][0],i[7][1],i[7][2],i[7][3]),s.Ts(i[1],i[2],i[3],i[4],i[5],i[6],1,1)}),this.$o=[]},ut.prototype.Oo=function(t,i,s,n,e,o,h,a,r){},ut.prototype._t=function(){var i="",s=function(t){i+=t.open+"\n",$.each(t.children,function(t,i){s(i)}),t.close&&(i+=t.close+"\n")};return s(this.jo),i},ut.prototype.Xi=function(t){var i=this.jo.children[0],s=this.jo.children[1],n=t.jo.children[0],t=t.jo.children[1];i.children=i.children.concat(n.children),s.children=s.children.concat(t.children)},ct.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"arrowType":s.arrowType=i;break;case"color":s.color=i;break;case"strokeLineWidth":s.strokeLineWidth=i;break;case"origin":s.origin=i;break;case"target":s.target=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised arrow setting "+t}})},ct.prototype.cleanWorkspace=function(){this.workspace=[]},ct.prototype.determineWidth=function(t){this.page=t,this.cleanWorkspace()},ct.prototype.calculateDataRanges=function(){},ct.prototype.calculateBoundingBox=function(){var t=new JSPlot_BoundingBox;return t.includePoint(this.origin[0],this.origin[1]),t.includePoint(this.target[0],this.target[1]),t},ct.prototype.render=function(){null!==this.color&&(new vt).primitive_arrow(this.page,this.arrowType,this.origin[0],this.origin[1],0,this.target[0],this.target[1],0,this.color,this.strokeLineWidth,1)},ct.prototype.interactive_scroll=function(t,i){},ct.prototype.interactive_zoom=function(t){return!1},dt.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"arrowType":s.arrowType=i;break;case"atZero":s.atZero=i;break;case"dataType":s.data_type=i;break;case"enabled":s.enabled=i;break;case"linkTo":s.linkTo=i;break;case"log":s.logarithmic=i;break;case"min":s.min=i;break;case"max":s.max=i;break;case"mirror":s.mirror=i;break;case"label":s.label=i;break;case"labelRotate":s.labelRotate=i;break;case"rangeReversed":s.rangeReversed=i;break;case"scrollEnabled":s.scrollEnabled=i;break;case"scrollMin":s.scrollMin=i;break;case"scrollMax":s.scrollMax=i;break;case"scrollSpan":s.scrollSpan=i;break;case"showLabels":s.showLabels=i;break;case"tickLabelRotation":s.tickLabelRotation=i;break;case"ticksMinor":s.ticksMinor.configure(i);break;case"ticks":s.ticks.configure(i);break;case"visible":s.visible=i;break;case"zoomEnabled":s.zoomEnabled=i;break;default:throw"Unrecognised axis setting "+t}})},dt.prototype.cleanWorkspace=function(){this.workspace=[],this.workspace.activeFinal="1"===this.axis_name[1],this.workspace.crossedAtZero=null,this.workspace.minUsed=null,this.workspace.maxUsed=null,this.workspace.minFinal=null,this.workspace.maxFinal=null,this.workspace.minHard=this.min,this.workspace.maxHard=this.max,this.workspace.logFinal=this.logarithmic,this.workspace.rangeFinalised=!1,this.workspace.target_number_major_ticks=null,this.workspace.target_number_minor_ticks=null,this.workspace.axisName=null,this.workspace.canvasId=null,this.workspace.labelFinal=this.label,this.workspace.mode0BackPropagated=!1,this.workspace.tickListFinal=null,this.workspace.max_tick_label_width=0,this.ticking_allocator=null},dt.prototype.allocate_axis_ticks=function(){var s=this;"timestamp"===this.data_type?this.ticking_allocator=new Ft(this):this.logarithmic?this.ticking_allocator=new At(this):this.ticking_allocator=new Ct(this),this.ticking_allocator.process();var n=document.createElement("canvas").getContext("2d");n.font="15px Arial,Helvetica,sans-serif";var t={x:this.workspace.max_tick_label_width=0,y:1,z:2}[this.axis_name.substr(0,1)],i=-this.tickLabelRotation*Math.PI/180,t=this.graph.workspace.axis_bearing[t],e=i+Math.PI/2+t,t=this.workspace.tickListFinal.major;$.each(t,function(t,i){""!==i[1]&&(i=n.measureText(i[1]).width,i=Math.abs(i*Math.sin(e))+Math.abs(15*Math.cos(e)),s.workspace.max_tick_label_width=Math.max(s.workspace.max_tick_label_width,i))})},dt.prototype.includePoint=function(t){isFinite(t)&&((null===this.workspace.minUsed||this.workspace.minUsed>t&&(!this.workspace.logFinal||0<t))&&(this.workspace.minUsed=t),(null===this.workspace.maxUsed||this.workspace.maxUsed<t&&(!this.workspace.logFinal||0<t))&&(this.workspace.maxUsed=t))},dt.prototype.getPosition=function(t,i){var s=0;if(!i)if(this.workspace.maxFinal>this.workspace.minFinal){if(t<this.workspace.minFinal||t>this.workspace.maxFinal)return NaN}else if(t>this.workspace.minFinal||t<this.workspace.maxFinal)return NaN;return this.workspace.logFinal&&t<=0?NaN:(s=this.workspace.logFinal?(Math.log(t)-Math.log(this.workspace.minFinal))/(Math.log(this.workspace.maxFinal)-Math.log(this.workspace.minFinal)):(t-this.workspace.minFinal)/(this.workspace.maxFinal-this.workspace.minFinal),this.rangeReversed&&(s=1-s),s)},dt.prototype.invGetPosition=function(t){return this.rangeReversed&&(t=1-t),this.workspace.logFinal?this.workspace.minFinal+t*(this.workspace.maxFinal-this.workspace.minFinal):this.workspace.minFinal*Math.pow(this.workspace.maxFinal/this.workspace.minFinal,t)},dt.prototype.inRange=function(t){var i=null,s=null;return null!==this.workspace.minHard&&(i=this.workspace.minHard),null!==this.workspace.maxHard&&(s=this.workspace.maxHard),null===this.min&&(i=null),null===this.max&&(s=null),this.scrollEnabled&&((i=s=null)!==this.scrollMin&&(i=this.scrollMin),null!==this.scrollMax&&(s=this.scrollMax)),null!==i&&null!==s?i<=t&&t<=s||t<=i&&s<=t:null!==i?i<t:null===s||t<s},dt.prototype.linkedAxisBackPropagate=function(t){for(var i=this,s=0;s<100&&(null!==i.linkTo&&(null!==i.workspace.minUsed||null!==i.workspace.maxUsed));s++){if(!t.itemList.hasOwnProperty(i.linkTo[0])){t.workspace.errorLog+="Axis linked to plot <"+i.linkTo[0]+"> which doesn't exist.\n";break}if("graph"!==!t.itemList[i.linkTo[0]].itemType){t.workspace.errorLog+="Axis linked to plot <"+i.linkTo[0]+"> which is not a graph.\n";break}if(!t.itemList[i.linkTo[0]].axes.hasOwnProperty(i.linkTo[1])){t.workspace.errorLog+="Axis linked to axis <"+i.linkTo[1]+"> which doesn't exist.\n";break}var n=t.itemList[i.linkTo[0]].axes[i.linkTo[1]];null!==i.workspace.minUsed&&(null===n.workspace.minUsed||n.workspace.minUsed>i.workspace.minUsed)&&(n.workspace.minUsed=i.workspace.minUsed),null!==i.workspace.maxUsed&&(null===n.workspace.minUsed||n.workspace.maxUsed<i.workspace.maxUsed)&&(n.workspace.maxUsed=i.workspace.maxUsed),i=n}},dt.prototype.linkedAxisForwardPropagate=function(t,i){for(var s=i,n=this,e=[this],o=0;o<100&&null!==n.linkTo;o++){if(!t.itemList.hasOwnProperty(n.linkTo[0])){t.workspace.errorLog+="Axis linked to plot <"+n.linkTo[0]+"> which doesn't exist.\n";break}if("graph"!==t.itemList[n.linkTo[0]].itemType){t.workspace.errorLog+="Axis linked to plot <"+n.linkTo[0]+"> which is not a graph.\n";break}if(!t.itemList[n.linkTo[0]].axes.hasOwnProperty(n.linkTo[1])){t.workspace.errorLog+="Axis linked to axis <"+n.linkTo[1]+"> which doesn't exist.\n";break}n=t.itemList[n.linkTo[0]].axes[n.linkTo[1]],e.push(n)}1!==i||n.workspace.rangeFinalised||n.allocate_axis_ticks();for(var h=e.length-2;0<=h;h--){var a=e[h];if(a.workspace.rangeFinalised)break;if(null===a.linkTo)break;0===s&&a.workspace.mode0BackPropagated||(a.workspace.mode0BackPropagated=!0,0===i?(a.workspace.minHard=n.workspace.minHard,a.workspace.maxHard=n.workspace.maxHard):1===i&&(a.workspace.logFinal=n.workspace.logFinal,a.workspace.minFinal=n.workspace.minFinal,a.workspace.maxFinal=n.workspace.maxFinal,a.workspace.rangeFinalised=!0,a.allocate_axis_ticks()))}},dt.prototype.axis_tick_text_alignment=function(t){for(t%=2*Math.PI;t<0;)t+=2*Math.PI;return t<+Math.PI/8?[0,1]:t<3*Math.PI/8?[-1,1]:t<5*Math.PI/8?[-1,0]:t<7*Math.PI/8?[-1,-1]:t<9*Math.PI/8?[0,-1]:t<11*Math.PI/8?[1,-1]:t<13*Math.PI/8?[1,0]:t<15*Math.PI/8?[1,1]:[0,-1]},dt.prototype.render=function(l,t,s,p,i,u,c,n,d,f){var y,g,M=this,x=!t;this.visible&&(f=f&&this.showLabels,(new vt).primitive_arrow(l,this.arrowType,s,p,i,u,c,n,this.graph.axesColor,l.constants.AXES_LINEWIDTH,0),t={x:0,y:1,z:2}[this.axis_name.substr(0,1)],i=-this.tickLabelRotation*Math.PI/180,y=this.graph.workspace.axis_bearing[t],n=i+Math.PI/2+y+Math.PI*x,g=this.axis_tick_text_alignment(n),$.each(["major","minor"],function(t,a){var r="major"===a?l.constants.AXES_MAJTICKLEN:l.constants.AXES_MINTICKLEN,i=M.workspace.tickListFinal[a];$.each(i,function(t,n){var e=M.getPosition(n[0],!0),o=s+(u-s)*e,h=p+(c-p)*e;$.each(d,function(t,i){var s=o+Math.sin(i)*r,i=h+Math.cos(i)*r;e<.001&&("back"===M.arrowType||"double"===M.arrowType)||.999<e&&("single"===M.arrowType||"double"===M.arrowType)||(.001<e&&e<.999&&(l.canvas.Ai(M.graph.axesColor.toHTML(),l.constants.AXES_LINEWIDTH),l.canvas.Fi(),l.canvas.Li(o,h),l.canvas.Oi(s,i),l.canvas.Di()),f&&"major"===a&&""!==n[1]&&(s=o+(x?-1:1)*Math.sin(y+Math.PI/2)*l.constants.AXES_TEXTGAP+0,i=h+(x?-1:1)*Math.cos(y+Math.PI/2)*l.constants.AXES_TEXTGAP,l.canvas.an(s,i,M.tickLabelRotation),l.canvas.Dn(l.constants.LEGEND_fontFamily,l.constants.LEGEND_fontSize*M.graph.fontSize*1.1,l.constants.LEGEND_fontWeight,l.constants.LEGEND_fontStyle),l.canvas.Ds(M.graph.textColor.toHTML()),l.canvas.Ts(0,0,g[0],g[1],!0,n[1],!1,!0),l.canvas.rn()))})})}),f&&null!==M.workspace.labelFinal&&(n=(i=-M.labelRotate)+Math.PI*x,g=this.axis_tick_text_alignment(n),t=(s+u)/2+(x?-1:1)*(this.workspace.max_tick_label_width+l.constants.AXES_LABELGAP)*Math.sin(y+Math.PI/2),n=(p+c)/2+(x?-1:1)*(this.workspace.max_tick_label_width+l.constants.AXES_LABELGAP)*Math.cos(y+Math.PI/2),i=i+Math.PI/2-y,(i%=2*Math.PI)<-Math.PI&&(i+=2*Math.PI),i>Math.PI&&(i-=2*Math.PI),i>Math.PI/2&&(i-=Math.PI),i<-Math.PI/2&&(i+=Math.PI),l.canvas.an(t,n,i),l.canvas.Dn(l.constants.LEGEND_fontFamily,l.constants.LEGEND_fontSize*M.graph.fontSize*1.2,l.constants.LEGEND_fontWeight,l.constants.LEGEND_fontStyle),l.canvas.Ds(M.graph.textColor.toHTML()),l.canvas.Ts(0,0,g[0],g[1],!0,M.workspace.labelFinal,!1,!0),l.canvas.rn()))},dt.prototype.interactive_scroll=function(t,i,s){(s||this.scrollEnabled)&&null!==this.workspace.minFinal&&null!==this.workspace.maxFinal&&(null===this.scrollSpan&&(this.workspace.logFinal?(this.scrollSpan=this.workspace.maxFinal/this.workspace.minFinal,this.scrollSpan<1&&(this.scrollSpan=1/this.scrollSpan)):this.scrollSpan=Math.abs(this.workspace.maxFinal-this.workspace.minFinal)),null===this.min&&(this.min=this.workspace.minFinal),this.workspace.logFinal?(this.min/=Math.pow(this.scrollSpan,i),null!==this.scrollMin&&this.min<this.scrollMin&&(this.min=this.scrollMin),null!==this.scrollMax&&this.min>this.scrollMax/this.scrollSpan&&(this.min=this.scrollMax/this.scrollSpan),this.max=this.min*this.scrollSpan):(this.min-=i*this.scrollSpan,null!==this.scrollMin&&this.min<this.scrollMin&&(this.min=this.scrollMin),null!==this.scrollMax&&this.min>this.scrollMax-this.scrollSpan&&(this.min=this.scrollMax-this.scrollSpan),this.max=this.min+this.scrollSpan),t.needs_refresh=!0)},dt.prototype.interactive_zoom=function(t,i){var s=this.scrollSpan;return this.interactive_scroll(t,0,this.zoomEnabled),this.zoomEnabled&&null!==this.scrollSpan&&(0<i?(this.scrollSpan*=.9,this.interactive_scroll(t,-(1-.9)/2,!0)):(this.scrollSpan/=.9,null!==this.scrollMin&&null!==this.scrollMax&&(this.workspace.logFinal?this.scrollSpan>this.scrollMax/this.scrollMin&&(this.scrollSpan=this.scrollMax/this.scrollMin):this.scrollSpan>this.scrollMax-this.scrollMin&&(this.scrollSpan=this.scrollMax-this.scrollMin)),this.interactive_scroll(t,(1-.9)/2,!0)),t.needs_refresh=!0),this.zoomEnabled&&this.scrollSpan!==s},ft.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"ticDir":s.ticDir=i;break;case"tickList":s.tickList=i;break;case"tickMin":s.tickMin=i;break;case"tickMax":s.tickMax=i;break;case"tickStep":s.tickStep=i;break;default:throw"Unrecognised axis tick setting "+t}})},JSPlot_BoundingBox=function(){this.left=null,this.right=null,this.top=null,this.bottom=null},JSPlot_BoundingBox.prototype.copy=function(){var t=new JSPlot_BoundingBox;return t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t},JSPlot_BoundingBox.prototype.includePoint=function(t,i){(null===this.left||this.left>t)&&(this.left=t),(null===this.right||this.right<t)&&(this.right=t),(null===this.top||this.top>i)&&(this.top=i),(null===this.bottom||this.bottom<i)&&(this.bottom=i)},JSPlot_BoundingBox.prototype.includeBox=function(t){null!==t&&((null===this.left||this.left>t.left)&&(this.left=t.left),(null===this.right||this.right<t.right)&&(this.right=t.right),(null===this.top||this.top>t.top)&&(this.top=t.top),(null===this.bottom||this.bottom<t.bottom)&&(this.bottom=t.bottom))},JSPlot_BoundingBox.prototype.query=function(){return{left:this.left,right:this.right,top:this.top,bottom:this.bottom}},yt.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"allow_export_png":s.settings.allow_export_png=i;break;case"allow_export_svg":s.settings.allow_export_svg=i;break;case"allow_export_csv":s.settings.allow_export_csv=i;break;default:throw"Unrecognised canvas setting "+t}})},yt.prototype._t=function(t){var s=this,n=new JSPlot_BoundingBox,e=[];$.each(this.itemList,function(t,i){e.push(i)}),e.sort(function(t,i){return t.z_index-i.z_index}),this.canvas=t(0,0),$.each(e,function(t,i){i.determineWidth(s)}),$.each(e,function(t,i){i.calculateDataRanges()}),$.each(e,function(t,i){n.includeBox(i.calculateBoundingBox())}),this.canvas.dt(n.right-n.left,n.bottom-n.top),this.canvas.an(-n.left,-n.top,0),this.threeDimensionalBuffer=new Et,$.each(e,function(t,i){i.render()}),this.canvas.rn()},yt.prototype.renderToPNG=function(t){void 0!==t&&(this.page_width=t);var s=document.createElement("canvas");return this._t(function(t,i){return new lt(s,t,i)}),this.canvas.Do("plot.png")},yt.prototype.renderToCSV=function(){var s="";return $.each(this.itemList,function(t,i){"graph"===i.itemType&&(i.title&&(s+=i.title+"\n"),$.each(i.dataSets,function(t,i){i.title&&(s+=i.title+"\n"),$.each(i.data,function(t,i){$.each(i,function(t,i){s+=i+","}),s+="\n"}),s+="\n"})),s+="\n"}),s},yt.prototype.renderToSVG=function(t){void 0!==t&&(this.page_width=t);return this._t(function(t,i){return new ut(t,i)}),this.canvas._t()},yt.prototype.renderToCanvas=function(n){var e=this;!function(){var t,i;n=$(n),e.page_width=n.width(),e.html_initialised||(i="<div><canvas width='1' height='1'></canvas></div>",e.settings.allow_export_png&&(i+="<input class='btn btn-success jsplot_export_png' type='button' value='Export PNG' />"),e.settings.allow_export_svg&&(i+="<input class='btn btn-success jsplot_export_svg' type='button' value='Export SVG' />"),e.settings.allow_export_csv&&(i+="<input class='btn btn-success jsplot_export_csv' type='button' value='Export CSV' />"),n.css("overflow","hidden"),n.html(i),$(".jsplot_export_png").click(function(){e.renderToPNG()}),$(".jsplot_export_svg").click(function(){ot("plot.svg",e.renderToSVG())}),$(".jsplot_export_csv").click(function(){ot("plot_data.csv",e.renderToCSV())}),t=$("canvas",n),e.interactive_holder_element=n,(e.interactive_canvas_element=t).mousedown(function(t){e.mouseDown(t)}),t.mouseup(function(t){e.mouseUp(t)}),t.mousemove(function(t){e.mouseDrag(t)}),t.mouseleave(function(){e.mouseUp(0)}),i="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.bind(i,function(t){e.displayWheel(t.originalEvent)}),t.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(e.is_pinching=!1,e.mouseDown(t.touches[0])):2===t.touches.length&&(e.is_pinching=!0,e.pinch_distance=e.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),e.is_pinching||e.mouseUp(0),e.is_pinching=!1,e.mousedown=!1},touchmove:function(t){t.preventDefault();var i=t.originalEvent;e.is_pinching?(t=e.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY),25<Math.abs(t-e.pinch_distance)&&(e.displayWheel(i.touches[0],e.pinch_distance-t),e.pinch_distance=t)):e.mouseDrag(i.touches[0])},touchcancel:function(t){t.preventDefault(),e.is_pinching||e.mouseUp(0),e.is_pinching=!1,e.mousedown=!1}}),$(window).resize(function(){e.renderToCanvas(e.interactive_holder_element)}),e.html_initialised=!0);var s=$("canvas",n)[0];e._t(function(t,i){return new lt(s,t,i)})}()},yt.prototype.addItem=function(t,i){this.itemList[t]=i},yt.prototype.removeItem=function(t){delete this.itemList[t]},yt.prototype.hypot=function(t,i){return Math.sqrt(t*t+i*i)},yt.prototype.mouseDown=function(t){this.pos_start=u(t,this.interactive_canvas_element),this.mousedown=!0},yt.prototype.mouseDrag=function(t){var i,s,n;0===t?i=this.pos_latest:(i=u(t,this.interactive_canvas_element),this.pos_latest=i),this.mousedown&&(s=i[0]-this.pos_start[0],n=i[1]-this.pos_start[1],$.each(this.itemList,function(t,i){i.interactive_scroll(s,n)}),this.pos_start=i)},yt.prototype.mouseUp=function(t){this.mouseDrag(t),this.mousedown=!1},yt.prototype.displayWheel=function(t,i){var s,n=Date.now();if(void 0!==this.sn&&n<this.sn+120)return t.preventDefault&&t.preventDefault(),void(t.returnValue=!1);s=void 0!==i?i:t.deltaY||t.wheelDelta;var e=!1;$.each(this.itemList,function(t,i){e|=i.interactive_zoom(s<0)}),e&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1,this.sn=n)},gt.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"strokeColor":s.strokeColor=i;break;case"fillColor":s.fillColor=i;break;case"strokeLineWidth":s.strokeLineWidth=i;break;case"origin":s.origin=i;break;case"radius":s.radius=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised circle setting "+t}})},gt.prototype.cleanWorkspace=function(){this.workspace=[]},gt.prototype.determineWidth=function(t){this.page=t,this.cleanWorkspace()},gt.prototype.calculateDataRanges=function(){},gt.prototype.calculateBoundingBox=function(){var t=new JSPlot_BoundingBox;return t.includePoint(this.origin[0]-this.radius-3,this.origin[1]),t.includePoint(this.origin[0]+this.radius+3,this.origin[1]),t.includePoint(this.origin[0],this.origin[1]-this.radius-3),t.includePoint(this.origin[0],this.origin[1]+this.radius+3),t},gt.prototype.render=function(){null!==this.fillColor&&(this.page.canvas.Ds(this.fillColor.toHTML()),this.page.canvas.Fi(),this.page.canvas.Js(this.origin[0],this.origin[1],this.radius,0,2*Math.PI,!1),this.page.canvas.Us()),null!==this.strokeColor&&(this.page.canvas.Ai(this.strokeColor.toHTML(),this.strokeLineWidth),this.page.canvas.Fi(),this.page.canvas.Js(this.origin[0],this.origin[1],this.radius,0,2*Math.PI,!1),this.page.canvas.Di())},gt.prototype.interactive_scroll=function(t,i){},gt.prototype.interactive_zoom=function(t){return!1},Mt.prototype.isVisible=function(){return 0<this.alpha},Mt.prototype.multiply=function(t){return new Mt(this.red*t,this.green*t,this.blue*t,this.alpha)},Mt.prototype.toHTML=function(){function t(t){return(t=Math.floor(255*t))<0&&(t=0),255<t&&(t=255),t}return this.alpha<.999?"rgba("+t(this.red)+","+t(this.green)+","+t(this.blue)+","+t(this.alpha)/255+")":"rgb("+t(this.red)+","+t(this.green)+","+t(this.blue)+")"},xt.prototype.cleanWorkspace=function(){this.workspace={},this.workspace.styleFinal=null,this.workspace.requiredColumns=null},xt.prototype.axisRangeUpdated=function(t,i){"function"==typeof this.update_callback&&this.update_callback(this,t,i)},vt.prototype.primitive_arrow=function(i,t,s,n,e,o,h,a,r,l,p){var u,c,d,f,y,g,M,x,v=i.threeDimensionalBuffer.active&&null!==e&&null!==a;if(r.isVisible()){i.canvas.Ai(r.toHTML(),l);var _=i.constants.DEFAULT_LINEWIDTH*l,m=Math.hypot(o-s,h-n)<1e-200?0:Math.atan2(o-s,h-n),b="double"===t||"back"===t?(u=s-i.constants.ARROW_HEADSIZE*l*Math.sin(m+Math.PI-i.constants.ARROW_ANGLE/2),c=n-i.constants.ARROW_HEADSIZE*l*Math.cos(m+Math.PI-i.constants.ARROW_ANGLE/2),y=s-i.constants.ARROW_HEADSIZE*l*Math.sin(m+Math.PI+i.constants.ARROW_ANGLE/2),g=n-i.constants.ARROW_HEADSIZE*l*Math.cos(m+Math.PI+i.constants.ARROW_ANGLE/2),d=s-i.constants.ARROW_HEADSIZE*l*Math.sin(m+Math.PI)*(1-i.constants.ARROW_CONSTRICT)*Math.cos(i.constants.ARROW_ANGLE/2),f=n-i.constants.ARROW_HEADSIZE*l*Math.cos(m+Math.PI)*(1-i.constants.ARROW_CONSTRICT)*Math.cos(i.constants.ARROW_ANGLE/2),i.threeDimensionalBuffer.addItem(e,function(){i.canvas.Ds(r.toHTML()),i.canvas.Fi(),i.canvas.Li(d,f),i.canvas.Oi(u,c),i.canvas.Oi(s,n),i.canvas.Oi(y,g),i.canvas.Us()}),M=d,f):(M=s,n),w="single"===t||"double"===t?(u=o-i.constants.ARROW_HEADSIZE*l*Math.sin(m-i.constants.ARROW_ANGLE/2),c=h-i.constants.ARROW_HEADSIZE*l*Math.cos(m-i.constants.ARROW_ANGLE/2),y=o-i.constants.ARROW_HEADSIZE*l*Math.sin(m+i.constants.ARROW_ANGLE/2),g=h-i.constants.ARROW_HEADSIZE*l*Math.cos(m+i.constants.ARROW_ANGLE/2),d=o-i.constants.ARROW_HEADSIZE*l*Math.sin(m)*(1-i.constants.ARROW_CONSTRICT)*Math.cos(i.constants.ARROW_ANGLE/2),f=h-i.constants.ARROW_HEADSIZE*l*Math.cos(m)*(1-i.constants.ARROW_CONSTRICT)*Math.cos(i.constants.ARROW_ANGLE/2),i.threeDimensionalBuffer.addItem(e,function(){i.canvas.Ds(r.toHTML()),i.canvas.Fi(),i.canvas.Li(d,f),i.canvas.Oi(u,c),i.canvas.Oi(o,h),i.canvas.Oi(y,g),i.canvas.Us()}),x=d,f):(x=o,h);if(v)for(var $=0;$<100;$++)i.threeDimensionalBuffer.addItem(e+(a-e)/100*$,function(t){return function(){i.canvas.Ai(r.toHTML(),_),i.canvas.Fi(),i.canvas.Li(M+(x-M)/100*t,b+(w-b)/100*t),i.canvas.Oi(M+(x-M)/100*(t+1),b+(w-b)/100*(t+1)),i.canvas.Di()}}($));else i.threeDimensionalBuffer.addItem(e,function(){i.canvas.Ai(r.toHTML(),_),i.canvas.Fi(),i.canvas.Li(M,b),i.canvas.Oi(x,w),i.canvas.Di()})}},_t.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"strokeColor":s.strokeColor=i;break;case"fillColor":s.fillColor=i;break;case"strokeLineWidth":s.strokeLineWidth=i;break;case"origin":s.origin=i;break;case"major_axis":s.major_axis=i;break;case"minor_axis":s.minor_axis=i;break;case"position_angle":s.position_angle=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised ellipse setting "+t}})},_t.prototype.cleanWorkspace=function(){this.workspace=[]},_t.prototype.determineWidth=function(t){this.page=t,this.cleanWorkspace()},_t.prototype.calculateDataRanges=function(){},_t.prototype.calculateBoundingBox=function(){for(var t=new JSPlot_BoundingBox,i=0;i<360;i+=10){var s=i*Math.PI/180,n=this.position_angle*Math.PI/180,e=(this.minor_axis+3)*Math.sin(s),s=(this.major_axis+3)*Math.cos(s);t.includePoint(this.origin[0]+e*Math.cos(n)+s*Math.sin(n),this.origin[1]-e*Math.sin(n)+s*Math.cos(n))}return t},_t.prototype.render=function(){var t=this.position_angle*Math.PI/180;null!==this.fillColor&&(this.page.canvas.Ds(this.fillColor.toHTML()),this.page.canvas.Fi(),this.page.canvas.Bo(this.origin[0],this.origin[1],this.major_axis,this.minor_axis,t),this.page.canvas.Us()),null!==this.strokeColor&&(this.page.canvas.Ai(this.strokeColor.toHTML(),this.strokeLineWidth),this.page.canvas.Fi(),this.page.canvas.Bo(this.origin[0],this.origin[1],this.major_axis,this.minor_axis,t),this.page.canvas.Di())},_t.prototype.interactive_scroll=function(t,i){},_t.prototype.interactive_zoom=function(t){return!1},mt.prototype.evaluate_linear_raster=function(t,i,a,n){function e(t,i){for(var s=[],n=0;n<a;n++){for(var e=t+(i-t)/(a-1)*n,o=[e],h=0;h<r.functions.length;h++)o.push(r.functions[h](e));s.push(o)}return s}var r=this;return new xt(this.title,this.styling,e(t,i),function(t,i,s){n&&(t.data=e(i,s))})},mt.prototype.evaluate_log_raster=function(t,i,a,n){function e(t,i){for(var s=[],n=0;n<a;n++){for(var e=t*Math.pow(i/t,n/(a-1)),o=[e],h=0;h<r.functions.length;h++)o.push(r.functions[h](e));s.push(o)}return s}var r=this;return new xt(this.title,this.styling,e(t,i),function(t,i,s){n&&(t.data=e(i,s))})},mt.prototype.evaluate_over_grid=function(t,i,s,n,e,o){for(var h=[],a=0;a<s;a++)for(var r=0;r<o;r++){for(var l=t+(i-t)/(s-1)*a,p=n+(e-n)/(o-1)*r,u=[l,p],c=0;c<this.functions.length;c++)u.push(this.functions[c](l,p));h.push(u)}var d=new xt(this.title,this.styling,h,null);return d.grid=!0,d.grid_dimensions=[s,o],d},bt.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"annotations":s.annotations=i;break;case"aspect":s.aspect=i;break;case"aspectZ":s.aspectZ=i;break;case"axesColor":s.axesColor=i;break;case"boxFrom":s.boxFrom=i;break;case"boxWidth":s.boxWidth=i;break;case"clip":s.clip=i;break;case"gridMajorColor":s.gridMajorColor=i;break;case"gridMinorColor":s.gridMinorColor=i;break;case"key":s.key=i;break;case"keyColumns":s.keyColumns=i;break;case"keyPosition":s.keyPosition=i;break;case"textColor":s.textColor=i;break;case"bar":s.bar=i;break;case"fontSize":s.fontSize=i;break;case"gridAxes":s.gridAxes=i;break;case"interactiveMode":s.interactiveMode=i;break;case"keyOffset":s.keyOffset=i;break;case"origin":s.origin=i;break;case"threeDimensional":s.threeDimensional=i;break;case"title":s.title=i;break;case"titleOffset":s.titleOffset=i;break;case"width":s.width=i;break;case"widthIncludesAxes":s.widthIncludesAxes=i;break;case"viewAngleXY":s.viewAngleXY=i;break;case"viewAngleYZ":s.viewAngleYZ=i;break;case"x1_axis":case"x2_axis":case"y1_axis":case"y2_axis":case"z1_axis":case"z2_axis":s.axes[t.substring(0,2)].configure(i);break;case"z_index":s.z_index=i;break;default:throw"Unrecognised graph setting "+t}})},bt.prototype.cleanWorkspace=function(){this.workspace=[],this.workspace.aspect=this.aspect,this.workspace.aspectZ=this.aspectZ,null===this.aspect&&(this.threeDimensional?this.workspace.aspect=1:this.workspace.aspect=2/(1+Math.sqrt(5))),this.workspace.aspect*=-1,this.workspace.defaultColorCounter=0,this.workspace.defaultLineTypeCounter=0,this.workspace.defaultPointTypeCounter=0,this.workspace.plotter=null,this.workspace.axis_length=null,this.workspace.axis_bearing=null,this.workspace.width_pixels=1024,$.each(this.axes,function(t,i){i.cleanWorkspace()}),null!==this.page&&(null===this.width?this.widthIncludesAxes?this.workspace.width_pixels=this.page.page_width-1:this.threeDimensional?this.workspace.width_pixels=Math.min(.5*this.page.page_width,this.page.page_width-160):this.workspace.width_pixels=Math.min(.85*this.page.page_width,this.page.page_width-120):isNaN(this.width)?"%"!==this.width.charAt(this.width.length-1)||null===this.page||isNaN(this.width.substring(0,this.width.length-1))?this.page.workspace.errorLog+="Graph width of <"+this.width+"> could not be parsed.\n":this.workspace.width_pixels=.01*parseFloat(this.width.substring(0,this.width.length-1))*this.page.page_width:this.workspace.width_pixels=parseFloat(this.width))},bt.prototype.insertDefaultStyles=function(t){null===t.color&&(t.color=this.page.styling.defaultColors[this.workspace.defaultColorCounter],this.workspace.defaultColorCounter++,this.workspace.defaultColorCounter>=this.page.styling.defaultColors.length-1&&(this.workspace.defaultColorCounter=0)),null===t.lineType&&(t.lineType=this.workspace.defaultLineTypeCounter,this.workspace.defaultLineTypeCounter++),null===t.pointType&&(t.pointType=this.workspace.defaultPointTypeCounter,this.workspace.defaultPointTypeCounter++,this.workspace.defaultPointTypeCounter>=this.page.styling.pointTypes.length-1&&(this.workspace.defaultPointTypeCounter=0))},bt.prototype.project3d=function(t,i,s){var n=this.workspace.width_pixels*(t-.5),t=this.workspace.width_pixels*this.workspace.aspect*(i-.5),i=this.workspace.width_pixels*this.workspace.aspectZ*(s-.5),s=n*Math.cos(this.viewAngleXY*Math.PI/180)+t*Math.sin(this.viewAngleXY*Math.PI/180),n=-n*Math.sin(this.viewAngleXY*Math.PI/180)+t*Math.cos(this.viewAngleXY*Math.PI/180),t=i,i=s,s=n*Math.cos(this.viewAngleYZ*Math.PI/180)+t*Math.sin(this.viewAngleYZ*Math.PI/180),t=-n*Math.sin(this.viewAngleYZ*Math.PI/180)+t*Math.cos(this.viewAngleYZ*Math.PI/180);return{xpos:this.origin[0]+i,ypos:this.origin[1]-t,depth:s}},bt.prototype.projectPoint=function(t,i,s,n,e,o,h){var a=this.workspace.width_pixels,r=this.workspace.width_pixels*this.workspace.aspect,l={xap:n.getPosition(t,!0),yap:e.getPosition(i,!0),zap:.5};this.threeDimensional&&(l.zap=o.getPosition(s,!0));var p={xap:.5,yap:.5,zap:.5,theta_x:0,theta_y:0,theta_z:0};if($.each({x:n,y:e,z:o},function(t,i){i=i.axis_name[0];p[i+"ap"]=l[t+"ap"]}),!isFinite(p.xap)||!isFinite(p.yap)||!isFinite(p.zap))return{xpos:NaN,ypos:NaN,xap:NaN,yap:NaN,zap:NaN};if(!h&&(p.xap<0||1<p.xap||p.yap<0||1<p.yap||p.zap<0||1<p.zap))return{xpos:NaN,ypos:NaN,xap:NaN,yap:NaN,zap:NaN};var u={x:0,y:0,z:0};return this.threeDimensional?(h=this.project3d(p.xap,p.yap,p.zap),p.xpos=h.xpos,p.ypos=h.ypos,p.depth=h.depth,u.x=Math.atan2(Math.cos(this.viewAngleXY*Math.PI/180),-Math.sin(this.viewAngleXY*Math.PI/180)*Math.sin(this.viewAngleYZ*Math.PI/180)),u.y=Math.atan2(Math.sin(this.viewAngleXY*Math.PI/180),Math.cos(this.viewAngleXY*Math.PI/180)*Math.sin(this.viewAngleYZ*Math.PI/180)),u.z=Math.atan2(0,Math.cos(this.viewAngleYZ*Math.PI/180))):(p.xpos=this.origin[0]+a*p.xap,p.ypos=this.origin[1]+r*p.yap,p.depth=0,u.x=Math.PI/2,u.y=Math.PI,u.z=0),$.each({x:n,y:e,z:o},function(t,i){i=i.axis_name[0];isFinite(u[i])&&(p["theta_"+t]=u[i])}),p},bt.prototype.determineWidth=function(t){var s=this;if(this.page=t,this.cleanWorkspace(),this.workspace.plotter=new Nt(t,this),$.each(this.dataSets,function(t,i){i.cleanWorkspace(),i.workspace.styleFinal=i.style.clone(),s.insertDefaultStyles(i.workspace.styleFinal),i.workspace.requiredColumns=s.workspace.plotter.data_columns_required(i.workspace.styleFinal.plotStyle)}),this.widthIncludesAxes){for(var i=this.workspace.width_pixels,n=.2*i,e=i,o=0;o<8;o++){var h=(n+e)/2;this.workspace.width_pixels=h,this.calculateDataRanges(this.page);var a=this.calculateBoundingBox();Math.abs(a.right-a.left)<i?n=h:e=h}this.workspace.width_pixels=n}},bt.prototype.calculateDataRanges=function(){var t,i,e=this;if(this.workspace.axis_length=[this.workspace.width_pixels,Math.abs(this.workspace.width_pixels*this.workspace.aspect),Math.abs(this.workspace.width_pixels*this.workspace.aspectZ)],this.workspace.axis_bearing=[0<this.workspace.width_pixels?Math.PI/2:3*Math.PI/2,0<this.workspace.width_pixels*this.workspace.aspect?0:Math.PI,0],this.threeDimensional)for(t=0;t<3;t++){var s=this.project3d(0===t?0:.5,1===t?0:.5,2===t?0:.5),n=this.project3d(0===t?1:.5,1===t?1:.5,2===t?1:.5);this.workspace.axis_length[t]=Math.hypot(n.xpos-s.xpos,n.ypos-s.ypos),this.workspace.axis_bearing[t]=Math.atan2(n.xpos-s.xpos,n.ypos-s.ypos),isFinite(this.workspace.axis_length[t])||(this.workspace.axis_length[t]=0),isFinite(this.workspace.axis_bearing[t])||(this.workspace.axis_bearing[t]=0)}for(t=0;t<3;t++)for(var o=this.workspace.axis_length[t]/(50+50*Math.abs(Math.sin(this.workspace.axis_bearing[t]))),h=this.workspace.axis_length[t]/20,a=0;a<2;a++){var r=["x","y","z"][t]+(a+1);this.axes[r].cleanWorkspace(),this.axes[r].workspace.target_number_major_ticks=o,this.axes[r].workspace.target_number_minor_ticks=h}for(t=0;t<3;t++)for(a=0;a<2;a++)i=["x","y","z"][t]+(a+1),this.axes[i].linkedAxisForwardPropagate(e.page,0);$.each(this.dataSets,function(t,i){var s=i.axes[1],n=e.axes[s],s=n.workspace.minHard,n=n.workspace.maxHard;null!==s&&null!==n&&i.axisRangeUpdated(s,n),$.each(i.axes,function(t,i){e.axes[i].workspace.activeFinal=!0}),e.workspace.plotter.update_axis_usage(i,i.workspace.styleFinal.plotStyle,e.axes[i.axes[1]],e.axes[i.axes[2]],e.axes[i.axes[3]]),e.axes[i.axes[1]].linkedAxisBackPropagate(e.page),e.axes[i.axes[2]].linkedAxisBackPropagate(e.page),e.axes[i.axes[3]].linkedAxisBackPropagate(e.page)}),$.each(this.axes,function(t,i){i.workspace.rangeFinalised||i.linkedAxisForwardPropagate(e.page,1),null===i.workspace.tickListFinal&&i.ticking_allocator.process()})},bt.prototype.calculateBoundingBox=function(){for(var t,i=new JSPlot_BoundingBox,s=Math.max(60,this.axes.y1.workspace.max_tick_label_width+20+(null!==this.axes.y1.label?20:0)),n=Math.max(20,this.axes.y2.workspace.max_tick_label_width+20+(null!==this.axes.y2.label?20:0)),e=Math.max(60,this.axes.x1.workspace.max_tick_label_width+20+(null!==this.axes.x1.label?20:0)),o=Math.max(20,this.axes.x2.workspace.max_tick_label_width+20+(null!==this.axes.x2.label?20:0)),h=null,a=0;a<=1;a+=1)for(var r=0;r<=1;r+=1)for(var l=0;l<=1;l+=1)h=this.threeDimensional?this.project3d(a,r,l):{xpos:this.origin[0]+a*this.workspace.width_pixels,ypos:this.origin[1]+r*this.workspace.width_pixels*this.workspace.aspect},i.includePoint(h.xpos-s,h.ypos-o),i.includePoint(h.xpos+n,h.ypos+e);return this.threeDimensional&&"rotate"===this.interactiveMode&&(t=Math.max(this.workspace.width_pixels,Math.abs(this.workspace.width_pixels*this.workspace.aspect),Math.abs(this.workspace.width_pixels*this.workspace.aspectZ))*Math.sqrt(3)/2,i.includePoint(this.origin[0]-t-s,this.origin[1]-t-o),i.includePoint(this.origin[0]+t+n,this.origin[1]+t+e)),this.graph_bounding_box=i.copy(),this.legend_renderer=new kt(this.page,this),this.legend_renderer.calculateLayout(),i.includeBox(this.legend_renderer.boundingBox()),null!==this.title&&""!==this.title&&this.textColor.isVisible()&&(t=this.page.constants.LEGEND_fontSize*this.fontSize*2,i.includePoint((this.graph_bounding_box.left+this.graph_bounding_box.right)/2,this.graph_bounding_box.top-this.titleVerticalOffset-t)),i},bt.prototype.render=function(){var s=this,t=[this.workspace.width_pixels,this.workspace.width_pixels*this.workspace.aspect,this.workspace.width_pixels*this.workspace.aspectZ],i=new JSPlot_BoundingBox;if(this.grid_lines_paint(),this.axes_paint(!1,i),this.clip)if(this.threeDimensional){for(var n=[],e=0;e<8;e++){var o=at(0!=(1&e)),h=at(0!=(2&e)),a=at(0!=(4&e)),a=this.project3d(o,h,a);n.push([a.xpos-this.origin[0],a.ypos-this.origin[1]])}for(n.sort(function(t,i){return Math.hypot(t[0],t[1])-Math.hypot(i[0],i[1])}),n.shift(),n.shift(),n.sort(function(t,i){return Math.atan2(t[0],t[1])-Math.atan2(i[0],i[1])}),s.page.canvas.Fi(),s.page.canvas.Li(n[0][0]+s.origin[0],n[0][1]+s.origin[1]),e=1;e<n.length;e++)s.page.canvas.Oi(n[e][0]+s.origin[0],n[e][1]+s.origin[1]);s.page.canvas.So()}else s.page.canvas.Fi(),s.page.canvas.Li(s.origin[0],s.origin[1]),s.page.canvas.Oi(s.origin[0]+t[0],s.origin[1]),s.page.canvas.Oi(s.origin[0]+t[0],s.origin[1]+t[1]),s.page.canvas.Oi(s.origin[0],s.origin[1]+t[1]),s.page.canvas.So();s.threeDimensional&&s.page.threeDimensionalBuffer.activate(),$.each(this.dataSets,function(t,i){s.workspace.plotter.renderDataSet(s,i,i.workspace.styleFinal.plotStyle,i.axes[1],i.axes[2],i.axes[3])}),s.render_annotations(),s.page.threeDimensionalBuffer.deactivate(),s.clip&&s.page.canvas.Eo(),this.axes_paint(!0,i),s.legend_renderer.render(),null!==s.title&&""!==s.title&&s.textColor.isVisible()&&(s.page.canvas.Ds(s.textColor.toHTML()),s.page.canvas.Dn(s.page.constants.LEGEND_fontFamily,s.page.constants.LEGEND_fontSize*s.fontSize*2,s.page.constants.LEGEND_fontWeight,s.page.constants.LEGEND_fontStyle),s.page.canvas.Ts(s.origin[0]+t[0]/2,i.top-s.titleVerticalOffset,0,1,1,s.title,0,0))},bt.prototype.render_annotations=function(){var s=this,n=[];$.each(this.annotations,function(t,i){n.push([i.fetch_z_index(s),i])}),n.sort(function(t,i){return i[0]-t[0]}),$.each(n,function(t,i){i[1].render(s)})},bt.prototype.axes_paint=function(p,u){var c,d,t,f,y,g=this;function M(t,h,a,r,i,l){$.each(t,function(t,i){var s=h[i][0],n=h[i][1],i=(s.depth+n.depth)/2;if(!g.threeDimensional||p===0<i){for(var i=Math.atan2((s.xpos+n.xpos)/2-f,(s.ypos+n.ypos)/2-y)-g.workspace.axis_bearing[a],i=0<Math.sin(i),e=[],o=0;o<3;o++)2===o&&!g.threeDimensional||a===o||e.push(g.workspace.axis_bearing[o]+(0<s.axis_pos[o]?Math.PI:0));r.render(g.page,i,s.xpos,s.ypos,s.depth,n.xpos,n.ypos,n.depth,e,l&&0===t)}})}(this.threeDimensional||p)&&(c=(y=f=0)<this.workspace.width_pixels?1:-1,d=0<this.workspace.width_pixels*this.workspace.aspect?1:-1,y=this.threeDimensional?(t=this.project3d(.5,.5,.5),f=t.xpos,t.ypos):(f=this.origin[0]+this.workspace.axis_length[0]/2*c,this.origin[1]+this.workspace.axis_length[1]/2*d),$.each(this.axes,function(t,i){i.workspace.crossedAtZero=!1,"1"===t[1]&&("x"!==t[0]&&g.axes.x1.atZero&&(i.workspace.crossedAtZero=!0),"y"!==t[0]&&g.axes.y1.atZero&&(i.workspace.crossedAtZero=!0),"z"!==t[0]&&g.axes.z1.atZero&&(i.workspace.crossedAtZero=!0))}),$.each(["x","y","z"],function(s,n){if("z"!==n||g.threeDimensional){for(var t,i,e={},o=0;o<=1;o+=1)for(var h=0;h<=1;h+=1)for(var a=0;a<=1;a+=1){var r=g.threeDimensional?g.project3d(o,h,a):{xpos:g.origin[0]+o*g.workspace.axis_length[0]*c,ypos:g.origin[1]+h*g.workspace.axis_length[1]*d,depth:0};r.axis_pos=[o,h,a];var l="";"x"!==n&&(l+=o.toString()),"y"!==n&&(l+=h.toString()),"z"!==n&&(l+=a.toString()),e.hasOwnProperty(l)||(e[l]=[]),e[l].push(r),u.includePoint(r.xpos,r.ypos)}$.each(g.axes,function(t,i){t[0]===n&&i.enabled&&i.visible&&(i.workspace.atZero||M("1"===t[1]?g.threeDimensional?["00","01"]:["00"]:g.threeDimensional?["10","11"]:["10"],e,s,i,0,!0))}),g.axes[n+"1"].mirror||g.axes[n+"2"].enabled||(t=g.threeDimensional?["10","11"]:["10"],i=g.axes[n+"1"],M(t,e,s,i,0,!1))}}))},bt.prototype.grid_lines_paint=function(){var t,i,s,n,r=this,l=[0,0,0];this.threeDimensional&&(t=r.project3d(.5,.5,.5),i=r.project3d(1,.5,.5),s=r.project3d(.5,1,.5),n=r.project3d(.5,.5,1),l[0]=at(t.depth>i.depth),l[1]=at(t.depth>s.depth),l[2]=at(t.depth>n.depth)),$.each(r.gridAxes,function(t,h){var a=r.axes[h];("z"!==h.charAt(0)||r.threeDimensional)&&a.workspace.activeFinal&&null!==a.workspace.tickListFinal&&$.each(["major","minor"],function(t,i){"major"===i?r.page.canvas.Ai(r.gridMajorColor.toHTML(),r.page.constants.GRID_MAJLINEWIDTH):r.page.canvas.Ai(r.gridMinorColor.toHTML(),r.page.constants.GRID_MINLINEWIDTH);i=a.workspace.tickListFinal[i];$.each(i,function(t,i){var s,n,e,o=a.getPosition(i[0],!0);o<.001||.999<o||(r.page.canvas.Fi(),r.threeDimensional?(n=[[1,2],[0,2],[0,1]][s={x:0,y:1,z:2}[h.substr(0,1)]],e=null,(i=[0,0,0])[s]=o,i[n[0]]=l[n[0]],i[n[1]]=0,e=r.project3d(i[0],i[1],i[2]),r.page.canvas.Li(e.xpos,e.ypos),i[n[1]]=1,e=r.project3d(i[0],i[1],i[2]),r.page.canvas.Oi(e.xpos,e.ypos),i[n[1]]=l[n[1]],i[n[0]]=0,e=r.project3d(i[0],i[1],i[2]),r.page.canvas.Li(e.xpos,e.ypos),i[n[0]]=1,e=r.project3d(i[0],i[1],i[2]),r.page.canvas.Oi(e.xpos,e.ypos)):"x"===h.charAt(0)?(r.page.canvas.Li(r.origin[0]+o*r.workspace.width_pixels,r.origin[1]),r.page.canvas.Oi(r.origin[0]+o*r.workspace.width_pixels,r.origin[1]+r.workspace.width_pixels*r.workspace.aspect)):(r.page.canvas.Li(r.origin[0],r.origin[1]+o*r.workspace.width_pixels*r.workspace.aspect),r.page.canvas.Oi(r.origin[0]+r.workspace.width_pixels,r.origin[1]+o*r.workspace.width_pixels*r.workspace.aspect)),r.page.canvas.Di())})})})},bt.prototype.interactive_scroll=function(s,n){var e=this;"pan"===this.interactiveMode?($.each(this.axes,function(t,i){t=t.substring(0,1);"x"===t&&i.interactive_scroll(e.page,s/e.workspace.axis_length[0],!1),"y"===t&&i.interactive_scroll(e.page,n/e.workspace.axis_length[1],!1)}),this.page.needs_refresh=!0):"rotate"===this.interactiveMode&&(this.viewAngleXY+=180*s/this.workspace.width_pixels,this.viewAngleYZ+=180*n/this.workspace.width_pixels,90<this.viewAngleYZ&&(this.viewAngleYZ=90),this.viewAngleYZ<-90&&(this.viewAngleYZ=-90),this.viewAngleXY<0&&(this.viewAngleXY+=360),360<this.viewAngleXY&&(this.viewAngleXY-=360),this.page.needs_refresh=!0)},bt.prototype.interactive_zoom=function(s){var n=this,e=!1;return $.each(this.axes,function(t,i){e|=i.interactive_zoom(n.page,s)}),e},wt.prototype.findCrossingPoints=function(u,c,d,t,i,s,f,y,g,n,e,o){var h=0<=t&&t<=1&&0<=i&&i<=1&&0<=s&&s<=1,a=0<=n&&n<=1&&0<=e&&e<=1&&0<=o&&o<=1,M={cx1:u,cy1:c,cz1:d,cx2:f,cy2:y,cz2:g,inside1_initial:h,inside2_initial:a,inside1_final:h,inside2_final:a};if(M.inside1&&M.inside2)return M;function r(t,i,s,n){if(i[s]!==t[s]){var e=(n-t[s])/(i[s]-t[s]);if(0<=e&&e<=1){for(var o=[0,0,0],h=!0,a=0;a<3;a++){var r=t[a]+(i[a]-t[a])*e,l=[u,c,d][a],p=[f,y,g][a];o[a]=l+(p-l)*e,a!==s&&(r<0||1<r)&&(h=!1)}h&&((n<.5&&t[s]<0||.5<n&&1<t[s])&&(M.cx1=o[0],M.cy1=o[1],M.cz1=o[2],M.inside1_final=!0),(n<.5&&i[s]<0||.5<n&&1<i[s])&&(M.cx2=o[0],M.cy2=o[1],M.cz2=o[2],M.inside2_final=!0))}}}for(var l=0;l<3;l++)r([t,i,s],[n,e,o],l,0),r([t,i,s],[n,e,o],l,1);return M},wt.prototype.point=function(t,i,s,n,e,o,h,a,r){var l=this,p=this.graph.projectPoint(t,i,s,this.axis_x,this.axis_y,this.axis_z,!0);isFinite(p.xpos)&&isFinite(p.ypos)&&isFinite(p.depth)?(h={position:p,x_offset:n,y_offset:e,z_offset:o,x_perp_offset:h,y_perp_offset:a,z_perp_offset:r},null!==this.pt_old&&(a=function(t,i,s,n){i+=t.x_offset*Math.cos(p.theta_x)+t.y_offset*Math.cos(p.theta_y)+t.z_offset*Math.cos(p.theta_z)+t.x_perp_offset*Math.cos(p.theta_x+Math.PI/2)+t.y_perp_offset*Math.cos(p.theta_y+Math.PI/2)+t.z_perp_offset*Math.cos(p.theta_z+Math.PI/2),t=s+(t.x_offset*Math.sin(p.theta_x)+t.y_offset*Math.sin(p.theta_y)+t.z_offset*Math.sin(p.theta_z)+t.x_perp_offset*Math.sin(p.theta_x+Math.PI/2)+t.y_perp_offset*Math.sin(p.theta_y+Math.PI/2)+t.z_perp_offset*Math.sin(p.theta_z+Math.PI/2));l.point_list_in_progress.push([i,t,n])},(r=this.findCrossingPoints(this.pt_old.position.xpos,this.pt_old.position.ypos,this.pt_old.position.depth,this.pt_old.position.xap,this.pt_old.position.yap,this.pt_old.position.zap,p.xpos,p.ypos,p.depth,p.xap,p.yap,p.zap)).inside1_final&&r.inside2_final&&(0===this.point_list_in_progress.length&&a(this.pt_old,r.cx1,r.cy1,r.cz1),a(h,r.cx2,r.cy2,r.cz2))),this.pt_old=h):this.penUp()},wt.prototype.penUp=function(){this.pt_old=null,1<this.point_list_in_progress.length&&this.line_list.push(this.point_list_in_progress),this.point_list_in_progress=[]},wt.prototype.renderLine=function(){var t,i,s=this;if(this.page.threeDimensionalBuffer.active)for(t=0;t<this.line_list.length;t++)for(i=1;i<this.line_list[t].length;i++){var n=s.line_list[t][i][2],e=function(t,i){return function(){s.page.canvas.Ai(s.color,s.line_width),s.page.canvas.Fi(),s.page.canvas.Li(s.line_list[t][i-1][0],s.line_list[t][i-1][1]),s.page.canvas.Oi(s.line_list[t][i][0],s.line_list[t][i][1]),s.page.canvas.Di()}}(t,i);this.page.threeDimensionalBuffer.addItem(n,e)}else{for(s.page.canvas.Ai(this.color,this.line_width),s.page.canvas.Fi(),t=0;t<this.line_list.length;t++)for(s.page.canvas.Li(this.line_list[t][0][0],this.line_list[t][0][1]),i=1;i<this.line_list[t].length;i++)s.page.canvas.Oi(this.line_list[t][i][0],this.line_list[t][i][1]);s.page.canvas.Di()}},$t.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"axis_x":s.axis_x=i;break;case"axis_y":s.axis_y=i;break;case"axis_z":s.axis_z=i;break;case"color":s.color=i;break;case"fontSize":s.fontSize=i;break;case"fontFamily":s.fontFamily=i;break;case"fontStyle":s.fontStyle=i;break;case"fontWeight":s.fontWeight=i;break;case"h_align":s.h_align=i;break;case"position":s.position=i;break;case"text":s.text=i;break;case"v_align":s.v_align=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised text item setting "+t}})},$t.prototype.render=function(t){var i,s,n=t.page;null!==this.color&&(i=0,"left"===this.h_align&&(i=-1),"right"===this.h_align&&(i=1),s=0,"top"===this.v_align&&(s=1),"bottom"===this.v_align&&(s=-1),t=t.projectPoint(this.position[0],this.position[1],t.threeDimensional?this.position[2]:0,this.axis_x,this.axis_y,this.axis_z,!0),n.canvas.Dn(this.fontFamily,this.fontSize,this.fontWeight,this.fontStyle),n.canvas.Ds(this.color.toHTML()),n.canvas.Ts(t.xpos,t.ypos,i,s,!0,this.text,!1,!1))},$t.prototype.fetch_z_index=function(t){t.page;return t.threeDimensional?-t.projectPoint(this.position[0],this.position[1],this.position[2],this.axis_x,this.axis_y,this.axis_z,!0)[2]:this.z_index},Pt.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"axis_x":s.axis_x=i;break;case"axis_y":s.axis_y=i;break;case"axis_z":s.axis_z=i;break;case"arrowType":s.arrowType=i;break;case"color":s.color=i;break;case"strokeLineWidth":s.strokeLineWidth=i;break;case"origin":s.origin=i;break;case"target":s.target=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised arrow setting "+t}})},Pt.prototype.render=function(t){var i,s=t.page;null!==this.color&&(i=t.projectPoint(this.origin[0],this.origin[1],t.threeDimensional?this.origin[2]:0,this.axis_x,this.axis_y,this.axis_z,!0),t=t.projectPoint(this.target[0],this.target[1],t.threeDimensional?this.target[2]:0,this.axis_x,this.axis_y,this.axis_z,!0),(new vt).primitive_arrow(s,this.arrowType,i.xpos,i.ypos,i.zpos,t.xpos,t.ypos,t.zpos,this.color,this.strokeLineWidth,1))},Pt.prototype.fetch_z_index=function(t){if(t.threeDimensional){var i=t.projectPoint(this.origin[0],this.origin[1],this.origin[2],this.axis_x,this.axis_y,this.axis_z,!0),t=t.projectPoint(this.target[0],this.target[1],this.target[2],this.axis_x,this.axis_y,this.axis_z,!0);return-(i[2]+t[2])/2}return this.z_index},kt.prototype.arrangeToHeight=function(e){function o(){h.push({x_offset:r,column_height:0,item_count:0,column_width:0}),a=0,l=h.length-1}var h=[],a=0,r=0,l=0,p=0;return o(),$.each(this.legend_items,function(t,i){var s=i.width,n=i.height;a+n<=e||o(),i.column=l,i.x_offset=h[l].x_offset,i.y_offset=a,p<(a+=n)&&(p=a),h[l].column_height=a,h[l].item_count+=1,h[l].column_width=Math.max(h[l].column_width,s),r=h[l].x_offset+h[l].column_width}),{columns:h,height:p,width:r}},kt.prototype.calculateLayout=function(){var s,o=this;if(this.graph.key){var t=Math.abs(o.graph.workspace.width_pixels-2*o.page.constants.LEGEND_margin),i=Math.abs(o.graph.workspace.width_pixels*o.graph.workspace.aspect)-2*o.page.constants.LEGEND_margin;this.page.canvas.Dn(this.page.constants.LEGEND_fontFamily,this.page.constants.LEGEND_fontSize*this.graph.fontSize,this.page.constants.LEGEND_fontWeight,this.page.constants.LEGEND_fontStyle),this.page.canvas.Ds(this.page.constants.LEGEND_color.toHTML()),o.legend_items=[];var h=0,a=0;$.each(o.graph.dataSets,function(t,i){var s,n,e=i.title;"string"==typeof e&&0<e.length&&(s=o.page.canvas.Ao(e)+o.page.constants.LEGEND_horizontal_spacing,n=o.page.constants.LEGEND_fontSize+o.page.constants.LEGEND_vertical_spacing,h+=n,(0===a||n<a)&&(a=n),o.legend_items.push({key_name:t,dataset:i,text:e,height:n,width:s}))});var n,e,r,l=null,p=0,u=0,c=!1,d=!1;if("number"==typeof o.graph.keyColumns&&0<o.graph.keyColumns)for(p=h+2;a<p&&!((l=o.arrangeToHeight(p)).columns.length>o.graph.keyColumns)&&!(l.height>p);)u=p,p=l.height-1;else if("above"===o.graph.keyPosition||"below"===o.graph.keyPosition)for(c=!0,p=h+2;a<p&&!((l=o.arrangeToHeight(p)).width>t)&&!(l.height>p);)u=p,p=l.height-1;else d=!0,u=i;if(p=(l=o.arrangeToHeight(u)).height,d){for(p=i,s=0;s<l.columns.length;s++)if(n=p-l.columns[s].column_height,e=n/(l.columns[s].item_count-1),l.columns[s].item_count<2||e>o.page.constants.LEGEND_MAX_VGAP){p=l.height;break}for(s=0;s<l.columns.length;s++){l.columns[s].item_count<2||(n=p-l.columns[s].column_height,e=n/(l.columns[s].item_count-1),r=0,e>o.page.constants.LEGEND_MAX_VGAP||($.each(o.graph.dataSets,function(t,i){i.column===s&&(i.y_offset+=r,r+=e)}),l.height=p))}}c&&1<l.columns.length&&(n=t-l.width,(e=n/(l.columns.length-1))<=o.page.constants.LEGEND_MAX_HGAP&&($.each(o.graph.dataSets,function(t,i){i.x_offset+=e*i.column}),l.width=t));d=0,c=0;if(o.graph.threeDimensional)switch(o.graph.keyPosition){case"tr":d=o.graph.graph_bounding_box.right-o.page.constants.LEGEND_margin-l.width,c=o.graph.graph_bounding_box.top+o.page.constants.LEGEND_margin;break;case"tm":d=(o.graph.graph_bounding_box.left+o.graph.graph_bounding_box.right)/2-l.width/2,c=o.graph.graph_bounding_box.top+o.page.constants.LEGEND_margin;break;case"tl":d=o.graph.graph_bounding_box.left+o.page.constants.LEGEND_margin,c=o.graph.graph_bounding_box.top+o.page.constants.LEGEND_margin;break;case"mr":d=o.graph.graph_bounding_box.right-o.page.constants.LEGEND_margin-l.width,c=(o.graph.graph_bounding_box.top+o.graph.graph_bounding_box.bottom)/2-l.height/2;break;case"mm":d=(o.graph.graph_bounding_box.left+o.graph.graph_bounding_box.right)/2-l.width/2,c=(o.graph.graph_bounding_box.top+o.graph.graph_bounding_box.bottom)/2-l.height/2;break;case"ml":d=o.graph.graph_bounding_box.left+o.page.constants.LEGEND_margin,c=(o.graph.graph_bounding_box.top+o.graph.graph_bounding_box.bottom)/2-l.height/2;break;case"br":d=o.graph.graph_bounding_box.right-o.page.constants.LEGEND_margin-l.width,c=o.graph.graph_bounding_box.bottom-o.page.constants.LEGEND_margin-l.height;break;case"bm":d=(o.graph.graph_bounding_box.left+o.graph.graph_bounding_box.right)/2-l.width/2,c=o.graph.graph_bounding_box.bottom-o.page.constants.LEGEND_margin-l.height;break;case"bl":d=o.graph.graph_bounding_box.left+o.page.constants.LEGEND_margin,c=o.graph.graph_bounding_box.bottom-o.page.constants.LEGEND_margin-l.height;break;case"below":d=(o.graph.graph_bounding_box.left+o.graph.graph_bounding_box.right)/2-l.width/2,c=o.graph.graph_bounding_box.bottom+o.page.constants.LEGEND_margin+60;break;case"above":d=(o.graph.graph_bounding_box.left+o.graph.graph_bounding_box.right)/2-l.width/2,c=o.graph.graph_bounding_box.top-2*o.page.constants.LEGEND_margin-60-l.height;break;case"right":d=2*o.page.constants.LEGEND_margin+t+60,c=(o.graph.graph_bounding_box.top+o.graph.graph_bounding_box.bottom)/2-l.height/2;break;case"left":d=-o.page.constants.LEGEND_margin-60-l.width,c=(o.graph.graph_bounding_box.top+o.graph.graph_bounding_box.bottom)/2-l.height/2}else{switch(o.graph.keyPosition){case"tr":d=o.page.constants.LEGEND_margin+t-l.width,c=-(o.page.constants.LEGEND_margin+i);break;case"tm":d=o.page.constants.LEGEND_margin+t/2-l.width/2,c=-(o.page.constants.LEGEND_margin+i);break;case"tl":d=o.page.constants.LEGEND_margin,c=-(o.page.constants.LEGEND_margin+i);break;case"mr":d=o.page.constants.LEGEND_margin+t-l.width,c=-(o.page.constants.LEGEND_margin+i/2+l.height/2);break;case"mm":d=o.page.constants.LEGEND_margin+t/2-l.width/2,c=-(o.page.constants.LEGEND_margin+i/2+l.height/2);break;case"ml":d=o.page.constants.LEGEND_margin,c=-(o.page.constants.LEGEND_margin+i/2+l.height/2);break;case"br":d=o.page.constants.LEGEND_margin+t-l.width,c=-(o.page.constants.LEGEND_margin+l.height);break;case"bm":d=o.page.constants.LEGEND_margin+t/2-l.width/2,c=-(o.page.constants.LEGEND_margin+l.height);break;case"bl":d=o.page.constants.LEGEND_margin,c=-(o.page.constants.LEGEND_margin+l.height);break;case"below":d=o.page.constants.LEGEND_margin+t/2-l.width/2,c=-(-o.page.constants.LEGEND_margin-60);break;case"above":d=o.page.constants.LEGEND_margin+t/2-l.width/2,c=-(2*o.page.constants.LEGEND_margin+i+60+l.height);break;case"right":d=2*o.page.constants.LEGEND_margin+t+60,c=-(o.page.constants.LEGEND_margin+i/2+l.height/2);break;case"left":d=-o.page.constants.LEGEND_margin-60-l.width,c=-(o.page.constants.LEGEND_margin+i/2+l.height/2)}d+=o.graph.origin[0],c+=o.graph.origin[1]}o.x_offset=d,o.y_offset=c,o.column_arrangement=l,o.bounding_box=new JSPlot_BoundingBox,o.bounding_box.includePoint(d-5,c-12),o.bounding_box.includePoint(d+l.width,c+l.height)}},kt.prototype.boundingBox=function(){return this.bounding_box},kt.prototype.render=function(){var l=this;this.graph.key&&(null===this.x_offset&&this.calculateLayout(),$.each(l.legend_items,function(t,i){var s,n,e,o=i.dataset.workspace.styleFinal,h=o.plotStyle,a=l.x_offset+i.x_offset,r=l.y_offset+i.y_offset;l.page.canvas.Dn(l.page.constants.LEGEND_fontFamily,l.page.constants.LEGEND_fontSize*l.graph.fontSize,l.page.constants.LEGEND_fontWeight,l.page.constants.LEGEND_fontStyle),l.page.canvas.Ds(l.page.constants.LEGEND_color.toHTML()),l.page.canvas.Ts(a+24,r,-1,0,!0,i.text,!1,!1),"lines"!==h&&"linespoints"!==h&&"impulses"!==h&&"steps"!==h&&"fsteps"!==h&&"histeps"!==h||(l.page.canvas.Ai(o.color.toHTML(),1),l.page.canvas.Fi(),l.page.canvas.Li(a,r),l.page.canvas.Oi(a+18,r),l.page.canvas.Di()),"boxes"!==h&&"wboxes"!==h&&"surface"!==h||(l.page.canvas.Ai(o.color.toHTML(),1),l.page.canvas.Ds(o.fillColor.toHTML()),l.page.canvas.Fi(),l.page.canvas.hn(a+2,r-7,14,14),l.page.canvas.Us(),l.page.canvas.Di()),"points"===h||"linespoints"===h||"dots"===h?(s=o.pointType%l.page.styling.pointTypes.length,i=o.pointSize,e=1,"dots"===h&&(s=1,e=.25),(0,l.page.styling.pointTypes[s])(a+9,r,i*e,1,o.color.toHTML())):"lowerlimits"===h||"upperlimits"===h?(n=new vt,l.page.canvas.Ai(o.color.toHTML(),1),"upperlimits"===h?(l.page.canvas.Fi(),l.page.canvas.Li(a,r-6),l.page.canvas.Oi(a+18,r-6),l.page.canvas.Di(),n.primitive_arrow(l.page,"single",a+9,r-6,0,a+9,r+6,0,o.color,1.4,1)):(l.page.canvas.Fi(),l.page.canvas.Li(a,r+6),l.page.canvas.Oi(a+18,r+6),l.page.canvas.Di(),n.primitive_arrow(l.page,"single",a+9,r+6,0,a+9,r-6,0,o.color,1.4,1))):"arrows_head"===h||"arrows_twohead"===h||"arrows_nohead"===h?(e="arrows_head"===h?"single":"arrows_twohead"===h?"double":"none",(n=new vt).primitive_arrow(l.page,e,a,r,0,a+18,r,0,o.color,1.4,1)):"xerrorbars"!==h&&"yerrorbars"!==h&&"zerrorbars"!==h&&"xerrorrange"!==h&&"yerrorrange"!==h&&"zerrorrange"!==h&&"xyerrorbars"!==h&&"xzerrorbars"!==h&&"yzerrorbars"!==h&&"xyerrorrange"!==h&&"xzerrorrange"!==h&&"yzerrorrange"!==h&&"xyzerrorbars"!==h&&"xyzerrorrange"!==h||(l.page.canvas.Ai(o.color.toHTML(),1),l.page.canvas.Fi(),l.page.canvas.Li(a,r),l.page.canvas.Oi(a+18,r),l.page.canvas.Li(a,r-5),l.page.canvas.Oi(a,r+5),l.page.canvas.Li(a+9,r-3),l.page.canvas.Oi(a+9,r+3),l.page.canvas.Li(a+18,r-5),l.page.canvas.Oi(a+18,r+5),l.page.canvas.Di())}))},zt.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"color":s.color=i;break;case"fillColor":s.fillColor=i;break;case"plotStyle":s.plotStyle=i;break;case"lineType":s.lineType=i;break;case"pointType":s.pointType=i;break;case"lineWidth":s.lineWidth=i;break;case"pointLineWidth":s.pointLineWidth=i;break;case"pointSize":s.pointSize=i;break;default:throw"Unrecognised plot style setting "+t}})},zt.prototype.clone=function(){var t=new zt({});return null===this.color?t.color=this.color:t.color=new Mt(this.color.red,this.color.green,this.color.blue,this.color.alpha),null===this.fillColor?t.fillColor=this.fillColor:t.fillColor=new Mt(this.fillColor.red,this.fillColor.green,this.fillColor.blue,this.fillColor.alpha),t.plotStyle=this.plotStyle,t.lineType=this.lineType,t.pointType=this.pointType,t.lineWidth=this.lineWidth,t.pointLineWidth=this.pointLineWidth,t.pointSize=this.pointSize,t},Nt.prototype.data_columns_required=function(t){var i=this.graph.threeDimensional;return"points"===t||"lines"===t||"linespoints"===t?2+(i?1:0):"xerrorbars"===t||"yerrorbars"===t?3+(i?1:0):"zerrorbars"===t?4:"xyerrorbars"===t?4+(i?1:0):"xzerrorbars"===t||"yzerrorbars"===t?5:"xyzerrorbars"===t?6:"xerrorrange"===t||"yerrorrange"===t?4+(i?1:0):"zerrorrange"===t?5:"xyerrorrange"===t?6+(i?1:0):"xzerrorrange"===t||"yzerrorrange"===t?7:"xyzerrorrange"===t?9:"upperlimits"===t||"lowerlimits"===t||"dots"===t||"impulses"===t?2+(i?1:0):"boxes"===t?2:"wboxes"===t?3:"steps"===t||"fsteps"===t||"histeps"===t?2:"arrows_head"===t||"arrows_nohead"===t||"arrows_twohead"===t?4+2*(i?1:0):"surface"===t?3:(this.page.workspace.errorLog+="Unrecognised style type passed to <data_columns_required>\n",-1)},Nt.prototype.update_axis_usage=function(t,s,n,e,o){var h=this,a=this.graph.threeDimensional;if(n.enabled=e.enabled=o.enabled=!0,"boxes"!==s&&"impulses"!==s||null===this.graph.boxFrom||e.includePoint(this.graph.boxFrom),"boxes"===s||"steps"===s||"fsteps"===s||"histeps"===s)if("boxes"===s&&null!==this.graph.boxWidth)$.each(t.data,function(t,i){n.inRange(i[0])&&e.inRange(i[1])&&(n.logarithmic?(n.includePoint(i[0]/Math.sqrt(h.graph.boxWidth)),n.includePoint(i[0]*Math.sqrt(h.graph.boxWidth))):(n.includePoint(i[0]-h.graph.boxWidth/2),n.includePoint(i[0]+h.graph.boxWidth/2)),e.includePoint(i[1]))});else for(var i=0;i<t.data.length;i++){var r=null,l=null;0<i&&(r="boxes"===s||"histeps"===s?n.logarithmic?Math.sqrt(t.data[i][0]/t.data[i-1][0]):(t.data[i][0]-t.data[i-1][0])/2:"steps"===s?n.logarithmic?t.data[i][0]/t.data[i-1][0]:t.data[i][0]-t.data[i-1][0]:n.logarithmic?1:0),i<t.data.length-1&&(l="boxes"===s||"histeps"===s?n.logarithmic?Math.sqrt(t.data[i+1][0]/t.data[i][0]):(t.data[i+1][0]-t.data[i][0])/2:"steps"===s?n.logarithmic?1:0:n.logarithmic?t.data[i+1][0]/t.data[i][0]:t.data[i+1][0]-t.data[i][0]),null===r&&null===l?r=l=.5:null===r?r=l:null===l&&(l=r),n.logarithmic?(n.includePoint(t.data[i][0]/r),n.includePoint(t.data[i][0]*l)):(n.includePoint(t.data[i][0]-r),n.includePoint(t.data[i][0]+l)),e.includePoint(t.data[i][1])}return $.each(t.data,function(t,i){"points"===s||"lines"===s||"linespoints"===s||"lowerlimits"===s||"upperlimits"===s||"dots"===s||"surface"===s?n.inRange(i[0])&&e.inRange(i[1])&&(!a||o.inRange(i[2]))&&(n.includePoint(i[0]),e.includePoint(i[1]),a&&o.includePoint(i[2])):"xerrorbars"===s?e.inRange(i[1])&&!a&&o.inRange(i[2])&&(n.inRange(i[0]-i[2+a])||n.inRange(i[0])||n.inRange(i[0]+i[2+a]))&&(n.includePoint(i[0]),n.includePoint(i[0]-i[2+a]),n.includePoint(i[0]+i[2+a]),e.includePoint(i[1]),a&&o.includePoint(i[2])):"yerrorbars"===s?n.inRange(i[0])&&!a&&o.inRange(i[2])&&(e.inRange(i[1]-i[2+a])||e.inRange(i[1])||e.inRange(i[1]+i[2+a]))&&(n.includePoint(i[0]),e.includePoint(i[1]),e.includePoint(i[1]-i[2+a]),e.includePoint(i[1]+i[2+a]),a&&o.includePoint(i[2])):"zerrorbars"===s?n.inRange(i[0])&&e.inRange(i[1])&&(o.inRange(i[2])||o.inRange(i[2]-i[3])||o.inRange(i[2]+i[3]))&&(n.includePoint(i[0]),e.includePoint(i[1]),o.includePoint(i[2]),o.includePoint(i[2]-i[3]),o.includePoint(i[2]+i[3])):"xyerrorbars"===s?a&&!o.inRange(i[2])||!(n.inRange(i[0])&&e.inRange(i[1]-i[3+a])||n.inRange(i[0])&&e.inRange(i[1])||n.inRange(i[0])&&e.inRange(i[1]+i[3+a])||n.inRange(i[0]-i[2+a])&&e.inRange(i[1])||n.inRange(i[0]+i[2+a])&&e.inRange(i[1]))||(n.includePoint(i[0]),n.includePoint(i[0]-i[2+a]),n.includePoint(i[0]+i[2+a]),e.includePoint(i[1]),e.includePoint(i[1]-i[3+a]),e.includePoint(i[1]+i[3+a]),a&&o.includePoint(i[2])):"xzerrorbars"===s?e.inRange(i[1])&&(n.inRange(i[0])&&o.inRange(i[2]-i[4])||n.inRange(i[0])&&o.inRange(i[2])||n.inRange(i[0])&&o.inRange(i[2]+i[4])||n.inRange(i[0]-i[3])&&o.inRange(i[2])||n.inRange(i[0]+i[3])&&o.inRange(i[2]))&&(n.includePoint(i[0]),n.includePoint(i[0]-i[3]),n.includePoint(i[0]+i[3]),e.includePoint(i[1]),o.includePoint(i[2]),o.includePoint(i[2]-i[4]),o.includePoint(i[2]+i[4])):"yzerrorbars"===s?n.inRange(i[0])&&(e.inRange(i[1])&&o.inRange(i[2]-i[4])||e.inRange(i[1])&&o.inRange(i[2])||e.inRange(i[1])&&o.inRange(i[2]+i[4])||e.inRange(i[1]-i[3])&&o.inRange(i[2])||e.inRange(i[1]+i[3])&&o.inRange(i[2]))&&(n.includePoint(i[0]),e.includePoint(i[1]),e.includePoint(i[1]-i[3]),e.includePoint(i[1]+i[3]),o.includePoint(i[2]),o.includePoint(i[2]-i[4]),o.includePoint(i[2]+i[4])):"xyzerrorbars"===s?(n.inRange(i[0])&&e.inRange(i[1])&&o.inRange(i[2]-i[5])||n.inRange(i[0])&&e.inRange(i[1])&&o.inRange(i[2])||n.inRange(i[0])&&e.inRange(i[1])&&o.inRange(i[2]+i[5])||n.inRange(i[0])&&e.inRange(i[1]-i[4])&&o.inRange(i[2])||n.inRange(i[0])&&e.inRange(i[1]+i[4])&&o.inRange(i[2])||n.inRange(i[0]-i[3])&&e.inRange(i[1])&&o.inRange(i[2])||n.inRange(i[0]+i[3])&&e.inRange(i[1])&&o.inRange(i[2]))&&(n.includePoint(i[0]),n.includePoint(i[0]-i[3]),n.includePoint(i[0]+i[3]),e.includePoint(i[1]),e.includePoint(i[1]-i[4]),e.includePoint(i[1]+i[4]),o.includePoint(i[2]),o.includePoint(i[2]-i[5]),o.includePoint(i[2]+i[5])):"xerrorrange"===s?e.inRange(i[1])&&(!a||o.inRange(i[2]))&&(n.inRange(i[2+a])||n.inRange(i[0])||n.inRange(i[3+a]))&&(n.includePoint(i[0]),e.includePoint(i[1]),n.includePoint(i[2+a]),n.includePoint(i[3+a]),a&&o.includePoint(i[2])):"yerrorrange"===s?n.inRange(i[0])&&(!a||o.inRange(i[2]))&&(e.inRange(i[2+a])||e.inRange(i[1])||e.inRange(i[3+a]))&&(n.includePoint(i[0]),e.includePoint(i[1]),e.includePoint(i[2+a]),e.includePoint(i[3+a]),a&&o.includePoint(i[2])):"zerrorrange"===s?n.inRange(i[0])&&e.inRange(i[1])&&(o.inRange(i[2])||o.inRange(i[3])||o.inRange(i[4]))&&(n.includePoint(i[0]),e.includePoint(i[1]),o.includePoint(i[2]),o.includePoint(i[3]),o.includePoint(i[4])):"xyerrorrange"===s?a&&!o.inRange(i[2])||!(n.inRange(i[0])&&e.inRange(i[4+a])||n.inRange(i[0])&&e.inRange(i[1])||n.inRange(i[0])&&e.inRange(i[5+a])||n.inRange(i[2+a])&&e.inRange(i[1])||n.inRange(i[3+a])&&e.inRange(i[1]))||(n.includePoint(i[0]),e.includePoint(i[1]),n.includePoint(i[2+a]),n.includePoint(i[3+a]),e.includePoint(i[4+a]),e.includePoint(i[5+a]),a&&o.includePoint(i[2])):"xzerrorrange"===s?e.inRange(i[1])&&(n.inRange(i[0])&&o.inRange(i[5])||n.inRange(i[0])&&o.inRange(i[2])||n.inRange(i[0])&&o.inRange(i[6])||n.inRange(i[3])&&o.inRange(i[2])||n.inRange(i[4])&&o.inRange(i[2]))&&(e.includePoint(i[1]),n.includePoint(i[0]),n.includePoint(i[3]),n.includePoint(i[4]),o.includePoint(i[2]),o.includePoint(i[5]),o.includePoint(i[6])):"yzerrorrange"===s?n.inRange(i[0])&&(e.inRange(i[1])&&o.inRange(i[5])||e.inRange(i[1])&&o.inRange(i[2])||e.inRange(i[1])&&o.inRange(i[6])||e.inRange(i[3])&&o.inRange(i[2])||e.inRange(i[4])&&o.inRange(i[2]))&&(n.includePoint(i[0]),n.includePoint(i[3]),n.includePoint(i[4]),e.includePoint(i[1]),e.includePoint(i[5]),e.includePoint(i[6]),o.includePoint(i[2]),o.includePoint(i[7]),o.includePoint(i[8])):"xyzerrorrange"===s?(n.inRange(i[0])&&e.inRange(i[1])&&o.inRange(i[7])||n.inRange(i[0])&&e.inRange(i[1])&&o.inRange(i[2])||n.inRange(i[0])&&e.inRange(i[1])&&o.inRange(i[8])||n.inRange(i[0])&&e.inRange(i[5])&&o.inRange(i[2])||n.inRange(i[0])&&e.inRange(i[6])&&o.inRange(i[2])||n.inRange(i[3])&&e.inRange(i[1])&&o.inRange(i[2])||n.inRange(i[4])&&e.inRange(i[1])&&o.inRange(i[2]))&&(n.includePoint(i[0]),n.includePoint(i[0]-i[3]),n.includePoint(i[0]+i[3]),e.includePoint(i[1]),e.includePoint(i[1]-i[4]),e.includePoint(i[1]+i[4]),o.includePoint(i[2]),o.includePoint(i[2]-i[5]),o.includePoint(i[2]+i[5])):"impulses"===s?n.inRange(i[0])&&e.inRange(i[1])&&(!a||o.inRange(i[2]))&&(n.includePoint(i[0]),e.includePoint(i[1]),a&&o.includePoint(i[2]),e.includePoint(h.graph.boxFrom)):"wboxes"===s?e.inRange(i[1])&&(n.inRange(i[0])||n.inRange(i[0]-i[2])||n.inRange(i[0]+i[2]))&&(e.includePoint(i[1]),n.includePoint(i[0]),n.includePoint(i[0]-i[2]),n.includePoint(i[0]+i[2]),e.includePoint(h.graph.boxFrom)):"arrows_head"!==s&&"arrows_nohead"!==s&&"arrows_twohead"!==s||(n.inRange(i[0])&&e.inRange(i[1])&&(!a||o.inRange(i[2]))||n.inRange(i[2+a])&&e.inRange(i[3+a])&&(!a||o.inRange(i[5])))&&(n.includePoint(i[0]),e.includePoint(i[1]),n.includePoint(i[2+a]),e.includePoint(i[3+a]),a&&(o.includePoint(i[2]),o.includePoint(i[5])))}),0},Nt.prototype.renderDataSet=function(p,u,c,t,i,s){var n,e,l,d=this,f=p.axes[t],y=p.axes[i],g=p.axes[s];if("lines"!==c&&"linespoints"!==c||(e=new wt(p.page,p,f,y,g,u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineType,u.workspace.styleFinal.lineWidth),$.each(u.data,function(t,i){e.point(i[0],i[1],p.threeDimensional?i[2]:0,0,0,0,0,0,0)}),e.penUp(),e.renderLine()),"points"===c||"linespoints"===c){var s=u.workspace.styleFinal.pointType%this.page.styling.pointTypes.length,o=d.page.styling.pointTypes[s];$.each(u.data,function(t,i){i=p.projectPoint(i[0],i[1],p.threeDimensional?i[2]:0,f,y,g,!1);isNaN(i.xpos)||isNaN(i.ypos)||o(i.xpos,i.ypos,u.workspace.styleFinal.pointSize,u.workspace.styleFinal.pointLineWidth,u.workspace.styleFinal.color.toHTML())})}else if("boxes"===c||"steps"===c||"fsteps"===c||"histeps"===c)if("boxes"===c&&null!==this.graph.boxWidth)$.each(u.data,function(t,i){var s=f.logarithmic?(e=i[0]/Math.sqrt(d.graph.boxWidth),i[0]*Math.sqrt(d.graph.boxWidth)):(e=i[0]-d.graph.boxWidth/2,i[0]+d.graph.boxWidth/2),n=p.projectPoint(e,i[1],0,f,y,g,!0),i=p.projectPoint(s,i[1],0,f,y,g,!0),s=p.projectPoint(s,d.graph.boxFrom,0,f,y,g,!0),e=p.projectPoint(e,d.graph.boxFrom,0,f,y,g,!0);d.page.canvas.Ds(u.workspace.styleFinal.fillColor.toHTML()),d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth),d.page.canvas.Fi(),d.page.canvas.Li(n.xpos,n.ypos),d.page.canvas.Oi(i.xpos,i.ypos),d.page.canvas.Oi(s.xpos,s.ypos),d.page.canvas.Oi(e.xpos,e.ypos),d.page.canvas.Us(),d.page.canvas.Di()});else{for("boxes"!==c&&(d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth),d.page.canvas.Fi()),w=0;w<u.data.length;w++){var h,a,r,M=null,x=null;0<w&&(M="boxes"===c||"histeps"===c?f.logarithmic?Math.sqrt(u.data[w][0]/u.data[w-1][0]):(u.data[w][0]-u.data[w-1][0])/2:"steps"===c?f.logarithmic?u.data[w][0]/u.data[w-1][0]:u.data[w][0]-u.data[w-1][0]:f.logarithmic?1:0),w<u.data.length-1&&(x="boxes"===c||"histeps"===c?f.logarithmic?Math.sqrt(u.data[w+1][0]/u.data[w][0]):(u.data[w+1][0]-u.data[w][0])/2:"steps"===c?f.logarithmic?1:0:f.logarithmic?u.data[w+1][0]/u.data[w][0]:u.data[w+1][0]-u.data[w][0]),null===M&&null===x?M=x=.5:null===M?M=x:null===x&&(x=M),r=f.logarithmic?(h=u.data[w][0]/M,u.data[w][0]*x):(h=u.data[w][0]-M,u.data[w][0]+x),a=p.projectPoint(h,u.data[w][1],0,f,y,g,!0),M=p.projectPoint(r,u.data[w][1],0,f,y,g,!0),x=p.projectPoint(r,d.graph.boxFrom,0,f,y,g,!0),r=p.projectPoint(h,d.graph.boxFrom,0,f,y,g,!0),"boxes"===c?(d.page.canvas.Ds(u.workspace.styleFinal.fillColor.toHTML()),d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth/2),d.page.canvas.Fi(),d.page.canvas.Li(a.xpos,a.ypos),d.page.canvas.Oi(M.xpos,M.ypos),d.page.canvas.Oi(x.xpos,x.ypos),d.page.canvas.Oi(r.xpos,r.ypos),d.page.canvas.Us(),d.page.canvas.Di()):(d.page.canvas.Oi(a.xpos,a.ypos),d.page.canvas.Oi(M.xpos,M.ypos))}"boxes"!==c&&d.page.canvas.Di()}else if("wboxes"===c)$.each(u.data,function(t,i){var s=i[2],n=f.logarithmic?(e=i[0]/Math.sqrt(s),i[0]*Math.sqrt(s)):(e=i[0]-s/2,i[0]+s/2),s=p.projectPoint(e,i[1],0,f,y,g,!0),i=p.projectPoint(n,i[1],0,f,y,g,!0),n=p.projectPoint(n,d.graph.boxFrom,0,f,y,g,!0),e=p.projectPoint(e,d.graph.boxFrom,0,f,y,g,!0);d.page.canvas.Ds(u.workspace.styleFinal.fillColor.toHTML()),d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth/2),d.page.canvas.Fi(),d.page.canvas.Li(s.xpos,s.ypos),d.page.canvas.Oi(i.xpos,i.ypos),d.page.canvas.Oi(n.xpos,n.ypos),d.page.canvas.Oi(e.xpos,e.ypos),d.page.canvas.Us(),d.page.canvas.Di()});else if("impulses"===c)$.each(u.data,function(t,i){var s=i[0],i=p.projectPoint(s,i[1],0,f,y,g,!0),s=p.projectPoint(s,d.graph.boxFrom,0,f,y,g,!0);d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth),d.page.canvas.Fi(),d.page.canvas.Li(i.xpos,i.ypos),d.page.canvas.Oi(s.xpos,s.ypos),d.page.canvas.Di()});else if("dots"===c)$.each(u.data,function(t,i){var s=p.projectPoint(i[0],i[1],p.threeDimensional?i[2]:0,f,y,g,!1);isNaN(s.xpos)||isNaN(s.ypos)||(i=u.workspace.styleFinal.pointSize*d.page.constants.DEFAULT_PS*.25,d.page.canvas.Ds(u.workspace.styleFinal.color.toHTML()),d.page.canvas.Fi(),d.page.canvas.Js(s.xpos,s.ypos,i,0,2*Math.PI,0),d.page.canvas.Us())});else if("upperlimits"===c||"lowerlimits"===c)v=new vt,$.each(u.data,function(t,i){var s=p.projectPoint(i[0],i[1],p.threeDimensional?i[2]:0,f,y,g,!1),n=u.workspace.styleFinal.pointSize*d.page.constants.DEFAULT_PS*3,e=2*n;"upperlimits"===c&&(e*=-1);var o=Math.sin(s.theta_x),h=Math.cos(s.theta_x),a=Math.sin(s.theta_y),r=Math.cos(s.theta_y),l=Math.sin(s.theta_z),i=Math.cos(s.theta_z);isNaN(s.xpos)||isNaN(s.ypos)||(d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth),d.page.canvas.Fi(),d.page.canvas.Li(s.xpos-n*o,s.ypos-n*h),d.page.canvas.Oi(s.xpos+n*o,s.ypos+n*h),p.threeDimensional&&(d.page.canvas.Li(s.xpos-n*l,s.ypos-n*i),d.page.canvas.Oi(s.xpos+n*l,s.ypos+n*i)),d.page.canvas.Di(),v.primitive_arrow(d.page,"single",s.xpos,s.ypos,s.zpos,s.xpos+e*a,s.ypos+e*r,s.zpos,u.workspace.styleFinal.color,u.workspace.styleFinal.lineWidth,1))});else if("arrows_head"===c||"arrows_twohead"===c||"arrows_nohead"===c){var v=new vt,_="arrows_head"===c?"single":"arrows_twohead"===c?"double":"none";$.each(u.data,function(t,i){i=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),p.projectPoint(i[3],i[4],i[5],f,y,g,!1)]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),p.projectPoint(i[2],i[3],0,f,y,g,!1)];isNaN(i[0].xpos)||isNaN(i[0].ypos)||isNaN(i[1].xpos)||isNaN(i[1].ypos)||v.primitive_arrow(d.page,_,i[0].xpos,i[0].ypos,i[0].zpos,i[1].xpos,i[1].ypos,i[1].zpos,u.workspace.styleFinal.color,u.workspace.styleFinal.lineWidth,1)})}else if("xerrorbars"===c||"yerrorbars"===c||"zerrorbars"===c||"xerrorrange"===c||"yerrorrange"===c||"zerrorrange"===c||"xyerrorbars"===c||"xzerrorbars"===c||"yzerrorbars"===c||"xyerrorrange"===c||"xzerrorrange"===c||"yzerrorrange"===c||"xyzerrorbars"===c||"xyzerrorrange"===c){d.page.canvas.Ai(u.workspace.styleFinal.color.toHTML(),u.workspace.styleFinal.lineWidth),d.page.canvas.Fi(),$.each(u.data,function(t,i){var s;"xerrorbars"===c?(s=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0]-i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[0]+i[3],i[1],i[2],f,y,g,!0)]]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),[p.projectPoint(i[0]-i[2],i[1],0,f,y,g,!0),p.projectPoint(i[0]+i[2],i[1],0,f,y,g,!0)]],l=["x","y","z"]):"xerrorrange"===c?(s=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[4],i[1],i[2],f,y,g,!0)]]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),[p.projectPoint(i[2],i[1],0,f,y,g,!0),p.projectPoint(i[3],i[1],0,f,y,g,!0)]],l=["x","y","z"]):"yerrorbars"===c?(s=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0],i[1]-i[3],i[2],f,y,g,!0),p.projectPoint(i[0],i[1]+i[3],i[2],f,y,g,!0)]]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),[p.projectPoint(i[0],i[1]-i[2],0,f,y,g,!0),p.projectPoint(i[0],i[1]+i[2],0,f,y,g,!0)]],l=["y","x","z"]):"yerrorrange"===c?(s=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0],i[3],i[2],f,y,g,!0),p.projectPoint(i[0],i[4],i[2],f,y,g,!0)]]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),[p.projectPoint(i[0],i[2],0,f,y,g,!0),p.projectPoint(i[0],i[3],0,f,y,g,!0)]],l=["y","x","z"]):"zerrorbars"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0],i[1],i[2]-i[3],f,y,g,!0),p.projectPoint(i[0],i[1],i[2]+i[3],f,y,g,!0)]],l=["z","x","y"]):"zerrorrange"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0],i[1],i[3],f,y,g,!0),p.projectPoint(i[0],i[1],i[4],f,y,g,!0)]],l=["z","x","y"]):"xyerrorbars"===c?(s=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0]-i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[0]+i[3],i[1],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1]-i[4],i[2],f,y,g,!0),p.projectPoint(i[0],i[1]+i[4],i[2],f,y,g,!0)]]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),[p.projectPoint(i[0]-i[2],i[1],0,f,y,g,!0),p.projectPoint(i[0]+i[2],i[1],0,f,y,g,!0)],[p.projectPoint(i[0],i[1]-i[3],0,f,y,g,!0),p.projectPoint(i[0],i[1]+i[3],0,f,y,g,!0)]],l=["x","y","z"]):"xyerrorrange"===c?(s=p.threeDimensional?[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[4],i[1],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[5],i[2],f,y,g,!0),p.projectPoint(i[0],i[6],i[2],f,y,g,!0)]]:[p.projectPoint(i[0],i[1],0,f,y,g,!1),[p.projectPoint(i[2],i[1],0,f,y,g,!0),p.projectPoint(i[3],i[1],0,f,y,g,!0)],[p.projectPoint(i[0],i[4],0,f,y,g,!0),p.projectPoint(i[0],i[5],0,f,y,g,!0)]],l=["x","y","z"]):"xzerrorbars"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0]-i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[0]+i[3],i[1],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1],i[2]-i[4],f,y,g,!0),p.projectPoint(i[0],i[1],i[2]+i[4],f,y,g,!0)]],l=["x","z","y"]):"xzerrorrange"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[4],i[1],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1],i[5],f,y,g,!0),p.projectPoint(i[0],i[1],i[6],f,y,g,!0)]],l=["x","z","y"]):"yzerrorbars"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0],i[1]-i[3],i[2],f,y,g,!0),p.projectPoint(i[0],i[1]+i[3],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1],i[2]-i[4],f,y,g,!0),p.projectPoint(i[0],i[1],i[2]+i[4],f,y,g,!0)]],l=["y","z","x"]):"yzerrorrange"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0],i[3],i[2],f,y,g,!0),p.projectPoint(i[0],i[4],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1],i[5],f,y,g,!0),p.projectPoint(i[0],i[1],i[6],f,y,g,!0)]],l=["y","z","x"]):"xyzerrorbars"===c?(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[0]-i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[0]+i[3],i[1],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1]-i[4],i[2],f,y,g,!0),p.projectPoint(i[0],i[1]+i[4],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1],i[2]-i[5],f,y,g,!0),p.projectPoint(i[0],i[1],i[2]+i[5],f,y,g,!0)]],l=["x","y","z"]):"xyzerrorrange"===c&&(s=[p.projectPoint(i[0],i[1],i[2],f,y,g,!1),[p.projectPoint(i[3],i[1],i[2],f,y,g,!0),p.projectPoint(i[4],i[1],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[5],i[2],f,y,g,!0),p.projectPoint(i[0],i[6],i[2],f,y,g,!0)],[p.projectPoint(i[0],i[1],i[7],f,y,g,!0),p.projectPoint(i[0],i[1],i[8],f,y,g,!0)]],l=["x","y","z"]);var n,e,o=[];for(r=0;r<l.length;r++){var h=s[0]["theta_"+l[r]];o.push([Math.sin(h),Math.cos(h)])}if(!isNaN(s[0].xpos)&&!isNaN(s[0].ypos)){for(r=1;r<s.length;r++)d.page.canvas.Li(s[r][0].xpos,s[r][0].ypos),d.page.canvas.Oi(s[r][1].xpos,s[r][1].ypos);for(var a,r=1;r<s.length;r++)for(n=0;n<=1;n++)for(e=0;e<=(p.threeDimensional?2:1);e++)e!==r-1&&(a=4*u.workspace.styleFinal.lineWidth,d.page.canvas.Li(s[r][n].xpos-o[e][0]*a,s[r][n].ypos-o[e][1]*a),d.page.canvas.Oi(s[r][n].xpos+o[e][0]*a,s[r][n].ypos+o[e][1]*a));for(e=s.length-1;e<=(p.threeDimensional?2:1);e++)a=3*u.workspace.styleFinal.lineWidth,d.page.canvas.Li(s[0].xpos-o[e][0]*a,s[0].ypos-o[e][1]*a),d.page.canvas.Oi(s[0].xpos+o[e][0]*a,s[0].ypos+o[e][1]*a)}}),d.page.canvas.Di()}else if("surface"===c)if(u.grid)for(var m=new Ot(0,0,1),b=u.data,w=0;w<u.grid_dimensions[0]-1;w++)for(n=0;n<u.grid_dimensions[1]-1;n++){var P=[];$.each([0,1,u.grid_dimensions[1],u.grid_dimensions[1]+1],function(t,i){i=w*u.grid_dimensions[1]+n+i,i=p.projectPoint(b[i][0],b[i][1],b[i][2],f,y,g,!1);P.push(new Ot(i.xpos,i.ypos,i.depth))});for(var k=0;k<2;k++){var z=k?[0,1,2]:[1,2,3],N=P[z[1]].sub(P[z[0]]),I=P[z[2]].sub(P[z[0]]),N=N.cross_product(I).angle_with(m),I=Math.abs(Math.cos(N)),N=u.workspace.styleFinal.fillColor.multiply(I),I=u.workspace.styleFinal.color.isVisible()?u.workspace.styleFinal.color:N,z=function(t,i,s,n){return function(){d.page.canvas.Ai(i.toHTML(),t.lineWidth/2),d.page.canvas.Ds(s.toHTML()),d.page.canvas.Fi(),d.page.canvas.Li(n[0].Hn,n[0].Vn),d.page.canvas.Oi(n[1].Hn,n[1].Vn),d.page.canvas.Oi(n[2].Hn,n[2].Vn),d.page.canvas.Us(),d.page.canvas.Di()}}(u.workspace.styleFinal,I,N,[P[z[0]],P[z[1]],P[z[2]]]);this.page.threeDimensionalBuffer.addItem(P[0].Wn,z)}}else p.page.errorLog+="The surface plot style can only operate of data sets generated with the <evaluate_over_grid> method of the <JSPlot_FunctionEvaluator> class.\n"},It.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"fillColor":s.fillColor=i;break;case"height":s.height=i;break;case"origin":s.origin=i;break;case"strokeColor":s.strokeColor=i;break;case"strokeLineWidth":s.strokeLineWidth=i;break;case"width":s.width=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised rectangle setting "+t}})},It.prototype.cleanWorkspace=function(){this.workspace=[]},It.prototype.determineWidth=function(t){this.page=t,this.cleanWorkspace()},It.prototype.calculateDataRanges=function(){},It.prototype.calculateBoundingBox=function(t){var i=new JSPlot_BoundingBox;return i.includePoint(this.origin[0]-3,this.origin[1]-3),i.includePoint(this.origin[0]+this.width+3,this.origin[1]+this.height+3),i},It.prototype.render=function(){null!==this.fillColor&&(this.page.canvas.Ds(this.fillColor.toHTML()),this.page.canvas.Fi(),this.page.canvas.hn(this.origin[0],this.origin[1],this.width,this.height),this.page.canvas.Us()),null!==this.strokeColor&&(this.page.canvas.Ai(this.strokeColor.toHTML(),this.strokeLineWidth),this.page.canvas.Fi(),this.page.canvas.hn(this.origin[0],this.origin[1],this.width,this.height),this.page.canvas.Di())},It.prototype.interactive_scroll=function(t,i){},It.prototype.interactive_zoom=function(t){return!1},Bt.prototype.setLineType=function(t,i,s,n){for(i=(i-1)%9;i<0;)i+=9;switch(i){case 0:0;break;case 1:case 2:0;break;case 3:0;break;case 4:0;break;case 5:0;break;case 6:0;break;case 7:0;break;case 8:0}this.page.canvas.Ai(t,s)},Bt.prototype.getDefaultColors=function(){return[new Mt(1,0,0,1),new Mt(0,0,1,1),new Mt(0,.75,0,1),new Mt(1,0,1,1),new Mt(0,.75,.75,1),new Mt(0,0,0,1)]},Bt.prototype.getPointTypes=function(){var a=this;return[function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Js(t,i,s,0,2*Math.PI,0),a.page.canvas.Us()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t-s,i-s),a.page.canvas.Oi(t-s,i+s),a.page.canvas.Oi(t+s,i+s),a.page.canvas.Oi(t+s,i-s),a.page.canvas.Us()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t+s,i+s),a.page.canvas.Oi(t,i-s),a.page.canvas.Oi(t-s,i+s),a.page.canvas.Us()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<4;h++)a.page.canvas.Oi(t+o*Math.sin(2*Math.PI*h/4),i-o*Math.cos(2*Math.PI*h/4));a.page.canvas.Us()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<6;h++)a.page.canvas.Oi(t+o*Math.sin(2*Math.PI*h/6),i-o*Math.cos(2*Math.PI*h/6));a.page.canvas.Us()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<5;h++)a.page.canvas.Oi(t+o*Math.sin(2*Math.PI*h/5),i-o*Math.cos(2*Math.PI*h/5));a.page.canvas.Us()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t+s,i-s),a.page.canvas.Oi(t,i+s),a.page.canvas.Oi(t-s,i-s),a.page.canvas.Us()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t-s,i-s),a.page.canvas.Oi(t+s,i),a.page.canvas.Oi(t-s,i+s),a.page.canvas.Us()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ds(e),a.page.canvas.Fi(),a.page.canvas.Li(t+s,i-s),a.page.canvas.Oi(t-s,i),a.page.canvas.Oi(t+s,i+s),a.page.canvas.Us()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t-s,i-s),a.page.canvas.Oi(t+s,i+s),a.page.canvas.Li(t-s,i+s),a.page.canvas.Oi(t+s,i-s),a.page.canvas.Di()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t-s,i-s),a.page.canvas.Oi(t-s,i+s),a.page.canvas.Oi(t+s,i+s),a.page.canvas.Oi(t+s,i-s),a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Js(t,i,s,0,2*Math.PI,0),a.page.canvas.Di()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t+s,i+s),a.page.canvas.Oi(t,i-s),a.page.canvas.Oi(t-s,i+s),a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<4;h++)a.page.canvas.Oi(t+o*Math.sin(2*Math.PI*h/4),i-o*Math.cos(2*Math.PI*h/4));a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<6;h++)a.page.canvas.Oi(t+o*Math.sin(2*Math.PI*h/6),i-o*Math.cos(2*Math.PI*h/6));a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<5;h++)a.page.canvas.Oi(t+o*Math.sin(2*Math.PI*h/5),i-o*Math.cos(2*Math.PI*h/5));a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t+s,i-s),a.page.canvas.Oi(t,i+s),a.page.canvas.Oi(t-s,i-s),a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t-s,i-s),a.page.canvas.Oi(t+s,i),a.page.canvas.Oi(t-s,i+s),a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){s*=a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t+s,i-s),a.page.canvas.Oi(t-s,i),a.page.canvas.Oi(t+s,i+s),a.page.canvas.On(),a.page.canvas.Di()},function(t,i,s,n,e){var o=s*a.page.constants.DEFAULT_PS;a.page.canvas.Ai(e,n),a.page.canvas.Fi(),a.page.canvas.Li(t,i-o);for(var h=1;h<5;h++)a.page.canvas.Oi(t+o*Math.sin(4*Math.PI*h/5),i-o*Math.cos(4*Math.PI*h/5));a.page.canvas.On(),a.page.canvas.Di()}]},St.prototype.configure=function(t){var s=this;$.each(t,function(t,i){switch(t){case"color":s.color=i;break;case"fontSize":s.fontSize=i;break;case"fontFamily":s.fontFamily=i;break;case"fontStyle":s.fontStyle=i;break;case"fontWeight":s.fontWeight=i;break;case"h_align":s.h_align=i;break;case"origin":s.origin=i;break;case"text":s.text=i;break;case"v_align":s.v_align=i;break;case"z_index":s.z_index=i;break;default:throw"Unrecognised text item setting "+t}})},St.prototype.cleanWorkspace=function(){this.workspace=[]},St.prototype.determineWidth=function(t){this.page=t,this.cleanWorkspace()},St.prototype.calculateDataRanges=function(){},St.prototype.calculateBoundingBox=function(){var t=new JSPlot_BoundingBox;this.page.canvas.Dn(this.fontFamily,this.fontSize,this.fontWeight,this.fontStyle);var i=this.page.canvas.Ao(this.text)+10,s=this.fontSize+4;return t.includePoint(this.origin[0],this.origin[1]),"left"===this.h_align?t.includePoint(this.origin[0]+i,this.origin[1]):"center"===this.h_align?(t.includePoint(this.origin[0]-i/2,this.origin[1]),t.includePoint(this.origin[0]+i/2,this.origin[1])):"right"===this.h_align&&t.includePoint(this.origin[0]-i,this.origin[1]),"top"===this.v_align?t.includePoint(this.origin[0],this.origin[1]+s):"center"===this.v_align?(t.includePoint(this.origin[0],this.origin[1]+s/2),t.includePoint(this.origin[0],this.origin[1]-s/2)):"bottom"===this.v_align&&t.includePoint(this.origin[0],this.origin[1]-s),t},St.prototype.render=function(){var t,i;null!==this.color&&(t=0,"left"===this.h_align&&(t=-1),"right"===this.h_align&&(t=1),i=0,"top"===this.v_align&&(i=1),"bottom"===this.v_align&&(i=-1),this.page.canvas.Dn(this.fontFamily,this.fontSize,this.fontWeight,this.fontStyle),this.page.canvas.Ds(this.color.toHTML()),this.page.canvas.Ts(this.origin[0],this.origin[1],t,i,!0,this.text,!1,!1))},St.prototype.interactive_scroll=function(t,i){},St.prototype.interactive_zoom=function(t){return!1},Et.prototype.reset=function(){this.active=!1,this.buffer=[]},Et.prototype.activate=function(){this.deactivate(),this.reset(),this.active=!0},Et.prototype.deactivate=function(){this.buffer.sort(function(t,i){return t[0]-i[0]}),$.each(this.buffer,function(t,i){i[1]()}),this.reset()},Et.prototype.addItem=function(t,i){this.active?this.buffer.push([t,i]):i()},Ct.prototype.process=function(){var t,i,s,n,e,a=this;this.axis.workspace.rangeFinalised||(t=null!==this.axis.workspace.minHard,i=null!==this.axis.workspace.maxHard,e=n=null,t?n=this.axis.workspace.minHard:null!==this.axis.workspace.minUsed&&(n=this.axis.workspace.minUsed),e=i?this.axis.workspace.maxHard:null!==this.axis.workspace.maxUsed?this.axis.workspace.maxUsed:null!==n?n+20:(n=0,10),Math.abs(e-n)<=1e-14*Math.max(n,e)&&(t&&i&&(this.axis.graph.page.workspace.errorLog+="Axis range set to zero. Ignoring manually set range.\n"),n-=s=Math.max(1,.001*Math.abs(n)),e+=s),s=Math.pow(10,Math.floor(Math.log10(Math.abs(e-n)/5))),n=Math.floor(n/s)*s,e=Math.ceil(e/s)*s,this.axis.workspace.minFinal=t?this.axis.workspace.minHard:n,this.axis.workspace.maxFinal=i?this.axis.workspace.maxHard:e,this.axis.workspace.rangeFinalised=!0),null===this.axis.workspace.tickListFinal&&(this.axis.workspace.tickListFinal={major:[],minor:[]},$.each(["major","minor"],function(t,s){var i=t?a.axis.ticksMinor:a.axis.ticks;if(null===i.tickList)if(null===i.tickStep)a.automatic_ticking(s);else{var t=Math.min(a.axis.workspace.minFinal,a.axis.workspace.maxFinal),n=Math.max(a.axis.workspace.minFinal,a.axis.workspace.maxFinal),e=i.tickMin;e<t&&(e+=Math.ceil((t-e)/i.tickStep)*i.tickStep);for(var o=0;o<100;o++){var h=e+o*i.tickStep;if(n<h)break;Math.abs(h)<1e-12*i.tickStep&&(h=0),a.axis.workspace.tickListFinal[s].push([h,a.numeric_display(h)])}}else $.each(i.tickList,function(t,i){a.axis.workspace.tickListFinal[s].push([parseFloat(i[0]),""+i[1]])})}))},Ct.prototype.ticking_schemes=function(t,i){for(var s=0,n=[],e=[1,2,4,5,10,20,25,50,100],o=e.length;Math.pow(10,s)<2560;){var h=t/Math.pow(10,s);if(i&&h<.9){var a=new At(this.axis),n=n.concat(a.ticking_schemes());break}for(var r=o-1;0<=r;r--){var l=e[r]*h/Math.pow(10,2);i&&1e-6<Math.abs(Math.round(l)-l)||n.push({multipliers:[1],tick_separation:l,offset:0})}s++}return n},Ct.prototype.automatic_ticking=function(s){var a=this,r=Math.min(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),l=Math.max(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),t=Math.pow(10,Math.ceil(Math.log10(l-r))),p=Math.floor(r/t)*t,u=Math.ceil(l/t)*t,c="major"===s?this.axis.workspace.target_number_major_ticks:this.axis.workspace.target_number_minor_ticks,c=Math.max(c,2);c=Math.min(c,this.max_allowed_ticks);var t=this.ticking_schemes(t,!1),d=[],f=!1;$.each(t,function(t,n){if(!f){for(var e=[],o=p+n.offset,h=0;h<(u-p)/n.tick_separation+2&&!(e.length>a.max_allowed_ticks);h++)$.each(n.multipliers,function(t,i){var s=o+h*n.tick_separation;Math.abs(s)<1e-8*n.tick_separation&&(s=0),(s*=i)<r||l<s||e.push(s)});var i=!0;"major"!==s&&$.each(a.axis.workspace.tickListFinal.major,function(t,s){var n;i&&(n=!1,$.each(e,function(t,i){n||Math.abs(s[0]-i)/(l-r)<1e-6&&(n=!0)}),n||(i=!1))}),i&&(e.length>c?f=!0:d=e)}});var n=[];$.each(d,function(t,i){n.push([i,a.numeric_display(i)])}),this.axis.workspace.tickListFinal[s]=n},Ct.prototype.numeric_display=function(t){var i,s,n,e;if(0===t)return"0";if(Math.abs(t)<1e5&&.001<Math.abs(t)){i=Math.abs(t),s=Math.pow(10,-8),n=8-Math.log10(i);for(var o=0;o<n;o++){var h=Math.round(i*Math.pow(10,o))/Math.pow(10,o);if(Math.abs(h-i)/i<s)break}return e=(e=t.toFixed(o)).replace("-","–")}for(i=Math.abs(t),i/=Math.pow(10,Math.floor(Math.log10(i))),accuracy=i*(1+Math.pow(10,-8)),o=0;o<8&&!(i-(Math.floor(i*Math.pow(10,o))/Math.pow(10,o)-i)<accuracy);o++);e=t.toExponential(o);for(var a=0;a<e.length&&"."!==e.charAt(a)&&"e"!==e.charAt(a);)a++;if("."!==e.charAt(a)&&"e"!==e.charAt(a))return e;var r=a;for("."===e.charAt(a)&&r++;!isNaN(e.charAt(r));)r++;var l=e.substr(0,r);"+"===e.charAt(r+1)&&r++;for(var t=e.substr(r+1,e.length-r-1),t="×10"+this.superscript(t),l=l.replace("-","–"),p=r-1;a<p&&"0"===l.charAt(p);)p--;return"."===(l=l.substr(0,p+1)).charAt(l.length-1)&&(l=l.substr(0,l.length-1)),"1×"===(e=l+t).substr(0,2)&&(e=e.substr(2,e.length-2)),e},Ct.prototype.superscript=function(t){var i={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻",a:"ᵃ",b:"ᵇ",c:"ᶜ",d:"ᵈ",e:"ᵉ",f:"ᶠ",g:"ᵍ",h:"ʰ",i:"ⁱ",j:"ʲ",k:"ᵏ",l:"ˡ",m:"ᵐ",n:"ⁿ",o:"ᵒ",p:"ᵖ",r:"ʳ",s:"ˢ",t:"ᵗ",u:"ᵘ",v:"ᵛ",w:"ʷ",x:"ˣ",y:"ʸ",z:"ᶻ"};return t.split("").map(function(t){t=i[t];return t||""}).join("")},At.prototype.process=function(){var t,i,s,n,e,r=this;this.axis.workspace.rangeFinalised||(t=null!==this.axis.workspace.minHard,i=null!==this.axis.workspace.maxHard,e=n=null,t?n=this.axis.workspace.minHard:null!==this.axis.workspace.minUsed&&(n=this.axis.workspace.minUsed),e=i?this.axis.workspace.maxHard:null!==this.axis.workspace.maxUsed?this.axis.workspace.maxUsed:null!==n?100*n:(n=1,10),n<=1e-200&&(this.axis.graph.page.workspace.errorLog+="Logarithmic axis range with range set below zero.\n",n=1e-10),e<=1e-200&&(this.axis.graph.page.workspace.errorLog+="Logarithmic axis range with range set below zero.\n",e=1e-10),Math.abs(e-n)<=1e-14*Math.max(n,e)&&(t&&i&&(this.axis.graph.page.workspace.errorLog+="Axis range set to zero. Ignoring manually set range.\n"),1e-300<n&&(n/=10),e<1e300&&(e*=10)),n=Math.log10(n),e=Math.log10(e),s=Math.pow(10,Math.floor(Math.log10(Math.abs(e-n)/5))),n=Math.floor(n/s)*s,e=Math.ceil(e/s)*s,n=Math.pow(10,n),e=Math.pow(10,e),this.axis.workspace.minFinal=t?this.axis.workspace.minHard:n,this.axis.workspace.maxFinal=i?this.axis.workspace.maxHard:e,this.axis.workspace.rangeFinalised=!0),null===this.axis.workspace.tickListFinal&&(this.axis.workspace.tickListFinal={major:[],minor:[]},$.each(["major","minor"],function(t,s){var i=t?r.axis.ticksMinor:r.axis.ticks;if(null===i.tickList)if(null===i.tickStep)r.automatic_ticking(s);else{var n=new Ct(r.axis),t=Math.min(r.axis.workspace.minFinal,r.axis.workspace.maxFinal),e=Math.max(r.axis.workspace.minFinal,r.axis.workspace.maxFinal),o=i.tickMin;o<t&&(o*=Math.exp(Math.ceil(Math.log(t/o)/Math.log(i.tickStep))*Math.log(i.tickStep)));for(var h=0;h<100;h++){var a=o*Math.pow(i.tickStep,h);if(e<a)break;r.axis.workspace.tickListFinal[s].push([a,n.numeric_display(a)])}}else $.each(i.tickList,function(t,i){r.axis.workspace.tickListFinal[s].push([parseFloat(i[0]),""+i[1]])})}))},At.prototype.ticking_schemes=function(){for(var t=[],i=1;;){for(var s=!1,n=[],e=null,o=0;o<i;o++){var h=Math.round(Math.pow(10,o/i));if(h===e){s=!0;break}n.push(h),e=h}if(s)break;t.push({multipliers:n,tick_separation:1,offset:0}),i++}return t.push({multipliers:[1,2,3,4,5,6,7,8,9],tick_separation:1,offset:0}),t},At.prototype.automatic_ticking=function(s){var a,r,l,p,u,c,d,n,f=this,y=Math.min(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),g=Math.max(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),t=this.axis.workspace.logFinal&&3<g/y,M=new Ct(this.axis);t?(a=Math.log10(y),r=Math.log10(g),t=Math.pow(10,Math.ceil(Math.log10(r-a))),l=Math.floor(a/t)*t,p=Math.ceil(r/t)*t,u="major"===s?this.axis.workspace.target_number_major_ticks:this.axis.workspace.target_number_minor_ticks,u=Math.max(u,2),u=Math.min(u,M.max_allowed_ticks),t=M.ticking_schemes(t,!0),d=!(c=[]),$.each(t,function(t,n){if(!d){for(var e=[],o=l+n.offset,h=0;h<(p-l)/n.tick_separation+2&&!(e.length>M.max_allowed_ticks);h++)$.each(n.multipliers,function(t,i){var s=o+h*n.tick_separation;Math.abs(s)<1e-8*n.tick_separation&&(s=0),s=Math.pow(10,s),(s*=i)<y||g<s||e.push(s)});var i=!0;if("major"!==s&&$.each(f.axis.workspace.tickListFinal.major,function(t,s){var n;i&&(n=!1,$.each(e,function(t,i){n||Math.abs(Math.log10(s[0]/i))/(r-a)<1e-6&&(n=!0)}),n||(i=!1))}),i)return"major"!==s&&10===n.multipliers.length?e.length>3*u?void(d=!0):void(c=e):1<n.multipliers.length?e.length>u?void 0:void(c=e):void(e.length>u?d=!0:c=e)}}),n=[],$.each(c,function(t,i){n.push([i,M.numeric_display(i)])}),this.axis.workspace.tickListFinal[s]=n):M.automatic_ticking(s)},Ft.prototype.process=function(){var a=this;if(!this.axis.workspace.rangeFinalised){var t=null!==this.axis.workspace.minHard,i=null!==this.axis.workspace.maxHard,s=null,n=null;t?s=this.axis.workspace.minHard:null!==this.axis.workspace.minUsed&&(s=this.axis.workspace.minUsed),n=i?this.axis.workspace.maxHard:null!==this.axis.workspace.maxUsed?this.axis.workspace.maxUsed:null!==s?s+60:(s=946684800,978307200),Math.abs(n-s)<=1e-14*Math.max(s,n)&&(t&&i&&(this.axis.graph.page.workspace.errorLog+="Axis range set to zero. Ignoring manually set range.\n"),s-=30,n+=30);var e=Math.abs(n-s);if(94608e3<e)var o=this.timestamp_to_calendar(s),h=this.timestamp_to_calendar(n),s=this.calendar_to_timestamp(o[0],1,1,0,0,0),n=this.calendar_to_timestamp(h[0],1,1,0,0,0);else if(7776e3<e)o=this.timestamp_to_calendar(s),12<(h=this.timestamp_to_calendar(n))[1]++&&(h[1]=1,o[0]++),s=this.calendar_to_timestamp(o[0],o[1],1,0,0,0),n=this.calendar_to_timestamp(h[0],h[1],1,0,0,0);else{for(var r=0;r<this.acceptable_intervals.length&&!(this.acceptable_intervals[r]>Math.abs(n-s));r++);r=Math.min(0,r-2),s=Math.floor(s/this.acceptable_intervals[r])*this.acceptable_intervals[r],n=Math.ceil(n/this.acceptable_intervals[r])*this.acceptable_intervals[r]}this.axis.workspace.minFinal=t?this.axis.workspace.minHard:s,this.axis.workspace.maxFinal=i?this.axis.workspace.maxHard:n,this.axis.workspace.rangeFinalised=!0}null===this.axis.workspace.tickListFinal&&(this.axis.workspace.tickListFinal={major:[],minor:[]},$.each(["major","minor"],function(t,s){var i=t?a.axis.ticksMinor:a.axis.ticks;if(null===i.tickList)if(null===i.tickStep)a.automatic_ticking(s);else{var t=Math.min(a.axis.workspace.minFinal,a.axis.workspace.maxFinal),n=Math.min(a.axis.workspace.minFinal,a.axis.workspace.maxFinal),e=i.tickMin;e<t&&(e+=Math.ceil((t-e)/i.tickStep)*i.tickStep);for(var o=0;o<100;o++){var h=e+o*i.tickStep;if(n<h)break;a.axis.workspace.tickListFinal[s].push([h,a.date_display(h,!0,!0,!0,!0)])}}else $.each(i.tickList,function(t,i){a.axis.workspace.tickListFinal[s].push([parseFloat(i[0]),""+i[1]])})}))},Ft.prototype.automatic_ticking=function(f){var y=this,g=Math.min(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),M=Math.max(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),x="major"===f?this.axis.workspace.target_number_major_ticks:this.axis.workspace.target_number_minor_ticks,x=Math.max(x,2);x=Math.min(x,this.max_allowed_ticks);for(var t=[{year_step:1e3},{year_step:500},{year_step:250},{year_step:200},{year_step:100},{year_step:50},{year_step:25},{year_step:20},{year_step:10},{year_step:5},{year_step:2},{year_step:1},{month_step:6},{month_step:4},{month_step:3},{month_step:2},{month_step:1}],i=this.acceptable_intervals.length-1;0<=i;i--)t.push({tick_interval:this.acceptable_intervals[i]});var s,v=[[],null],_=!1;$.each(t,function(t,i){if(!_){var e=[[],null];if(i.hasOwnProperty("year_step"))for(var s=y.timestamp_to_calendar(g)[0],n=y.timestamp_to_calendar(M)[0],o=s=Math.floor(s/i.year_step)*i.year_step;o<=n&&!(e[0].length>y.max_allowed_ticks);o+=i.year_step){var h=y.calendar_to_timestamp(o,1,1,0,0,0);h<g||M<h||e[0].push([h,y.date_display(h,!0,!1,!1,!1,!1)])}else if(i.hasOwnProperty("month_step")){for(var a=y.timestamp_to_calendar(g),s=y.timestamp_to_calendar(M),a=12*a[0]+a[1]-1,r=12*s[0]+s[1]-1,l=a=Math.floor(a/i.month_step)*i.month_step;l<=r&&!(e[0].length>y.max_allowed_ticks);l+=i.month_step)(h=y.calendar_to_timestamp(Math.floor(l/12),l%12+1,1,0,0,0))<g||M<h||e[0].push([h,y.date_display(h,l%12==0,!0,!0,!1,!1)]);e[1]=function(){var t=y.date_display(g,!0,!1,!1,!1,!1),i=y.date_display(M,!0,!1,!1,!1,!1);return i!==t?t+" – "+i:t}}else{for(var p=i.tick_interval,u=2419200<p,c=7200<p,h=Math.floor(g/p)*p;h<=M&&!(e[0].length>y.max_allowed_ticks);h+=p)h<g||M<h||e[0].push([h,y.date_display(h,u,c,c,p<86400,p<60)]);e[1]=function(){var t=y.date_display(g,!0,!1,!1,!1,!1),i=y.date_display(M,!0,!1,!1,!1,!1),s=y.date_display(g,!1,!0,!0,!1,!1),n=y.date_display(M,!1,!0,!0,!1,!1);return c?u?null:i!==t?t+" – "+i:t:i!==t?s+" "+t+" – "+n+" "+i:n!==s?s+" – "+n+i:s+t}}var d=!0;"major"!==f&&$.each(y.axis.workspace.tickListFinal.major,function(t,s){var n;d&&(n=!1,$.each(e[0],function(t,i){n||Math.abs(s[0]-i[0])<.01&&(n=!0)}),n||(d=!1))}),d&&(e[0].length>x?_=!0:v=e)}}),this.axis.workspace.tickListFinal[f]=v[0],"major"!==f||null===v[1]||null!==(s=v[1]())&&(null===this.axis.workspace.labelFinal||0===this.axis.workspace.labelFinal.length?this.axis.workspace.labelFinal=s:this.axis.workspace.labelFinal+=", within "+s)},Ft.prototype.date_display=function(t,i,s,n,e,o){var h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=this.timestamp_to_calendar(t+.001),t="";return n?t+=a[2]+" "+h[a[1]-1]+" ":s&&(t+=h[a[1]-1]+" "),i&&(t+=a[0]+" "),e&&(t+=et(a[3])+":"+et(a[4])),o&&(t+=":"+et(a[5].toFixed(0))),t},Ft.prototype.timestamp_to_calendar=function(t){var i=t/86400+2440587.5,s=.5+i-Math.floor(.5+i),n=Math.floor(24*s),e=Math.floor(1440*s%60),o=86400*s%60,t=Math.floor(.5+i),s=t<2361222?Math.floor(t+1524):(h=Math.floor((t-1867216.25)/36524.25),Math.floor(t+h-Math.floor(h/4)+1525)),i=Math.floor((s-122.1)/365.25),t=Math.floor(365*i+Math.floor(i/4)),h=Math.floor((s-t)/30.6001),t=Math.floor(s-t-Math.floor(30.6001*h)),h=Math.floor(h-1-12*(14<=h?1:0));return[Math.floor(i-4715-(3<=h?1:0)),h,t,n,e,o]},Ft.prototype.calendar_to_timestamp=function(t,i,s,n,e,o){var h,a=1e4*t+100*i+s;if(i<=2&&(i+=12,--t),a<=17520902)h=Math.floor(t+4716)/4-2-1179;else{if(!(17520914<=a))return 0;h=Math.floor(t/400)-Math.floor(t/100)+Math.floor(t/4)}return 86400*(365*Math.floor(t)-679004+2400000.5+h+Math.floor(30.6001*(i+1))+s+(Math.abs(n)+Math.abs(e)/60+Math.abs(o)/3600)/24-2440587.5)},Lt.prototype.str=function(){return"Point("+this.Hn+","+this.Vn+","+this.Wn+")"},Lt.prototype.to_vector=function(){return new Ot(this.Hn,this.Vn,this.Wn)},Lt.prototype.add_vector=function(t){return new Lt(this.Hn+t.Hn,this.Vn+t.Vn,this.Wn+t.Wn)},Lt.prototype.displacement_vector_from=function(t){return new Ot(this.Hn-t.Hn,this.Vn-t.Vn,this.Wn-t.Wn)},Lt.prototype.displacement_from_origin=function(){return new Ot(this.Hn,this.Vn,this.Wn)},Lt.prototype.abs=function(){return Math.sqrt(this.Hn*this.Hn+this.Vn*this.Vn+this.Wn*this.Wn)},Ot.prototype.to_list=function(){return[this.Hn,this.Vn,this.Wn]},Ot.prototype.str=function(){return"Vector("+this.Hn+","+this.Vn+","+this.Wn+")"},Ot.prototype.add=function(t){return new Ot(this.Hn+t.Hn,this.Vn+t.Vn,this.Wn+t.Wn)},Ot.prototype.sub=function(t){return new Ot(this.Hn-t.Hn,this.Vn-t.Vn,this.Wn-t.Wn)},Ot.prototype.mul=function(t){return new Ot(this.Hn*t,this.Vn*t,this.Wn*t)},Ot.prototype.abs=function(){return Math.sqrt(this.Hn*this.Hn+this.Vn*this.Vn+this.Wn*this.Wn)},Ot.prototype.cross_product=function(t){return new Ot(this.Vn*t.Wn-this.Wn*t.Vn,this.Wn*t.Hn-this.Hn*t.Wn,this.Hn*t.Vn-this.Vn*t.Hn)},Ot.prototype.dot_product=function(t){return this.Hn*t.Hn+this.Vn*t.Vn+this.Wn*t.Wn},Ot.prototype.angle_with=function(t){t=this.dot_product(t)/this.abs()/t.abs();return 1<t&&(t=1),t<-1&&(t=-1),Math.acos(t)},Ot.prototype.normalise=function(){var t=this.abs();return new Ot(this.Hn/t,this.Vn/t,this.Wn/t)},Tt.prototype.point=function(t){return this.mi.add_vector(this.Te.mul(t))},Tt.prototype.find_closest_approach=function(t){var i=this.mi,s=t.mi,n=this.Te,e=t.Te,s=s.displacement_vector_from(i),i=e.dot_product(n),e=(s.dot_product(e)-s.dot_product(n)*i)/(1-Math.pow(i,2)),s=e*i-s.dot_product(n),n=this.point(s),s=t.point(e),t=Math.abs(n.displacement_vector_from(s)),e=Math.abs(n.displacement_from_origin().angle_with(s.displacement_from_origin()));return{self_point:n,other_point:s,distance:t,angular_distance:e}},Ot.prototype.rotate_xy=function(t){return new Ot(this.Hn*Math.cos(t)+this.Vn*-Math.sin(t),this.Hn*Math.sin(t)+this.Vn*Math.cos(t),this.Wn)},Ot.prototype.rotate_xz=function(t){return new Ot(this.Hn*Math.cos(t)+this.Wn*-Math.sin(t),this.Vn,this.Hn*Math.sin(t)+this.Wn*Math.cos(t))},Ot.prototype.rotate_yz=function(t){return new Ot(this.Hn,this.Vn*Math.cos(t)+this.Wn*-Math.sin(t),this.Vn*Math.sin(t)+this.Wn*Math.cos(t))},jt.prototype.rotate=function(t,i){var s=Math.sin(t),n=Math.cos(t),e=Math.sin(i),o=Math.cos(i),t=[[1,0,0],[0,1,0],[0,0,1]],i=this.je;t[0][0]=n*i[0][0]+s*i[2][0],t[0][1]=n*i[0][1]+s*i[2][1],t[0][2]=n*i[0][2]+s*i[2][2],t[1][0]=-s*e*i[0][0]+o*i[1][0]+e*n*i[2][0],t[1][1]=-s*e*i[0][1]+o*i[1][1]+e*n*i[2][1],t[1][2]=-s*e*i[0][2]+o*i[1][2]+e*n*i[2][2],t[2][0]=-o*s*i[0][0]-e*i[1][0]+o*n*i[2][0],t[2][1]=-o*s*i[0][1]-e*i[1][1]+o*n*i[2][1],t[2][2]=-o*s*i[0][2]-e*i[1][2]+o*n*i[2][2];i=new jt;return i.je=t,i},jt.prototype.to_euler_angles=function(){var t,i,s,n,e=this.je;return 1<e[0][0]&&(e[0][0]=1),e[0][0]<-1&&(e[0][0]=-1),1<e[0][1]&&(e[0][1]=1),e[0][1]<-1&&(e[0][1]=-1),1<e[0][2]&&(e[0][2]=1),e[0][2]<-1&&(e[0][2]=-1),1<e[1][0]&&(e[1][0]=1),e[1][0]<-1&&(e[1][0]=-1),1<e[1][1]&&(e[1][1]=1),e[1][1]<-1&&(e[1][1]=-1),1<e[1][2]&&(e[1][2]=1),e[1][2]<-1&&(e[1][2]=-1),1<e[2][0]&&(e[2][0]=1),e[2][0]<-1&&(e[2][0]=-1),1<e[2][1]&&(e[2][1]=1),e[2][1]<-1&&(e[2][1]=-1),1<e[2][2]&&(e[2][2]=1),e[2][2]<-1&&(e[2][2]=-1),n=e[2][1]<1&&-1<e[2][1]?(s=-Math.asin(e[2][1]),t=Math.atan2(e[2][0]/Math.cos(s),e[2][2]/Math.cos(s)),i=s,s=Math.atan2(e[0][1]/Math.cos(s),e[1][1]/Math.cos(s)),t):(s=0,n=Math.atan2(e[1][0],e[1][2]),e[2][0]<0?(i=Math.PI/2,s+n):(i=-Math.PI/2,-s+n)),[i,s,n]},jt.prototype.multiply_vector=function(t){var i=this.je;return new Ot(t.Hn*i[0][0]+t.Vn*i[0][1]+t.Wn*i[0][2],t.Hn*i[1][0]+t.Vn*i[1][1]+t.Wn*i[1][2],t.Hn*i[2][0]+t.Vn*i[2][1]+t.Wn*i[2][2])},jt.prototype.rotate_m_yz=function(t){var i=this.je,s=new jt,n=s.je;return n[0][0]=i[0][0],n[0][1]=i[0][1],n[0][2]=i[0][2],n[1][0]=i[1][0]*Math.cos(t)-i[2][0]*Math.sin(t),n[1][1]=i[1][1]*Math.cos(t)-i[2][1]*Math.sin(t),n[1][2]=i[1][2]*Math.cos(t)-i[2][2]*Math.sin(t),n[2][0]=i[1][0]*Math.sin(t)+i[2][0]*Math.cos(t),n[2][1]=i[1][1]*Math.sin(t)+i[2][1]*Math.cos(t),n[2][2]=i[1][2]*Math.sin(t)+i[2][2]*Math.cos(t),s},jt.prototype.rotate_m_xz=function(t){var i=this.je,s=new jt,n=s.je;return n[0][0]=i[0][0]*Math.cos(t)+i[2][0]*Math.sin(t),n[0][1]=i[0][1]*Math.cos(t)+i[2][1]*Math.sin(t),n[0][2]=i[0][2]*Math.cos(t)+i[2][2]*Math.sin(t),n[1][0]=i[1][0],n[1][1]=i[1][1],n[1][2]=i[1][2],n[2][0]=-i[0][0]*Math.sin(t)+i[2][0]*Math.cos(t),n[2][1]=-i[0][1]*Math.sin(t)+i[2][1]*Math.cos(t),n[2][2]=-i[0][2]*Math.sin(t)+i[2][2]*Math.cos(t),s},jt.prototype.rotate_m_xy=function(t){var i=this.je,s=new jt,n=s.je;return n[0][0]=i[0][0]*Math.cos(t)-i[1][0]*Math.sin(t),n[0][1]=i[0][1]*Math.cos(t)-i[1][1]*Math.sin(t),n[0][2]=i[0][2]*Math.cos(t)-i[1][2]*Math.sin(t),n[1][0]=i[0][0]*Math.sin(t)+i[1][0]*Math.cos(t),n[1][1]=i[0][1]*Math.sin(t)+i[1][1]*Math.cos(t),n[1][2]=i[0][2]*Math.sin(t)+i[1][2]*Math.cos(t),n[2][0]=i[2][0],n[2][1]=i[2][1],n[2][2]=i[2][2],s};